{"title": "PDF", "author": "PDF", "url": "https://core.ac.uk/download/pdf/50524795.pdf", "hostname": "PDF", "description": "PDF", "sitename": "PDF", "date": "PDF", "cleaned_text": "Trabajo Final de Carrera TFC Sistema electr\u00f3nico de calibraci\u00f3n de fruta por di\u00e1metro Erico Cruz Lemus Ingenier\u00eda T\u00e9cnica Industrial. Especialidad en Electr\u00f3nica Industrial Director: Pere Mart\u00ed Puig Vic, Octubre de 20 12 RESUMEN TFC Resumen de Trabajo Final de Carrera TFC Ingenier\u00eda T\u00e9cnica Industrial Especialidad en Electr\u00f3nica Industrial T\u00edtulo: Sistema electr\u00f3nico de calibraci\u00f3n de fruta por di\u00e1metro Palabras Clave : Visi\u00f3n artificial, calibradora, medici\u00f3n di\u00e1metro, clasificac i\u00f3n de frutas, verduras y/o hortalizas, l\u00ednea de producci\u00f3n alimentaria, c\u00e1maras infrarrojo, luz LED, b\u00e1sculas, cooperativas agricultoras. Autor : Erico Cruz Lemus Direcci\u00f3 n: Pere Mart\u00ed Puig Fecha: Junio 2013 RESUMEN En la actualidad, l as cooperativas recolectan, seleccionan, tratan y separan la fruta seg\u00fan su calibre ( peso, di\u00e1metro m\u00e1ximo, medio y/o m\u00ednimo) para que esta llegue al consumidor final seg\u00fan la categor\u00eda (calibre) . Para poder competir en un mercado cada vez m\u00e1s exigente en calidad y precios, se requieren sistemas de clasificaci\u00f3n autom\u00e1ticos que nos permitan obtener \u00f3ptimos resultados con altos niveles de producci\u00f3n y productividad. Para realizar estas tareas existen calibradoras industriales que pesan la fruta mediante c\u00e9lulas de carga y con el peso obtenido las clasifica n asigna ndo las piezas a su salida correspondiente (mesa de confecci\u00f3n) a trav\u00e9s de un sistema de electroimanes. Desafortunadamente el proceso de calibraci\u00f3n de la fruta por peso no es en absoluto fiable ya que en este proceso no se considera el grosor de la piel , contenido de agua , de az\u00facar u otros factores altamente relevantes que influyen considerablemente en los resultados finales. El objeto de este proyecto es el de evolucionar las existentes calibradoras de fruta instala ndo un sistema industrial de visi\u00f3n artificial (r\u00e1pido y robusto) que trabaje en un rango de espectro Infrarrojo (mayor fiabilidad) proporciona ndo \u00f3ptimos resultados finales en la clasificaci\u00f3n de l as frutas, verduras y hortalizas. De este modo, el present e proyecto ofrece la oportunidad de mejorar el rendimiento de la l\u00ednea de clasificaci\u00f3n de frutas, aumentando la velocidad, disminuyendo p\u00e9rdidas en tiempo y error humano y mejorando indiscutiblemente la calidad del producto final deseada por los consumidores. SUMMARY TFC Final career work Title: Diameter fruit electronic Key Works calibrator, diameter measurement, cells, scales, farmers cooperatives. Author: Erico Cruz Lemus Director : Pere Mart\u00ed Puig Date : June 2013 SUMMARY At present, the cooperatives collect, select, treat and separate accordin (weight, maximum , medium or minimum diameter) to get this to the final consumer according to the category (caliber). To compete in a market more and more demanding in quality and prices, are required for automatic that allow us to obtain excellent results with high levels of and productivity. perform these tasks, there are sorting industrial machines weighting the fruit by load cells and sort the fruit by the weight obtained to the operator calibration process by weight at all reliable because this process do not consider this project is to evolve the existing fruits sorting systems by installing an industrial vision system machine (fast and robust) work ing in the infrared spectral range (more this project offers the opportunity of the fruit line classification, increasing speed, reducing losses in time and human error improving the desired final product quality by consumers . \u00cdNDICE 1. INTRODUCCI\u00d3N ...................................................................................................... 4 1.1. Antecedentes .................................................................................................... 4 1.1.1. Cadena del tratam iento y proceso de la fruta ............................................ 4 1.2. Objeto del proyecto ........................................................................................... 5 1.3. Especificaciones y abasto ................................................................................. 5 2. VISI\u00d3N GLOBAL ....................................................................................................... 6 2.1. Introducci\u00f3n ....................................................................................................... 6 2.1.1. Antecedentes en la calibraci\u00f3n de la fruta ................................................. 6 2.1.2. Calibraci\u00f3n por di\u00e1metro m\u00e1ximo .............................................................. 7 2.1.3. Calibraci\u00f3n por di\u00e1metro m\u00ednimo ............................................................... 7 2.1.4. Calibraci\u00f3n por di\u00e1metro medio ................................................................. 8 2.2. Proceso global calibraci\u00f3n ................................................................................. 8 3. VISI\u00d3N ARTIFICIAL ................................................................................................ 16 3.1. Descripci\u00f3n ...................................................................................................... 16 3.2. Hardware ......................................................................................................... 17 3.2.1. Visi\u00f3n global ............................................................................................ 17 3.2.2. C\u00e1maras y \u00f3pticas ................................................................................... 18 3.2.3. Sistema de iluminaci\u00f3n ............................................................................ 20 3.2.4. .......................................................................... 21 23 3.2.6. Sistema de comunicaci\u00f3n ........................................................................ 23 3.2.7. Alojamiento de las c\u00e1maras .................................................................... 24 3.3. Software .......................................................................................................... 26 3.3.1. C\u00f3digo del programa ............................................................................... 26 3.3.2. Inicio del programa .................................................................................. 27 3.3.3. Adquisici\u00f3n de im\u00e1genes ......................................................................... 27 3.3.4. Env\u00edo de los datos al PC de la calibradora .............................................. 32 3.3.5. Resumen de programaci\u00f3n ..................................................................... 35 de las c\u00e1maras ..................................................................... 35 4. CALIBRADORA ....................................................................................................... 37 4.1. Descripci\u00f3n ...................................................................................................... 37 4.2. Hardware ......................................................................................................... 38 4.2.1. Visi\u00f3n global ............................................................................................ 38 4.2.2. Distribuci\u00f3n del hardware ........................................................................ 44 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 4.2.3. Procesador Industrial ............................................................................... 46 4.3. Software .......................................................................................................... 48 4.3.1. Configuraci\u00f3n del Hardware .................................................................... 48 4.3.2. M\u00f3dulos de programaci\u00f3n ....................................................................... 49 4.3.3. Bloque ....................................................................................... 49 4.3.4. Clock C\u00e1lculos estad\u00edsticas ............................................................................... 89 4.3.10. Bloque Server .......................................................................................... 91 5. PRESUPUESTO ..................................................................................................... 97 5.1. Presupuesto mec\u00e1nico .................................................................................... 97 5.1.1. Conjunto caja c\u00e1maras ............................................................................ 97 5.1.2. Conjunto caja de CPU ............................................................................. 98 5.2. Presupuesto el\u00e9ctrico electr\u00f3nico .................................................................... 98 5.2.1. Material visi\u00f3n artific ial ............................................................................ 98 5.2.2. Cuadro el\u00e9ctrico visi\u00f3n artificial ............................................................... 99 5.2.3. Electr\u00f3nica PLC ....................................................................................... 99 5.2.4. Cuadro el\u00e9ctrico PLC .............................................................................. 99 5.3. Presupuesto TOTAL ...................................................................................... 100 6. CONCLUSIONES .................................................................................................. 100 6.1. Futuros proyectos .......................................................................................... 100 7. BIBLIOGRAF\u00cdA ..................................................................................................... 101 7.1. Calibraci\u00f3n y envases de fruta ...................................................................... 101 7.2. Visi\u00f3n artificial ................................................................................................ 101 7.3. Sistemas de iluminaci\u00f3n ................................................................................ 102 7.4. Hardware ....................................................................................................... 102 7.5. Software ........................................................................................................ 104 7.6. Sistemas de comunicaci\u00f3n ............................................................................ 104 8. ANEXOS ............................................................................................................... 105 8.1. ANEXO 1: Esquemas el\u00e9ctricos .................................................................... 105 8.2. ANEXO 2: Planos mec\u00e1nicos ........................................................................ 105 8.2.1. Soportes c\u00e1maras ................................................................................. 105 TRABAJO FINAL DE CARRERA 2 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 8.2.2. Soportes barras de LED ........................................................................ 105 8.2.3. Estructura campana c\u00e1maras ................................................................ 105 8.2.4. Conjunto campana c\u00e1maras .................................................................. 105 8.2.5. Conjunto caja pantalla PLC A ................................................................ 105 8.2.6. Conjunto caja pantalla PLC B ................................................................ 105 TRABAJO FINAL DE CARRERA 3 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 1. INTRODUCCI\u00d3N 1.1. Antecedentes Pocos somos conscientes de que el producto agroalimentario final que adquirimos en los establecimientos, las fruter\u00edas, antes de que l legue a manos del consumidor final, este ha tenido que ser procesado a trav\u00e9s de diversas etapas cuyas actuales exigencias del mercado requieren de altos est\u00e1ndares de calidad y productividad (alta producci\u00f3n a un muy bajo costo). 1.1.1. Cadena del tratamiento y proceso de la fruta Esta cadena de tratamiento y proceso de la fruta la podemos resumir de la siguiente manera: Cosecha del producto Recolecci\u00f3n / Almacenamiento Calibraci\u00f3n / Envase Distribuci\u00f3n Consumidor final FASE 1 FASE 2 FASE 3 FASE 4 FASE 5 TRABAJO FINAL DE CARRERA 4 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Las cooperativas industriales que tratan y separan la fruta seg\u00fan su calibre (peso, color y di\u00e1metro), para poder competir en un mercado cada vez m\u00e1s exigente requieren de los m\u00e1s adecuados m\u00e9todos para evitar quedarse atr\u00e1s y por lo tanto enfrentarse a p\u00e9rdidas nocivas para el negocio. Hoy en d\u00eda la fruta se separa seg\u00fan su peso, color, defecto (da\u00f1os visuales externos) , di\u00e1metro e incluso por su contenido de az\u00facar, pero para poder procesar correctamente la fruta se requiere de un sistema altamente sofisticado cuya visi\u00f3n artificial ser\u00e1 objeto de este proyecto. 1.2. Objeto del proyecto As\u00ed pues, el objeto de este proyecto es el de dise\u00f1ar un sistema de visi\u00f3n artificial que permita diferenciar la fruta seg\u00fan su di\u00e1metro proporcionando a la l\u00ednea de producci\u00f3n las siguientes ventajas competitivas: Reducci\u00f3n de la mano de obra Altas velocidades en el proceso de calibraci\u00f3n Fiabilidad (con un margen de error de +/- 1mm) El objeto de este proyecto es el de dise\u00f1ar un dispositivo que pueda trabajar de manera autom\u00e1tica sin la necesidad de la presencia humana, de modo que la industria gane en producci\u00f3n y productividad adem\u00e1s de mejorar el est\u00e1ndar de calidad del producto final gracias a una adecuada manipulaci\u00f3n de la fruta y una reducci\u00f3n del error humano durante la adquisici\u00f3n de las medidas realizadas. 1.3. Especificaciones y abasto El sector hortofrut\u00edcola, dependiendo del tipo de fruta que se procese, requiere poder seleccionar la fruta seg\u00fan su di\u00e1metro m\u00ednimo, m\u00e1ximo y/o medio. Las funciones espec\u00edficas que llevar\u00e1 a t\u00e9rmino la unidad de visi\u00f3n artificial dise\u00f1ada en el presente proyecto ser\u00e1n las de capturar im\u00e1genes de las frutas y hortalizas que pasan por las citas de producci\u00f3n (hasta una velocidad m\u00e1xima de 7 piezas por segundo), realizar los c\u00e1lculos necesarios para determinar el di\u00e1metro m\u00ednimo, m\u00e1ximo y medio, y enviar los valores resultantes al computador princi pal que activar\u00e1 las salidas (por electroim\u00e1n) que previamente haya configurado el operario de la m\u00e1quina. TRABAJO FINAL DE CARRERA 5 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 2. VISI\u00d3N GLOBAL 2.1. Introducci\u00f3n Tal y c\u00f3mo hemos visto en el apartado \"1.1.1. Cadena del tratamiento y proceso de la fruta\", existen diversas fases cuyas funciones son las de gestionar las frutas y hortalizas de manera eficiente para que dichos productos lleguen al alcance del consumidor final satisfactoriamente. Como hemos mencionado en el apartado de especificaciones y abasto, nosotros nos centraremos en la FASE 3 (Calibraci\u00f3n y almacenamiento), aunque lo que en realidad a nosotros nos concierne es la calibraci\u00f3n de la fruta (en este caso, la calibraci\u00f3n de la fruta por di\u00e1metro). 2.1.1. Antecedentes en la calibraci\u00f3n de la fruta Anteriormente, las frutas y hor talizas se calibraban manualmente utilizando diversos instrumentos como los de las siguientes ilustraciones : Ilustraci\u00f3n 1 Ilustraci\u00f3n 2 Seg\u00fan el tipo de fruta y/o hortaliza que se desee pr ocesar y el embase a utilizar, las piezas se seleccionan por di\u00e1metro m\u00e1ximo, m\u00ednimo, o di\u00e1metro medio (ver siguiente ilustraci\u00f3n): TRABAJO FINAL DE CARRERA 6 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 3 Donde la medici\u00f3n A mide el di\u00e1metro m\u00e1ximo, y las figuras B y C miden el di\u00e1metro m\u00ednimo. 2.1.2. Calibraci\u00f3n por di\u00e1metro m\u00e1ximo Un claro ejemplo de calibraci\u00f3n por di\u00e1metro m\u00e1ximo lo podemos tener en alguna variedad de mandarinas, ya que estas son de forma achatada y necesitamos que en el embase, estas piezas queden derechas vi\u00e9ndose solo la parte superior (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 4 2.1.3. Calibraci\u00f3n por di\u00e1metro m\u00ednimo Sin embargo, para otros tipos de frutas y hortalizas con su embase utilizado para la salida al mercado, se requiere la medici\u00f3n del di\u00e1metro m\u00ednimo, como en el ejemplo de las dos siguientes ilustraciones: Ilustraci\u00f3n 5 Di\u00e1metro m\u00e1ximo Di\u00e1metro m\u00ednimo TRABAJO FINAL DE CARRERA 7 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 6 2.1.4. Calibraci\u00f3n por di\u00e1metro medio Por \u00faltimo, tambi\u00e9n se calibran las piezas, cuando estas son mucho mas redondas, utilizando el di\u00e1metro medio, por ejemplo con la naranjas de la siguiente ilustraci\u00f3n. Ilustraci\u00f3n 7 2.2. Proceso global calibraci\u00f3n Tal y como hemos mencionado anteriormente, el proceso de calibraci\u00f3n se realizar\u00e1 a trav\u00e9s de unas c\u00e1maras de visi\u00f3n artificial cuya instalaci\u00f3n se realizar\u00e1 en l\u00ednea con y de manera continua. En la siguiente ilustraci\u00f3n se puede apreciar la l\u00ednea global de calibraci\u00f3n. Di\u00e1metro medio TRABAJO FINAL DE CARRERA 8 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 8 En la siguiente tabla se describe cada una de las partes de l\u00ednea de calibraci\u00f3n. Pos. Descripci\u00f3n Unidades 1 VOLCADOR DE BINS 1 2 VOLCADOR MANUAL CAJAS DE LLENAS 1 3 TRAMO RODILLOS 1 4 PLATAFOR MA ELEVADA 1 5 CINTA RETORNO DESTRIO 1 6 MESA DESTRIO 1 7 CEPILLAD ORA BYPASS 1 8 T\u00daNEL ENCERADO 1 9 TAPIZ M\u00daLTIPLE 1 10 T\u00daNEL SECADO 1 11 PRE-ALINEADOR 1 12 ALINEADOR 1 13 ROTACI\u00d3N ENTRADAS C\u00c1MARAS 1 14 VISI\u00d3N ARTIFICIAL 1 15 C\u00c9LULAS DE CARGA 1 TRABAJO FINAL DE CARRERA 9 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 16 MESAS DE CONFECCI\u00d3N 2 17 CALIBRADORA 2 LINEAS, 16+1 SALIDAS 1 18 TRANSPORTADOR SALIDA DE CAJAS LLENAS 2 19 TRAMO DE RODILLOS 2 Tabla 1 (1) Volcador de bins: En la anterior ilustraci\u00f3n podemos comprender como la fruta llega desde las c\u00e1maras de refrigeraci\u00f3n en el interior de unos recipientes industriales conocidos con el nombre de palots (ver siguiente ilustraci\u00f3n) Ilustraci\u00f3n 9 Posteriormente estos palots son volcados semiautom\u00e1ticamente de modo que las piezas entran en la l\u00ednea de calibraci\u00f3n. (2) Volcador manual de cajas llenas: En ocasiones, en la misma l\u00ednea de producci\u00f3n se introducen las piezas manualmente en cajas convencionales. (3) Tramo de rodillos y (6) Mesa de destr\u00edo: En la zona \"tramo de rodillos\" diversos operarios extraen de la l\u00ednea de calibraci\u00f3n aquellas piezas que visualmente se consideran da\u00f1adas (destr\u00edo de la fruta defectuosa) . (4) Plataforma elevada: Para efectuar el destr\u00edo de la fruta mencionado los operarios subir\u00e1n a plataformas especialmente dise\u00f1adas para evitar ac cidentes y soportar el peso necesario. TRABAJO FINAL DE CARRERA 10 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (5) Cinta retorno destr\u00edo: Mediante una cinta transportadora, la fruta destriada por los operarios retornar\u00e1 a un palot vac\u00edo cuyo contenido ser\u00e1 enviado a plantas especializadas en el proceso y producci\u00f3n de zumos . (7) Cepilladora Bypass: Mediante unos cepillos de dureza especialmente dise\u00f1ada para no da\u00f1ar el g\u00e9nero limpiamos la fruta. (8) T\u00fanel encerado: Posteriormente mediante unos aspersores y unos cepillos se aplica una capa de cera especial y un pulido consiguiendo un brillo atractivo en la fruta para el consumidor final. (9) Tapiz m\u00faltiple: A trav\u00e9s de un conjunto de tapices m\u00faltiples introducimos la fruta en el t\u00fanel de secado. (10) T\u00fanel de secado: Con un sistema de ventiladores de alta presi\u00f3n y resistenci as t\u00e9rmicas, secamos la fruta antes de que esta sea calibrada (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 10 (11) Pre-alineador y (12) Alineador: Un sistema de tapices funcionando a diversas velocidades se encargan de alinear la fruta para que esta llegue individualmente a la zona de visi\u00f3n artificial sin general falsas capturas de im \u00e1genes (ver siguiente ilustraci\u00f3n). TRABAJO FINAL DE CARRERA 11 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 11 (13) Rotaci\u00f3n entrada c\u00e1maras: Para conseguir captar im\u00e1genes en todo su per\u00edmetro, debe ir en un soporte que permita rotar las piezas mientras estas se desplazan horizontalmente. Para eso, hemos dise\u00f1ado un sistema de manos o \"cazoletas\" que mediante unos rodillos y unas cintas transportadoras con velocidad lineal ajustable mediante un variador de frecuencia permite la rotaci\u00f3n de la fruta y hortaliza requerida (ver siguiente ilustraci\u00f3n). TRABAJO FINAL DE CARRERA 12 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 12 (14) Visi\u00f3n artificial: En el m\u00f3dulo de visi\u00f3n artificia l, alojaremos las c\u00e1maras y luces estrobosc\u00f3picas que captar\u00e1n las im\u00e1genes necesarias para realizar los c\u00e1lculos de di\u00e1metro mencionados (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 13 TRABAJO FINAL DE CARRERA 13 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (15) C\u00e9lulas de carga: Opcionalmente, en algunas l\u00edneas de calibraci\u00f3n, podemos incluir un m\u00f3dulo de c\u00e9lulas de carga para adquirir los pesos de las piezas. De esto modo podemos calibrar la fruta con di\u00e1metro, con peso, o con peso y di\u00e1metro. (16) Mesas de confecci\u00f3n: En las mesas de confecci\u00f3n l os operarios reciben la fruta calibrada para que puedan embasarla manualmente en las cajas especialmente dise\u00f1adas para ello (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 14 (17) Calibradora: Despu\u00e9s de obtener los resultados de tama\u00f1os de las piezas, mediante una cadena, sistema de \"cazoletas\" (antes mencionado) y electroimanes, la calibradora expulsar\u00e1 la fruta a las mesas de confecci\u00f3n seleccionadas previamente por el operador en el PC de m\u00e1quina principal (ver siguientes ilus traciones ). TRABAJO FINAL DE CARRERA 14 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 15 Ilustraci\u00f3n 16 (18) Transportador de cajas llenas y (19) Tramo de rodillos: Finalmente, las cajas confeccionadas de frutas con sus diversos tama\u00f1os calibrados , salen a trav\u00e9s de un circuito de transportadores y tramos de rodillos donde un \u00faltimo operario los agrega a un palet para que cuando este se compl ete pueda ser almacenado en c\u00e1maras de refrigeraci\u00f3n y/o maduraci\u00f3n o incluso enviarse a los camiones para ser distribuido a sus correspondientes destinatarios. C\u00e9lulas de carga Cazoletas + cadena Elect roimanes C\u00e9lulas de carga TRABAJO FINAL DE CARRERA 15 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 17 3. VISI\u00d3N ARTIFICIAL 3.1. Descripci\u00f3n El sistema de visi\u00f3n artificial autom\u00e1tico de calibraci\u00f3n de fruta por di\u00e1metro debe ejecutar las siguientes tareas: 1. Adquisici\u00f3n de las im\u00e1genes en la l\u00ednea de producci\u00f3n (hardware) 2. Procesamiento de la im\u00e1genes (hardware / software) 3. Gesti\u00f3n de los resultados (hardware / software) 4. Comunicaci\u00f3n con la unidad principal calibradora (hardware / software) As\u00ed pues, para la ejecuci\u00f3n de estas tareas, el proyecto requiere de un hardware y un software que nos permita obtener \u00f3ptimos resultados. El objetivo del sistema de calibraci\u00f3n es poder trabajar con las siguientes caracter\u00edsticas: Velocidad de calibraci \u00f3n: 5 unidades /segundo 79mm Fruta a calibrar: ciruelas y nectarinas N\u00famero de l\u00edneas de calibraci\u00f3n: 4 l\u00edneas \u00c1rea total de visi\u00f3n: 780 x 316mm TRABAJO FINAL DE CARRERA 16 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 1 2 Salida frutaLinea 1 Linea 23.2. Hardware 3.2.1. Visi\u00f3n global El m\u00f3dulo de visi\u00f3n artificial objeto del presente proyecto requiere del siguiente hardware: C\u00e1maras y \u00f3pticas Sistema de iluminaci\u00f3n Procesador industrial Sistema de comunicaci\u00f3n De este modo, el hardware mencionado tendr\u00eda la siguiente configuraci\u00f3n en m\u00e1quina: Ilustraci\u00f3n 18 21Electroim\u00e1n C\u00e1mara visi\u00f3n Panel led B\u00e1scula Cuadro el\u00e9ctrico conjunto c\u00e1maras Cuadro el\u00e9ctrico entradas y salidas Conjunto PC Conexiones TRABAJO FINAL DE CARRERA 17 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 3.2.2. C\u00e1maras y \u00f3pticas Debido a que necesitamos trabajar con fruta lo suficientemente oscura, necesitamos un sistema de visi\u00f3n artificial sofisticado que sea capaz de diferenciar las piezas cuyas cazoletas (sistema de manos que transporta la fruta en la l\u00ednea de producci\u00f3n) tambi\u00e9n son oscuras . Actualmente, el m\u00e9todo utilizado para la detecci\u00f3n de di\u00e1metro de fruta oscura es utilizando cazoletas de color claro (azul cian para obtener un mayor contraste) y c\u00e1maras de color convencionales. El gran inconveniente de esta metodolog\u00eda es que las cazoletas se ensucian y la suciedad provocaba que las c\u00e1maras obtengan lecturas err\u00f3neas que derivan en falsos valores de di\u00e1metro. A este inconveniente cabe a\u00f1adirle que las c\u00e1maras de color convencionales son demasiado delicadas al cambio de intensidad de luz. Debemos tener en cuenta que para trabajar con color, antes es necesario hacer un mapa de colores y as\u00ed discriminar (por software) el entorno a la fruta (la zona de cazoletas). Sin embargo, debido al cambio de intensidad de luz, el mapa de colores se ve negativamente afectado de modo que las lecturas obtenidas tampoco disponen de la fiabilidad requerida en un proceso industrial. Actualmente existe tecnolog\u00eda que nos permite obtener \u00f3ptimos resultados en fiabilidad y velocidad de operaci\u00f3n. As\u00ed es, el presente proyecto ofrece una ventaja competitiva de gran envergadura frente a las actuales tecnolog\u00edas utilizadas debido a que este propone trabajar con c\u00e1maras que detectan m\u00e1rgenes de longitudes de onda propias del infrarrojo IR. Gracias a la utilizaci\u00f3n de c\u00e1maras infrarrojo podemos constatar las siguientes ventajas competitivas: M\u00e9todo mucho m\u00e1s sencillo para el operario (no debe hacer mapa de colores) Longitud de onda que per mite diferenciar la fruta de fondos oscuros Tecnolog\u00eda mucho m\u00e1s fiable (no es tan delicado al cambio de colores) Menor mantenimiento (no requiere calibraciones) Mayor velocidad y menos requerimientos de hardware (sin mapa de colores el software es mas com pacto) As\u00ed pues, Debido a la buena relaci\u00f3n calidad - precio que requerimos para el proyecto, hemos elegido unas c\u00e1maras con las siguientes caracter\u00edsticas: C\u00e1maras GENIE de 1063x1024 pixel Monocromo (visi\u00f3n en infrarrojo IR) Conexi\u00f3n por TCP/IP TRABAJO FINAL DE CARRERA 18 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 3.2.2.1 Resoluci\u00f3n de las c\u00e1maras Para obtener la resoluci\u00f3n se debe de dividir el \u00e1rea que se desea observar entre el n\u00famero de pixeles del sensor. En realidad la divisi\u00f3n ser\u00eda entre el ancho/alto del \u00e1rea a observar entre el ancho/alto correspondiente del tama\u00f1o del sens or. En este caso estamos utilizando que para los 316mm tenemos el lado del sensor que tiene 1024pixeles, haciendo la divisi\u00f3n 316/1024 tendr\u00edamos una resoluci\u00f3n de 0.308mm/pixel. Es muy arriesgado decir que tenemos esta resoluci\u00f3n, normalmente se multiplic a este valor por 2.5 para asegurarnos y no tener fallos por ruido. Entonces estar\u00edamos diciendo que tenemos una resoluci\u00f3n precisa de 0.308x2.5 = 0.77mm/pixel . 3.2.2.2 Tiempo de exposici\u00f3n de las c\u00e1maras Para el tiempo de exposici\u00f3n tenemos que para las c\u00e1maras matriciales con iluminaci\u00f3n normal o est\u00e1ndar (que no sea de alta potencia) se utiliza un tiempo de exposici\u00f3n entre el rango de 2ms a 10ms para obtener im\u00e1genes no saturadas. Normalmente siempre tomamos un valor intermedio de unos 5 \u00f3 6 ms para asegurar y c omenzamos a modificar el iris de la lente para obtener el contraste que buscamos. Adem\u00e1s con este tiempo podemos asegurar que se tiene una imagen excelente aun cuando se tenga movimiento en el producto, como lo ser\u00eda en este caso que se mueve la l\u00ednea de transporte. 3.2.2.3 Elecci\u00f3n de las \u00f3pticas De esta f\u00f3rmula despejaremos la distancia al objeto, que es el valor que nos interesa. Tomando en cuenta que la distancia focal ser\u00e1 8 o 12mm (valores comerciales existentes en el mercado), que el tama\u00f1o del sensor es de 4.7616mm (Tama\u00f1o del alto del sensor) y el tama\u00f1o del objeto ser\u00eda de 316, tenemos los siguientes resultados: con la \u00f3ptica de 8mm se tendr\u00eda una altura en la c\u00e1mara de aproximadamente 530mm, mientras que con la \u00f3ptica de 12mm tendr\u00edamos una altura de 795mm aproximadamente. Debemos de tomar en cuenta que entre mayor sea la distancia focal menor ser\u00e1 la distorsi\u00f3n, pero la iluminaci\u00f3n ser\u00eda m\u00e1s tenue as\u00ed que debido a que en nuestra aplicaci\u00f3n la iluminaci\u00f3n es cr\u00edtica utilizaremos una lente con las siguie ntes caracter\u00edsticas: TRABAJO FINAL DE CARRERA 19 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Goyo Optical Inc. \u00d3ptica de alta resoluci\u00f3n de 8mm Rango del iris de F1.4 Rosca C 2/3\" con tornillos de fijaci\u00f3n Ilustraci\u00f3n 19 3.2.3. Sistema de iluminaci\u00f3n Para obtener buenos resultados en la adquisici\u00f3n de las im\u00e1genes, uno de los par\u00e1metros decisivos es la utilizaci\u00f3n de un buen sistema de iluminaci\u00f3n. Actualmente existen dos sistemas de iluminaci\u00f3n en el mercado que nos ofrecen la longitud de onda deseada en infrarrojo (850nm): iluminaci\u00f3n por fluoresce ntes con un filtro a\u00f1adido e iluminaci\u00f3n por LED que ya emiten la longitud de onda IR deseada (sin la necesidad de a\u00f1adir filtros). En el presente proyecto utilizaremos iluminaci\u00f3n LED porque a pesar de que esta es m\u00e1s costosa no requiere filtros externos (que se ensucian y requieren mantenimiento) y la luz emitida var\u00eda muy poco con las horas de funcionamiento de estas. Este \u00faltimo factor es decisivo para nuestra aplicaci\u00f3n debido a que los fluorescentes var\u00edan su emisi\u00f3n de luz con la temperatura u horas de funcionamiento provocando que las c\u00e1maras se descalibren y afecten a la calidad de imagen adquirida. TRABAJO FINAL DE CARRERA 20 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Caracter\u00edsticas de las luces: Barra de LEDs de 400x25mm LEDs de 5mm a Tensi\u00f3n 12Vdc / 11,76W M\u00e9todo de de iluminaci\u00f3n: 400x16mm2 Dimensiones: 422x24x23 Material: aleaci\u00f3n de aluminio Temperatura -5 a 45\u00b0C Ilustraci\u00f3n 20 3.2.4. Sistema estrobosc\u00f3pico Para alimentar las luces LED requerimos de un m\u00f3dulo estrobosc\u00f3pico cuya funci\u00f3n es la de gestionar la intensidad de salida que alimenta las barras LED cuando recibe un pulso de entrada providente directamente del detector fotoc\u00e9lula de paso de cazoletas. Esta tarea la realizaremos a trav\u00e9s del m\u00f3dulo estrobe comercial modelo PP520 del fabricante Gardasoft Vision Ltd (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 21 TRABAJO FINAL DE CARRERA 21 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Este m\u00f3dulo programable permite configurar el nivel de intensidad que queremos dar a las barras LED (nivel de br illo del 0 al 150%), tiempo de cada pulso en milisegundos, y retardo en milisegundos (en nuestra aplicaci\u00f3n no requerimos retardo), (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 22 TRABAJO FINAL DE CARRERA 22 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 3.2.5. Procesador industrial El procesador o PC que requerimos para nuestra aplicaci\u00f3n debe ser car\u00e1cter industrial para disponer de alta fiabilidad y utilizar un Windows XP embeded con las aplicaciones b\u00e1sicas que requiere el software de control y c\u00e1lculo de las c\u00e1maras. Por eso que hemos elegido el siguiente controlador: Procesador Geva, 320GB HD, 2GB RAM 2.4GHz Dual Core Inputs: 8 2 triggers 8 23 3.2.6. Sistema de comunicaci\u00f3n Nuestro sistema, despu\u00e9s de adquirir las im\u00e1genes y realizar los c\u00e1lculos deseados, debe enviar los datos a trav\u00e9s de un protocolo de comunicaci\u00f3n r\u00e1pido y fiable. De todos los sistemas de comunicaci\u00f3n disponibles en el procesador industrial GEVA y el software de control de las c\u00e1maras (SHERLOCK), el m\u00e1s \u00fatil para nuestra aplicaci\u00f3n es el TCP/IP, que a pesar de que no es un sistema muy fiable, nos permite trabajar a las velocidades deseadas y en la programaci\u00f3n podemos mejorar la fiabilidad al nivel que requiere nuestra aplicaci\u00f3n. TRABAJO FINAL DE CARRERA 23 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Los datos ser\u00e1n enviados al computador principal de la m\u00e1quina calibradora que junto con los datos de las b\u00e1sculas asignar\u00e1 la fruta calibrada a la salida previamente configurada por el opera rio de la m\u00e1quina. Ilustraci\u00f3n 24 3.2.7. Alojamiento de las c\u00e1maras Para evitar vibraciones, acceso de la suciedad a las \u00f3pticas (polvo), manipulaci\u00f3n indebida por parte de alg\u00fan operario, etc. debemos ubicar las c\u00e1maras en un habit\u00e1culo cerrado, resistente a los golpes externos y vibraciones, permitiendo un correcto ajuste y f\u00e1cil instalaci\u00f3n del sistema con una altura variable seg\u00fan las necesidades reales del t\u00e9cnico durante la instalaci\u00f3n de las c\u00e1maras. TRABAJO FINAL DE CARRERA 24 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 25 TRABAJO FINAL DE CARRERA 25 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 3.3. Software Para el control de las c\u00e1maras y adquisici\u00f3n de las im\u00e1genes utilizaremos un software comercial llamado SHERLOCK (Sherlock V7.1.6.0) debido a que es un entorno de programaci\u00f3n que ofrece una amplia gama de herramientas de medici\u00f3n y procesamiento de datos que requeriremos para nuestra aplicaci\u00f3n. A trav\u00e9s del software realizaremos los siguientes procedimientos: 1. Inicio del programa 2. Adquisici\u00f3n de im\u00e1genes 3. C\u00e1lculo de di\u00e1metros 4. Env\u00edo de los datos al PC de la calibradora 3.3.1. C\u00f3digo del programa Antes de ver y explicar el c\u00f3digo del programa vea la siguiente ilustraci\u00f3n: Ilustraci\u00f3n 26 El funcionamiento del sistema de visi\u00f3n se basa en realizar fotos cada vez que un sensor fotoc\u00e9lula detecta el paso de la \"cazoleta\". En el momento en que se produce dicha detecci\u00f3n la c\u00e1mara, junto con la luz estrobosc\u00f3pica LED, realiza una captura y ejecuta una secuencia completa del programa enviando los resultados al PLC de la calibradora. En este PC el programa principal hace una media de resultados de las 4 posiciones por donde ha recorrido la fruta. De este modo, gracias al sistema de rotaci\u00f3n y a la captura de las 4 posiciones podemos obtener \u00f3ptimos resultados debido a que captamos los 360\u00b0 de la fruta. As\u00ed pues, la estructura del programa queda del siguiente modo: TRABAJO FINAL DE CARRERA 26 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Nota: El bloque de programaci\u00f3n \"imgA\" gestiona las l\u00edneas 1 y 2 de la c\u00e1mara 1 y el bloque \"imgB\" gestiona las l\u00edneas 3 y 4 de la c\u00e1mara 2. 3.3.2. Inicio del program a Tal y como hemos mencionado, el programa se ejecuta completa cada vez que el sensor fotoc\u00e9lula detecta el paso de las cazoletas. En este caso, tenemos configurado una entrada digital de la tarjeta f\u00edsica electr\u00f3nica de entradas y salidas (digital input 17). 3.3.3. Adquisici\u00f3n de im\u00e1genes Tal y como hemos mencionado anteriormente, cada detecci\u00f3n de paso de cazoletas tomamos y gestionamos 4 im\u00e1genes por cada l\u00ednea. 1. Inicio del programa 1. Adquisici\u00f3n de im\u00e1genes 2. C\u00e1lculo de di\u00e1metros 3. Env\u00edo de los datos al PC de la calibradora TRABAJO FINAL DE CARRERA 27 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO L\u00ednea 1 / posici\u00f3n 1 L\u00ednea 1 / posici\u00f3n 2 L\u00ednea 1 / posici\u00f3n 3 L\u00ednea 1 / posici\u00f3n 4 L\u00ednea 2 / posici\u00f3n 1 L\u00ednea 2 / posici\u00f3n 2 L\u00ednea 2 / posici\u00f3n 3 L\u00ednea 2 / posici\u00f3n 4 La c\u00e1mara 2 leer\u00e1 las l\u00edneas 3 y 4, y esta est\u00e1 programada en el bloque \"imgB\" del mismo modo que el bloque \"imgA\". TRABAJO FINAL DE CARRERA 28 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 27 L\u00ednea X / Posici\u00f3n Y L\u00ednea 1 / posic i\u00f3n 2 L\u00ednea 1 / posici\u00f3n 3 L\u00ednea 1 / posici\u00f3n 4 L\u00ednea 1 / posici\u00f3n 5 Delimitamos el \u00e1rea de visi\u00f3n de \"Linea X / Posici\u00f3n Y) y eliminamos ruido (posibles manchas y/o falsas peque\u00f1as \u00e1reas), generamos filtros (threshold) Dentro del \u00e1rea delimitada comp robamos si detectamos un \u00e1rea (de una fruta) y si es as\u00ed buscamos su centro TRABAJO FINAL DE CARRERA 29 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 28 Si el \u00e1rea encontrada es mayor que 1 entonces lanzamos una herramienta llamada \"coordspoke\" con el centro en el centro antes encontrado y calculamos el di\u00e1metro m\u00e1ximo, m\u00ednimo y medio CoordSpoke TRABAJO FINAL DE CARRERA 30 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO En la siguiente ilustraci\u00f3n podemos ver el resultado de las herramientas utilizadas en el c\u00f3digo del programa. Ilustraci\u00f3n 29 En la s siguientes ilustraci ones podemos ver la fruta despu\u00e9s de aplicar los respectivos filtros aplicados en la herramienta de \"threshold\". Ilustraci\u00f3n 30 TRABAJO FINAL DE CARRERA 31 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 31 3.3.4. Env\u00edo de los datos al PC de la calibradora Como ya hemos descrito anteriormente, cada detecci\u00f3n de paso de cazoleta realizamos la captura y sus respectivos c\u00e1lculos de 16 im\u00e1genes (4 posiciones x 4 l\u00edneas). Por lo tanto necesitaremos enviar una secuencia en formato \"String\" que contenga 16 x 3 = 48 resultados (Di\u00e1metro M\u00e1ximo, Di\u00e1metro M\u00ednimo y Di\u00e1metro Medio de cada posici\u00f3n). Para realizar esta funci\u00f3n convertiremos los resultados de \"Integer\" a \"String\", los sumaremos a una \u00fanica secuencia de \"String\" y por \u00faltimo enviaremos este \u00fanico \"String\" a trav\u00e9s de comunicaci\u00f3n Ethernet teniendo configurado el PC de las c\u00e1maras como \"server\" y el PC de la calibradora como \"Client\". TRABAJO FINAL DE CARRERA 32 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Convertimos las variables de di\u00e1metros calculados a formato \"String\" Generamos la secuencia: Di\u00e1metro Medio L\u00ednea 1 Posici\u00f3n 1 + Di\u00e1metro M\u00e1ximo L\u00ednea 1 Posici\u00f3n 1 + Di\u00e1metro M\u00ednimo L\u00ednea 1 Posici\u00f3n 1 Ejecutamos la misma secuencia con l a l\u00ednea 2 Sumamos en la secuencia el \"String\" de la l\u00ednea 1 con el \"String\" de la l\u00ednea 2 y el resultado se almacena en el \"String\" de la l\u00ednea 2 L\u00ednea 2 + L\u00ednea 3 y el \"String\" de la l\u00ednea 3 almacena en esta posici\u00f3n todos los resultados TRABAJO FINAL DE CARRERA 33 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustrac i\u00f3n 32 Finalmente conseguimos todos los resultados en el \"String\" 16 y lo enviamos a trav\u00e9s de la comunicaci\u00f3n Ethernet TRABAJO FINAL DE CARRERA 34 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 3.3.5. Resumen de programaci\u00f3n Como la imagen que tenemos es en blanco y negro (visi\u00f3n monocromo infrarroja IR), primero aplico una serie de filtros para resaltar solamente los di\u00e1metros que nos interesan y eliminar ruido que recibamos de la l\u00ednea de producci\u00f3n. Ya teniendo una imagen con los di\u00e1metros definidos se procede a realizar la b\u00fasqueda de los conjuntos de pixeles y sacar las medidas que nos interesan, \u00e1rea, tama\u00f1o de elipse mayor y coordenadas en el \u00e1rea de inter \u00e9s para identificarlos. Como se puede observar el software nos entrega todos estos valores y solo nos hace falta pasar estos valores a Strings y enviar toda la secuencia de resultados al ordenador principal de la calibradora que junto con los par\u00e1metros c onfigurados por pantalla por el operador, la calibradora asignar\u00e1 la fruta a la salida requerida. El dato que nos interesa es que toda la secuencia del programa se ejecuta en un tiempo de procesamiento de 36ms, hay que tomar en cuenta que el equipo donde s e ha realizado esta prueba tiene un procesador de un solo n\u00facleo y el equipo que se incluye en este proyecto (procesador GEVA descrito en el apartado 3.1.3.) es de doble n\u00facleo de 2.4GHz y 2Gb de memoria RAM. Considerando que necesitamos trabajar a una velocidad de 5 unidades por segundo, tenemos lo siguiente: Vcalib.: Velocidad de procesamiento de datos del ordenador principal de la calibradora De este modo se confirma que no tendremos inconvenientes de velocidad para la gesti\u00f3n de las im\u00e1genes a la v elocidad m\u00e1xima de calibraci\u00f3n. 3.3.6. Calibraci\u00f3n de las c\u00e1maras Para la realizaci\u00f3n de la correcta medici\u00f3n necesitamos calibrar las c\u00e1maras de modo que estas sepan convertir las distancias que visualizan en unidades m\u00e9tricas (mm). Para ello, necesitamos dise\u00f1ar una plantilla que abarque toda el \u00e1rea de visi\u00f3n de cada una de las l\u00edneas (ver siguiente ilustraci\u00f3n) y la situemos bajo la c\u00e1mara para realizar la calibraci\u00f3n. TRABAJO FINAL DE CARRERA 35 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 33 En nuestra aplicaci\u00f3n, el entorno de programaci\u00f3n Sherlock dispone de una funci\u00f3n de calibraci\u00f3n de modo que solo debemos indicar el tama\u00f1o de las cuadr\u00edculas (19,3mm) y el software realiza una auto calibraci\u00f3n. Ilustraci\u00f3n 34 TRABAJO FINAL DE CARRERA 36 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Dicha calibraci\u00f3n debemos realizarla c uando las c\u00e1maras sean f\u00edsicamente instaladas y fijadas en la m\u00e1quina y solo ser\u00e1 necesario realizar otra calibraci\u00f3n en el caso en que estas se hayan movido. 4. CALIBRADORA 4.1. Descripci\u00f3n Si nos fijamos en la siguiente ilustraci\u00f3n, la unidad de calibraci\u00f3n dispone de una etapa de alimentaci\u00f3n de la fruta (m\u00f3dulos 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11 y 12), etapa de visi\u00f3n artificial (m\u00f3dulos 13 y 14), etapa de calibraci\u00f3n (m\u00f3dulos 15 y 17) y por \u00faltimo la etapa de salida y clasificaci\u00f3n (m\u00f3dulos 16, 18 y 19). Ilustraci\u00f3n 35 En este apartado describiremos la etapa de calibraci\u00f3n, cuya funci\u00f3n es la de recibir los datos del m\u00f3dulo de visi\u00f3n artificial, procesarlos y por \u00faltimo clasificar las piezas seg\u00fan los resultados. Cabe mencionar que el punto que m\u00e1s nos interesa es la recepci\u00f3n de los datos del m\u00f3dulo de visi\u00f3n artificial, el procesamiento de estos y por \u00faltimo el c\u00e1lculo de la salida asignada, es por este motivo que ser\u00e1 donde dedicaremos gran parte del contenido del presente proy ecto. TRABAJO FINAL DE CARRERA 37 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 1 2 Salida frutaLinea 1 Linea 24.2. Hardware 4.2.1. Visi\u00f3n global Si recordamos en los anteriores apartados, la distribuci\u00f3n del hardware de la calibradora resulta del siguiente modo: Ilustraci\u00f3n 34 21Electroim\u00e1n C\u00e1mara visi\u00f3n Panel led B\u00e1scula Cuadro el\u00e9ctrico conjunto c\u00e1maras Cuadro el\u00e9ctrico entradas y salidas Conjunto PC Conexiones TRABAJO FINAL DE CARRERA 38 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Electroimanes: Mediante unos electroimanes de 24Vdc activados directamente de la salida del PLC conseguimos volcar las \"cazoletas\" de modo que la fruta sale a las mesas de confecci\u00f3n a trav\u00e9s de unos tapices inferiores. Ilustraci\u00f3n 36 Tal y como podemos apreciar en la presente ilustrac i\u00f3n, la bobina de 24Vdc es excitada a trav\u00e9s del m\u00f3dulo de salidas del PLC y esta levanta la palanca naranja que vuelca las cazoletas que contienen la fruta que requerimos expulsar por esa salida. B\u00e1sculas : A pesar de que el sistema propuesto en el presente proyecto basa su funcionamiento en la visi\u00f3n artificial, opcionalmente la calibradora dispone de dos m\u00f3dulos de c\u00e9lulas de carga por cada l\u00ednea (uno a cada costado del paso de la cazoleta) , cuya medi a entre ambas es la que nos resulta el peso din\u00e1mico total de cada fruta (ver siguientes ilustraciones) . Ilustraci\u00f3n 37 TRABAJO FINAL DE CARRERA 39 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Cuadro el\u00e9ctrico c\u00e1maras: El cuadro el\u00e9ctrico de las c\u00e1maras aloja el m\u00f3dulo estrobe que alimenta las luces LED generando pulsos cada vez que recibe l a se\u00f1al de la fotoc\u00e9lula que detecta el paso de cada cazoleta. Este tambi\u00e9n alimenta las c\u00e1maras y la alimentaci\u00f3n de 24Vdc la recibe del cuadro el \u00e9ctrico general. Cuadro el\u00e9ctrico entradas y salidas Este cuadro el\u00e9ctrico aloja los m\u00f3dulos de entradas y salidas del PLC que interact\u00faan entre los elementos expuestos en la m\u00e1quina calibradora y el procesador industrial PLC. Debido a la necesidad de utilizar electr\u00f3nica flexible, de alta gama, robusta, que trabaje a altas velocidades y que permita un elevado ni vel de programaci\u00f3n, he elegido la electr\u00f3nica que ofrece el fabricante de PLC's, \"Bernecker and Rainer, B&R\" 1. M\u00f3dulo de comunicaci\u00f3n X2X: Para la comunicaci\u00f3n entre los m\u00f3dulos de entradas y salidas y el PLC, requerimos de un m\u00f3dulo de comunicaci\u00f3n propia de B&R (comunicaci\u00f3n X2X , RS232). Este m\u00f3dulo es el \"X20 PS 9400\" (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 38 2. M\u00f3dulos de entradas digitales: Para la lectura de las fotoc\u00e9lulas de detecci\u00f3n de paso de cazoleta utilizamos un m\u00f3dulo de 4 entradas digitales \"X20 DI 4371\" (ver siguientes ilustraciones). TRABAJO FINAL DE CARRERA 40 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 39 3. M\u00f3dulos de salidas anal\u00f3gicas: Mediante los m\u00f3dulos de salidas anal\u00f3gicas obtendremos una se\u00f1al de 4-20mA que utilizaremos para el control de los variadores de frecuencia \"Altivar 31\" de la marca Telemecanique (se\u00f1al de entrada entre \"COM\" y \"AI3\") . Estos variadores de frecuencia ser\u00e1n los que controlen las velocidades de la calibradora, tramos de rodillos, cepilladora, alineador, pre-alineador, etc. mencionados en el apartado \"2.2. Proceso global calibraci\u00f3n\". El m\u00f3dulo de salida anal\u00f3gica es el \"X20 AO 4022\" (ver siguientes ilustraciones). Ilustraci\u00f3n 40 TRABAJO FINAL DE CARRERA 41 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 41 4. M\u00f3dulos de entradas anal\u00f3gicas: B&R dispone de unos m\u00f3dulos especialmente dise\u00f1ados para la lectura de c\u00e9lulas de carga ideal para nuestra aplicaci\u00f3n en la conexi\u00f3n de las b\u00e1sculas mencionadas anteriormente. Cada m\u00f3dulo permite la conexi\u00f3n de dos c\u00e9lulas de carga que por software podemos configurar que el resultado obtenido sea la media de la lectura de ambas entradas. El m\u00f3dulo mencionado es el \"X20 AI 1744\" (ver siguientes ilustraciones). Ilustraci\u00f3n 42 5. M\u00f3dulo de alimentaci\u00f3n: Debido al consumo de los electroimanes, requerimos del empleo de unos m\u00f3dulos dise\u00f1ados por B&R que proporcionan m\u00e1s capacidad de carga (mA) en la salidas digitales. Este m\u00f3dulo es el \"X20 PS 2100\" (ver siguiente ilustraci\u00f3n) TRABAJO FINAL DE CARRERA 42 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 43 6. M\u00f3dulos de salidas digitales: Los m\u00f3dulos de salidas digitales nos proporcionar\u00e1n la alimentaci\u00f3n de 24Vdc de los electroimanes para la activaci\u00f3n de estos en la salida deseada de la fruta. El m\u00f3dulo que utilizaremos es el \"X20 DO 8332\" (ver siguientes ilustraciones). Ilustraci\u00f3n 44 7. Otros elementos: El cuadro el\u00e9ctrico de entradas y salidas tambi\u00e9n dispondr\u00e1 de una Fuente de alimentaci\u00f3n de 24Vdc que alimentar\u00e1 la electr\u00f3nica de toda la calibradora (PLC, iluminaci\u00f3n y c\u00e1maras, m\u00f3dulos de entradas y salidas, etc.), magnetot\u00e9rmicos, bornes de conexi\u00f3n, etc. TRABAJO FINAL DE CARRERA 43 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 8. Configuraci\u00f3n de los m\u00f3dulos de entrada y salida de PLC Seg\u00fan lo expuesto anteriormente, los m\u00f3dulos de entradas y salidas quedar \u00edan instalados con la siguiente configuraci\u00f3n (ver Anexo 1, esquemas el\u00e9ctricos) Ilustraci\u00f3n 45 Ilustraci\u00f3n 46 4.2.2. Distribuci\u00f3n del hardware As\u00ed pues, la distribuci\u00f3n del hardware mencionado en el presente apartado, quedar\u00eda como la siguiente ilustraci\u00f3n (ver tambi\u00e9n esquemas el\u00e9ctricos del Anexo 1). TRABAJO FINAL DE CARRERA 44 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 47 TRABAJO FINAL DE CARRERA 45 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 4.2.3. Procesador Industrial Tal y c\u00f3mo hemos mencionado utilizaremos la electr\u00f3n ica de Bernecker and Rainer B&R que nos ofrece las caracter\u00edsticas que necesitamos en nuestra aplicaci\u00f3n. En el caso del procesador industrial he elegido el Power Panel PP4 20 (4PP420.1043-75) que adem\u00e1s de CPU tambi\u00e9n dispone de una pantalla t\u00e1ctil de 10 pulgadas TFT cuya funci\u00f3n es la de permitir que el operario interact\u00fae con la m\u00e1quina. Caracter\u00edsticas t\u00e9cnicas: N\u00famero de serie: 4PP4 20.1043-75 Power Panel 420 con pantalla t\u00e1ctil (resistiva) Resoluci\u00f3n: U SB 2.0, 1x Ethernet SD Ilustraci\u00f3n 48 Para el montaje de la pantalla he mos dise\u00f1ado una caja mec\u00e1nica gui\u00e1ndome por las medidas de la pantalla y la inclinaci\u00f3n necesaria facilitada por el fabr icante para la correcta visualizaci\u00f3n de esta (Ver siguientes ilustraciones). TRABAJO FINAL DE CARRERA 46 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 49 Ilustraci\u00f3n 50 15\u00b0 35\u00b0 40\u00b0 50\u00b0 TRABAJO FINAL DE CARRERA 47 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 4.3. Software 4.3.1. Configuraci\u00f3n del Hardware Tal y como hemos expuesto en el apartado \"4.2. Hardware\" la electr\u00f3nica de B&R dispone de una pantalla t\u00e1ctil con CPU incorporada que se comunica por X2X a trav\u00e9s de una tarjeta de comunicaci\u00f3n \" 3IF789.9-1 \" a una cabecera \"X20 PS21 00\" que a su vez se encuentra conectada a todos los m\u00f3dulos de entrad as y salidas del PLC (ver siguiente ilustraci\u00f3n). Ilustraci\u00f3n 51 TRABAJO FINAL DE CARRERA 48 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 4.3.2. M\u00f3dulos de programaci\u00f3n El programa dispone de los siguientes bloques de programaci\u00f3n que vamos a detallar a continuaci\u00f3n: Ilustraci\u00f3n 52 4.3.3. Bloque P antalla El m\u00f3dulo de pantalla es utilizado para programar la configuraci\u00f3n de la pantalla t\u00e1ctil seg\u00fan los par\u00e1metros introducidos por el t\u00e9cnico que configura la calibradora durante la instalaci\u00f3n (ver comentarios introducidos durante la programaci\u00f3n resaltado en amarillo). (******************************************************************** * COPYRIGHT -- ******************************************************************** * Program: Pantalla * File: PantallaCyclic.st * Author : Cruz * Created: February 23, 2010 ******************************************************************** * Implementation of program Pantalla ********************************************************************) TRABAJO FINAL DE CARRERA 49 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO PROGRAM _CYCLIC (*--------------- --------------------------- Escoger pantalla para configurar Pantalla_Select_Conf_Electroiman[8]:=0; ELSE Pantalla_Select_Conf_Electroiman[8]:=1; END_IF TRABAJO FINAL DE CARRERA 50 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (*------------------------------------ Pantallas emergentes y memoria de OR EDGEPOS(Button_Variedad_DOWN)) THEN Variedad_de_la_Fruta_Lectura:=Variedad_de_la_Fruta_Memoria[Numero_V ariedad]; END_IF Variedad_de_la_Fruta_Memoria[Numero_Variedad]:=Variedad_de_la_Fruta_Lectura; Pantalla_Emerg_Guardar_Variedad:=1; END_IF (*-------------------------- ---------------- Guardar y leer (EDGEPOS(Button_Grado_UP)) EDGEPOS(Button_Mantenimiento) Nivel_Password_Actual>=1 THEN Cambiar_Pantalla:=300; ELSIF EDGEPOS(Button_Mantenimiento) AND Nivel_Password_Actual=0 THEN Pantalla_Emergente_Password:=0; TRABAJO FINAL DE CARRERA 51 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Button_Mantenimiento_Avanzado, r el nivel del Password a cero IF Nivel_Password_Actual > 0 THEN Password_Activado:=TRUE; END_IF IF EDGEPOS(Timer_Password.Q) := Password_Activado, PT := := Estadisticas_por_Calibre.Modo_de_Calibracion; TRABAJO FINAL DE CARRERA 52 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Pantalla_Emerg_Guarda_Agric ultor:=1; Guardar_Agricultor:=FALSE; END_IF (*----------------------------------------- LOS este m\u00f3dulo generamos pulsaciones en un bit con un periodo de 1 segundo para utilizarlo en numerosas ocasiones en la implementaci\u00f3n de todo el programa. Para ello requeriremos programar este m\u00f3dulo para que se ejecute cada 1000ms (1 segundo). Ilustraci\u00f3n 53 TRABAJO FINAL DE CARRERA 53 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (******************************************************************** * COPYRIGHT -- ******************************************************************** * Program: Clock_1seg of program Clock_1seg ********************************************************************) (*--------------------------- GENERAMOS LOS PULSOS CADA QUE SE ------*) PROGRAM _CYCLIC Clock_1seg := NOT Clock_1seg; END_PROGRAM 4.3.5. C\u00e1lculo c\u00e1maras Este es uno de los m\u00f3dulos m\u00e1s importantes que requerimos para nuestra aplicaci\u00f3n debido a que este m\u00f3dulo, con los datos recibidos de la CPU de las c\u00e1maras, cada vez que reciba los pulsos de detecci\u00f3n de paso de cazoleta (a trav\u00e9s de las fotoc\u00e9lulas) realizar\u00e1 los c\u00e1lculos necesarios para asignarle a la fruta la salida seg\u00fan lo configurado por el operario en la pantalla t\u00e1ctil. (******************************************************************** * COPYRIGHT -- * File: Caluculo_Camaras.st Author: * 12, of DE PASO DE CAZOLETA ---------------------*) IF EDGEPOS(gControl.User.WeighPerformed) THEN TRABAJO FINAL DE CARRERA 54 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (* ----------------------------------- C\u00c1LCULO C\u00c1MARAS LINEA 1- 4 ------------------------------------------------------------------------ *) IF (Pantalla_Layaut.Modo_de_Calibracion=3 OR Pantalla_Layaut.Modo_de_Calibracion=6) THEN con di\u00e1metro FOR j:=1 TO (Config_Numero_Lineas) DO //Para el n\u00famero de l\u00ednea (* Calibraci\u00f3n por di\u00e1metro Mayor *) IF Select_Modo_Diametro=0 THEN // calibraci\u00f3n por di\u00e1metro *) IF Select_Modo_Diametro=1 THEN // calibraci\u00f3n por di\u00e1metro menor IF (((Ca maras_Grado.Linea[j].Posicion_4.Diametro_Min Average.Linea[j].Posicion_3.Diametro) (Average.Linea[j].Posicion_3.Diametro = 0)) := Average.Linea[j].Posicion_2.Diametro; TRABAJO FINAL DE CARRERA 55 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO END_IF IF (((Camaras_Grado.Linea[j].Posicion_2.Diametro_Min < Average.Linea[j].Posicion_1.Diametro) (Average.Linea[j].Posicion_1.Diametro calibraci\u00f3n por contador_posicion_2[j] := contador_posicion_1[j]; END_IF TRABAJO FINAL DE CARRERA 56 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (* POSICION CAZOLETA 1 Guardamos el di\u00e1metro esperando el n\u00famero de posiciones para llegar a las b\u00e1sculas y calcular la salida *) (*****************************************************************************************************************************) PositionOffset := UINT_TO_REAL((gLine[p].ActPosition- 1)) + INT_TO_REAL(gControlExit[p].User.Positi onExit[0].NumberPulses); (PosExit(i) (ActPos -1)) - MaxPos *) ELSE := UINT_TO_REAL(gLine[p].ActPosition- 1) + INT_TO_REAL(gControlExit[p].User.PositionExit[0].NumberPulses); (* 4 DO Calculos_Linea[p].Numero_de_Salida:=0; END_FOR END_IF TRABAJO FINAL DE CARRERA 57 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO END_FOR (*-------------------------------------------------- C\u00c1LCULO DEL --------------------- -------------------------------------------*) IF Hacer_Test_Completo=FALSE AND Button_Test_por_Salida=FALSE THEN // C\u00e1lculo del calibre por DI\u00c1METRO IF (Pantalla_Layaut.Modo_de_Calibracion=3 OR Pantalla_Layaut.Modo_de_Calibracion=4) THEN FOR p:=1 TO (Config_Numero_Lineas) DO //Para n\u00famero de l\u00ednea FOR m:=1 TO (INT_TO_USINT(Variedad_de_la_Fruta_Lectura.Numero_de_Grados) + 1) DO //Para n\u00famero del calibre IF m < (Variedad_de_la_Fruta_Lectura.Numero_de_Grados + 1) THEN IF (Diametro[p] >= Variedad_de_la_Fruta_Lectura.Diametro_del_Grado[m]) Calculos_Linea[p].Peso_Actual > 15 THEN END_FOR p:=1 TO (Config_Numero_Lineas) DO gControlExit[p].User.ExitForcedPosition_Auto := Calculos_Linea[p].Numero_de_Calibre:= 0; END_FOR END_IF END_PROGRAM TRABAJO FINAL DE CARRERA 58 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 4.3.6. Layaut salidas Este modulo ser\u00e1 el que contenga el c\u00f3digo de programa para la gesti\u00f3n de la pantalla (que interact\u00faa con el operario de la calibradora) de asignaci\u00f3n de las salidas de cada calibre. (****************** ************************************************** * COPYRIGHT -- ******************************************************************** * Program: Layaut_Salidas.st * BOTON DE ASIGNACI\u00d3N DE SALIDA SE RESETEAN CARRERA 59 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO FINAL DE CARRERA 60 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO FINAL DE CARRERA 61 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA TRABAJO FINAL DE CARRERA 62 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA CARRERA 63 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO CARRERA 64 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Button_Select_Salida[11]:=FALSE; Button_Select_Salida[12]:=FALSE; Button_Select_Salida[13]:=FALSE; Button_Select_Salida[14]:=FALSE; Button_Select_Salida[16]:=FALSE; END_IF (*---- PROGRAMACI\u00d3N DE COLORES LETRA SEG\u00daN LO SELECCIONADO POR EL OPERARIO ---*) // Para boton de salida //Color rojo ELSE Salida_Activada[7]:=28; //Color negro END_IF TRABAJO FINAL DE CARRERA 65 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO // Para boton de salida 8 IF Button_Select_Salida[8]=TRUE rojo ELSE Salida_Activada[15]:=28; //Color negro END_IF TRABAJO FINAL DE CARRERA 66 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (*------------------------------------- Pulsadores de seleccionar CARRERA 67 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO TRABAJO FINAL DE CARRERA 68 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA TRABAJO FINAL DE CARRERA 69 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA CARRERA 70 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO CARRERA 71 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR morado ELSE Calibre_Activado[1]:=88; //Color negro END_IF TRABAJO FINAL DE CARRERA 72 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO // Para boton de Calibre 2 IF Button_Select_Calibre[2]=TRUE //Color mor ado ELSE Calibre_Activado[9]:=88; //Color negro END_IF TRABAJO FINAL DE CARRERA 73 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO // Para boton de Calibre 10 IF Button_Select_Calibre[10]=TRUE Valor_Guardado:=0; END_IF TRABAJO FINAL DE CARRERA 74 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO IF Asignar_Salida=TRUE THEN FOR g:=1 TO 20 DO //comprobamos que el valor no est\u00e9 ya asignado en la salida IF Layaut_Salida[Indice_Numero_Salida].Calibre[g]=Indice_Numero_Calibre THEN //en el caso de que calibremos solo por peso o por di\u00e1metro IF (Pantalla_Layaut.Modo_de_Calibracion=0 OR Pantalla_Layaut.Modo_de_Calibracion=3) THEN Valor_Existe:=TRUE; END_IF FOR END_FOR FOR k:=1 TO 20 DO //si el v alor no existe en la lista entonces lo asignamos IF (Layaut_Salida[Indice_Numero_Salida].Calibre[k]=0) ----------------------------- *) IF EDGEPOS(Button_Borrar_Salida) THEN Borrar_de_Salida:=TRUE; Borrado_de_Salida:=FALSE; TRABAJO FINAL DE CARRERA 75 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Salida_no_Asignada:=FALSE; END_IF IF Borrar_de_Salida=TRUE THEN FOR a:=1 TO 20 DO IF (Layaut_Salida[Indice_Numero_Salida].Calibre[a]=Indice_Numero_Calibre AND Borrado_de_Salida=FALSE) THEN FOR b:=1 TO 20 Pantalla_Emerg_Salida_no_Asig:=1; END_IF (*--------------- PASAR TODAS LOS CALIBRES ASIGNADOS A STRING PARA VISUALIZAR EN PANTALLA ----------- *) IF EDGEPOS(Button_Asignar_Salida) OR EDGEPOS(Button_Borrar_Salida) OR EDGEPOS(Button_Borrar_Todo) THEN strcp FOR IF (Pantalla_Layaut.Modo_de_Calibracion=1 OR Pantalla_Layaut.Modo_de_Calibracion=2 OR Pantalla_Layaut.Modo_de_Calibracion=4 OR Pantalla_Layaut.Modo_de_Calibracion=5) THEN TRABAJO FINAL DE CARRERA 76 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO // Modo de calibraci\u00f3n: 1=Peso y color, 2=Peso color y di\u00e1metro, 4=Di\u00e1metro la pantalla de layaut seg\u00fan lo que tenemos configurado en el modo de calibraci\u00f3n ---------*) // bloquemaos la opci\u00f3n de grado si solo tenemos peso o di\u00e1metro IF (Pantalla_Layaut.Modo_de_Calibracion=0 OR Pantalla_Layaut.Modo_de_Calibracion=3) THEN Bloquear_grado:=1; ELSE ELSE Bloquear_peso:=1; END_IF (*--------------------- MEMORIZAR LOS DATOS DE LA PANTALLA LA YAUT EN LA MEMORIA -- ---------------------------*) END_IF TRABAJO FINAL DE CARRERA 77 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (*----------------------------------- GUARDAR LAYAUT //Para todas las salidas Pantalla_Layaut_Memoria[Numero_Layaut].Salidas_Asignadas[j].Conteo:=Layaut_Salida[j].Conteo; FOR i:=1 TO 20 DO //Para la //Para todas las salidas Layaut_Salida[j].Conteo:=Pantalla_Layaut_Memoria[Numero_Layaut].Salidas_Asignadas[j].Conteo; FOR i:=1 TO 20 DO //Para la posici\u00f3n de cada salida Layaut_Salida[j].Calibre[i]:=Pantalla_Layaut_Memoria[Numero_Layaut].Salidas_Asignadas[j].Calibre[i]; Layaut_Salida[j].Grado[i]:=Pantalla_Layaut_Memoria[Numero_Layaut].Salidas_Asignadas[j].Grado[i]; END_FOR END_FOR // Despu\u00e9s de leer todos los datos de la memoria escribimos los strings de las salidas para la visualizaci\u00f3n FOR j:=1 TO (Config_Numero_Salidas + 1) DO //Para todas las salidas strcpy(ADR(strSalida[j]),ADR('')); //Ponemos a cero c ada salida antes de escribir el valor de las salidas TRABAJO FINAL DE CARRERA 78 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO FOR i:=1 TO 20 DO //Para la posici\u00f3n de cada salida IF Layaut_Salida[j].Calibre[i]<>0 THEN strcat(ADR(strSalida[j]),ADR(Variedad_de_la_Fruta_Lectura.Nombre_del_Grado[Layaut_Sal ida[j].Calibre[i]])); // si el modo de calibraci\u00f3n tambi\u00e9n es con grado entonces tambi\u00e9n leemos el grado IF (Pantalla_Layaut.Modo_de_Calibracion=1 OR Pantalla_Layaut.Modo_de_Calibracion=2 OR Pantalla_Layaut.Modo_de_Calibracion=4 OR Pantalla_Layaut.Modo_de_Calibracion=5) THEN // Modo calibraci\u00f3n: 1=Peso y color, 2=Peso color y di\u00e1metro, 4=Di\u00e1metro -------------------*) IF EDGEPOS(Button_Asignar_Salida) OR EDGEPOS(Button_Borrar_Salida) OR OR EDGEPOS(Button_Layaut_DOWN) THEN FOR j:=0 TO 16 DO // Para cada calibre Calibre_Asignado[j]:=0; END_F OR FOR j:=1 TO (Config_Numero_Salidas + 1) DO //Para n\u00famero de salidas FOR i:=1 TO 20 DO //Para cada posici\u00f3n de cada salida IF Layaut_Salida[j].Calibre[i] = 1 THEN Calibre_Asignado[1] := Calibre_Asignado[1] + 1; + 1; ELSIF Layaut_Salida[j].Calibre[i] = 9 THEN TRABAJO FINAL DE CARRERA 79 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Calibre_Asignado[9] := Calibre_Asignado[9] + 1; 16 DO IF Calibre_Asignado[j]>0 THEN //Si no hemos encontrado el calibre en ninguna posici\u00f3n (de 0 a 20) en ninguna salida, entonc es cambiamos el texto de color Color_Calibre_Asignado[j]:=15; //fondo de color blanco (significa salida asignada) ELSIF Calibre_Asignado[j]=0 AND Variedad_de_la_Fruta_Lectura.Numero_de_Grados >= j THEN Color_Calibre_Asignado[j]:=50; //Texto de la pantalla del calibre de color rojo (significa que no tiene ninguna salida asignada). Tambien se verifica en la rutina de alarmas END_IF END_FOR END_IF END_PROGRAM As\u00ed pues, la pantalla de configuraci\u00f3n de asignaci\u00f3n de salidas del operario quedar\u00eda de l siguiente modo: TRABAJO FINAL DE CARRERA 80 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Ilustraci\u00f3n 54 4.3.7. Alarmas Con el m\u00f3dulo de alarmas gestionamos todas las alarmas que notificaremos por la pantalla t\u00e1ctil a operario e incluso seg\u00fan que alarma sea pararemos la calibradora a trav\u00e9s de una salida digital del PLC y un rel\u00e9 conectado al variador de frecuencia del motor principal de la calibradora. (******************************************************************** * COPYRIGHT -- ******************************************************************** * Program: Alarms.st * Author: * 20, ******************************************************************** * Implementation of program Alarms ********************************************************************) PROGRAM _INIT (* TODO : Add your code here *) END_PROGRAM TRABAJO FINAL DE CARRERA 81 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO PROGRAM _CYCLIC // comprovar si hay alguna alarma activada y parpadear un aviso en la pantalla Alarma_Activada:=1; FOR i:=0 TO 50 DO IF Alarma[i]=TRUE Alarma DI4_Camaras_Estado_Error=TRUE THEN Alarma[2]:=FALSE; END_IF // Alarma [4] calibres sin salida IF EDGEPOS(gControl.User.di_Trigger) AND Alarma[4]=FALSE THEN FOR k:=1 TO Variedad_de_la_Fruta_Lectura.Numero_de_Grados Config_Peso_Minimo_Cazoleta AND Config_Numer o_Lineas >= 2) THEN Alarma[6]:=TRUE; TRABAJO FINAL DE CARRERA 82 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO END_IF // Alarma [7] paso cazoletas en l\u00ednea 50 AND Button_Desactivar_Alarma=FALSE THEN Rele_Seguridad_Calibradora:= FALSE; ELSE TRABAJO FINAL DE CARRERA 83 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Rele_Seguridad_Calibradora:= TRUE; END_IF END_PROGRAM 4.3.8. Estad\u00edsticas El m\u00f3dulo de estad\u00edsticas lo requerimos para imprimir y guardar todos los datos de de la fruta que ha procesado la calibradora durante un trabajo (nombre del cliente, n\u00famero de piezas por calibre, n\u00famero de piezas por salida, etc.) (******************************************************************** * COPYRIGHT -- ******************************************************************** * Program: Estadisticas * File: Estadisticas.s t * Author: Cruz * Created: March 24, 2010 ******************************************************************** END_FOR FOR i:=0 T O 16 DO END_FOR (* LEER LA FECHA Y HORA DEL PLC *) DTGetTime_0(enable := 1); Date_Time := DTGetTime_0.DT1; (* The Date and Time type is broken independly *) TRABAJO FINAL DE CARRERA 84 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO DT_TO_DTStructure(Date_Time, ADR(Date_Time_Structure)); (* To each part of the Date and Time is assigned fecha y hora en las variables de estad\u00edsticas // Hora de inicio strcpy(ADR(Estadisticas_por_Calibre.Hora_de_Inicio),ADR('')); strcat(ADR(Estadisticas_por_Calibre.Hora_de_Inicio),ADR(strHour)); i:=0 TO 20 DO Estadisticas_por_Calibre.Piezas_por_Calibre[i]:=0; Estadisticas_por_Calibre.Peso_por_Calibre_Gramos[i]:=0; END_FOR TRABAJO FINAL DE CARRERA 85 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Estadistica s_por_Calibre.Peso_Total:=0; Estadisticas_por_Calibre.Piezas_Total:=0; END_IF (*------------------------------------------------- FIN DE ESTAD\u00cdSTICAS -----------------------------------------------*) el fin de estad\u00edsticas imprimimos todos los dtos a trav\u00e9s de una impresora ----------------------------*) IF EDGENEG(Button_Iniciar_Estadisticas) THEN (* LEER LA FECHA Y HORA DEL PLC *) DTGetTime_0(enable := 1); Date_Time := DTGetTime_0.DT1; (* The Date and Time type is broken independly *) DT_TO_DTStructure(Date_Time, ADR(Date_Time_Structure)); (* Para cada una de las partes de la fecha y hora es asignada una palabra STRING *) itoa(Date_Time_Structure.day,ADR(strDay)); itoa(Date_Time_Structure.month,ADR(strMonth)); itoa(Date_Time_Structure.year,ADR(strYear)); itoa(Date_Time_Structure.hour,ADR(strHour)); itoa(Date_Time_Structure.minute,ADR(strMinute)); itoa(Date_Time_Structure.second,ADR(strSecond)); // Copiamos los datos hora en las variables de estad\u00edsticas strcpy(ADR(Estadisticas_por_Calibre.Hora_de_Fin),ADR('')); strcat(ADR(Estadisticas_por_Calibre.Hora_de_Fin),ADR(strHour)); strcat(ADR(Estadisticas_por_Calibre.Hora_de_Fin),ADR(':')); strcat(ADR(Estadisticas_por_Calibre.Fecha_de_Fin),ADR('/')); strcat(ADR(Estadisticas_por_Calibre.Fecha_de_Fin),ADR(strYear)); TRABAJO FINAL DE CARRERA 86 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO DTGetTime_0(enable := 0) ; Recipe:=Estadisticas_por_Calibre; END_IF THEN TO strYear='2012' THEN TRABAJO FINAL DE CARRERA 87 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO strcat(ADR(NuevoNombre),ADR('s')); strcat(ADR(NuevoNombre),ADR('_')); strcat(ADR(NuevoNombre),ADR(Estadisticas_por_Calibre.Nombre_Agricultor)); TRABAJO FINAL DE CARRERA 88 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO END_IF // Enviamos se\u00f1al -- -----------------------------*) IF EDGEPOS(Leer_Recipe) THEN Esperar_Datos:=TRUE; 4.3.9. estad\u00edsticas Con el m\u00f3dulo de c\u00e1lculos de estad\u00edsticas calculamos los valores que posteriormente guardamos en el bloque \"Estad\u00edsticas\" antes descrito. TRABAJO FINAL DE CARRERA 89 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO (******************************************************************** * COPYRIGHT -- ******************************************************************** * Program: Calculos_Estadisticas * Implementation of program Calculos_Estadisticas ********************************************************************) PROGRAM _INIT (* TODO : Add your code here *) END_PROGRAM PROGRAM _CYCLIC (*-------------------------- ------ CALCULAMOS TODOS as_por_Calibre.Piezas_por_Calibre[2] FOR TO 16 DO IF Peso_Total 0 THEN Estadisticas_por_Calibre.Porcentaje_Peso_por_Calibre[i]:=100*Estadisticas_por_Calibre.Peso_por_Calibre[i ] / Peso_Total; ELSE Estadisticas_por_Calibre.Porcentaje_Peso_por_Calibre[i]:=0; END_IF IF Piezas_Total > 0 THEN TRABAJO FINAL DE CARRERA 90 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Estadisticas_por_Calibre.Peso_por_Calibre[i]:=Estadisticas_por_Calibre.Peso_por_Calibre_Gramos[i]/1000; END_FOR END_PROGRAM 4.3.10. Bloque Server El bloque de programa server contiene el c\u00f3digo que abre el puerto de comunicaci\u00f3n TCP server, recibe los datos de la CPU de las c\u00e1maras y los convierte a variables del tipo real para que posteriormente las gestionamos en el bloque \"C\u00e1lculo C\u00e1maras\" antes descrito. (******************************************************************** * COPYRIGHT -- Bernecker + ******************************************************************** * Program: Server * File: Server.st Author: * Created: February 21, ******************************************************************** * Implementation of program Server _CYCLIC CASE Server.sStep OF 0: (* PASO 0: LA DE *) Server.TcpOpen_0.enable := 1; := 0; (* Listen on Port listen*) Server.TcpOpen_0; (* Call the not finished - > redo *) ELSE (* VAMOS AL PASO DE ERROR *) Server.sStep := 100; END_IF 5: Server.linger_opt.lLinger := 0; (* linger Time = 0 *) TRABAJO FINAL DE CARRERA 91 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Server.linger_opt.lOnOff := := 10; ELSIF Server.TcpIoctl_0.status = ERR_FUB_BUSY THEN (* TCP NO FINALIZADO *) (* OCUPADO *) ELSE (* VAMOS A PASO ERROR *) Server.sStep := 100; END_IF 10: (* ESPERAMOS PARA CONEXI\u00d3N := 1; CLIENTES ESPERANDO CONEXI\u00d3N SIMULTANEA *) Server.TcpServer_0.pIpAddr := ADR(Server.client_address); (* DONDE ESCRIBIR LA DIRECCI\u00d3N IP DEL CLIENTE *) Server.TcpServer_0; (* LLAMAR FUNCI\u00d3N*) IF Server.TcpServer_0.status = 0 THEN (* Status = 0 SI UN CLIENTE CONECTADO A SERVIDOR *) Server.sStep := 15; ELSIF Server.TcpServer_0.status = ERR_FUB_BUSY THEN (* TCP SERVER NO FINALIZADO *) (* OCUPADO *) ELSE (* VAMOS A PASO ERROR, PASO 100 *) Server.sStep := 0 THEN (* TCP FINALIZADO *) Server.sStep := 20; TRABAJO FINAL DE CARRERA 92 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO ELSIF Server.Tc pIoctl_0.status = ERR_FUB_BUSY THEN (* TCP NO FINALIZADO *) (* OCUPADO *) ELSE (* VAMOS A PASO ERROR *) Server.sStep := 100; END_IF 20: (* Server_0.identclnt; Server.TcpRecv_0.pData := ALMACENAMOS LOS DATOS RECIBIDOS *) Server.TcpRecv_0.datamax := SIZEOF(Server.data_buffer); (* LONGITUD DEL BUFFER DE LOS DATOS RECIBIDOS *) Server.TcpRecv_0.flags := 0; Server. TcpRecv_0; (* LLAMAR LA FUNCI\u00d3N*) IF Server.TcpRecv_0.status = 0 THEN (* DATOS RECIBIDOS *) IF counter > 8 THEN (*----------------- CONVERTIMOS TODOS LOS DATOS DE STRING RECIBIDOS CARRERA 93 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA := REAL_TO_INT(Camaras_Grado_REAL.Linea[i].Posicion_4.Diametro_Min); TRABAJO FINAL DE CARRERA 94 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO i:=2; := REAL_TO_INT(Camaras_Grado_REAL.Linea[i].Posicion_4.Diametro_Avg); TRABAJO FINAL DE CARRERA 95 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO Camaras_Grado.Linea[i].Posicion_4.Diametro_Max EN ESTE PASO IMPLEMENTAMOS LO QUE QUEREMOS EN CASO DE ERROR DE COMUNICACI\u00d3N *) Server.sStep := 100; (*INICIALIZAMOS OTRA VEZ LA COMUNICACI\u00d3N, PASO 0*) END_CASE END_PROGRAM TRABAJO FINAL DE CARRERA 96 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 5. PRESUPUESTO 5.1. Presupuesto mec\u00e1nico Para la instalaci\u00f3n del equipo electr\u00f3nico en la calibradora requerimos de una caja mec\u00e1nica donde ubicar las c\u00e1maras y otra donde ubicar la CPU con pantalla t\u00e1ctil. 5.1.1. Conjunto caja c\u00e1maras Descri pci\u00f3n Proveedor Unidades P. Unitario P. Total CONJUNTO MEC\u00c1NICO CAJA DE CAMARAS Perfil Bosch 45x45L R L=850mm Alutecman 9,00 0,50 4,50 Tuerca para cab. martillo Bosch M6 Alutecman 9,00 0,13 DIN 912 DIN 912 M4x25 Puig 12,00 0,03 0,30 Platina uni\u00f3n perfiles 0,02 0,84 Tornillo 2 caja de c\u00e1maras 3 Tornillo ISO 5,39 PRECIO TOTAL: 833,05 \u20ac Tabla 2 TRABAJO FINAL DE CARRERA 97 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 5.1.2. Conjunto caja de CPU Descripci\u00f3n Proveedor Unidades P. Unitario P. Total CON JUNTO MEC\u00c1NICO CAJA PANTALLA T\u00c1CTIL + CPU Caja pantalla B&R 446,00 \u20ac Tabla 3 5.2. Presupuesto el\u00e9ctrico electr\u00f3nico Para la implementaci\u00f3n de la parte electr\u00f3nica trabajaremos con tres proveedores: JasVision : Material de visi\u00f3n artificial Cuadro el\u00e9ctrico c\u00e1maras: ACE Aparellajes y Cuadros El\u00e9ctricos Bernecker & Reiner B&R: Electr\u00f3nica PLC Cuadro el\u00e9ctrico m\u00f3dulos PLC : ACE Aparell ajes y Cuadros El\u00e9ctricos 5.2.1. Material visi\u00f3n artificial Descripci\u00f3n Proveedor Unidades P. Unitario P. Total MATERIAL VISI\u00d3N ARTIFICIAL Sherlock 7.x Prof. Lic. USB \u20ac Tabla 4 TRABAJO FINAL DE CARRERA 98 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 5.2.2. Cuadro el\u00e9ctrico visi\u00f3n artificial Descripci\u00f3n Proveedor Unidades P. Unitario P. Total CUADRO EL\u00c9CTRICO VISI\u00d3N ARTIFICIAL Magnetot\u00e9rmico ACE 1,00 67,00 67,00 573,72 \u20ac 5.2.3. Electr\u00f3nica PLC Descripci\u00f3n Proveedor Unidades P. Uni tario P. Total ELECTR\u00d3NICA PLC POWER Tabla 5 5.2.4. Cuadro el\u00e9ctrico PLC Descripci\u00f3n Proveedor Unidades P. Unitario P. Total CUADRO EL\u00c9CTRICO M\u00d3DULOS ENTRADAS Y SALIDAS PLC Seccionador ACE 1,00 luminoso amarillo ACE rojo ACE 4,25 106,25 PRECIO TOTAL: 995,11 \u20ac TRABAJO FINAL DE CARRERA 99 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 5.3. Presupuesto TOTAL Descripci\u00f3n Proveedor Unidades P. Unitario P. Total PRESUPUESTO TOTAL Conjunto caja de c\u00e1maras ELPA 1,00 833,05 833,05 Conjunto caja artificial PLC B&R 1,00 995,11 PRECIO TOTAL: 13.956,27 \u20ac Como podemos apreciar, el costo total de la impleme ntaci\u00f3n del sistema de visi\u00f3n artificial y el control autom\u00e1tico de la calibradora ( visi\u00f3n artificial y CPU principal) asciende a 14.000\u20ac . Conociendo el mercado, sabemos que un sistema que calibraci\u00f3n de la fruta solo por peso tiene un valor medio de 25.00 0\u20ac, con lo que estimo que el presente proy ecto podr\u00edamos estar ofreci\u00e9ndolo por 35.000\u20ac disponiendo, por lo tanto, de un margen de contribuci\u00f3n de 21.000\u20ac , es decir, con este proyecto estamos consiguiendo una rentabilidad del 250%. 6. CONCLUSIONES Con todo l o explicado en el presente documento, se pueden considerar definidas las caracter\u00edsticas y condiciones que reunir\u00e1 el m\u00f3dulo de visi\u00f3n artificial en la parte el\u00e9ctrica, mec\u00e1nica y autom\u00e1tica para la consecuci\u00f3n del proyecto. Es importante tener muy presente que con el proyecto desarrollado podemos superar sin el menor inconveniente los objetivos en producci\u00f3n, productividad, y el est\u00e1ndar de calidad reduciendo considerablemente los costos en la mano de obra. Cabe destacar que adem\u00e1s de la reducci\u00f3n de la mano de obra y costos fijos tambi\u00e9n conseguimos un trato mejorado con la fruta resultando en una mayor calidad de esta en el producto final embasado y calibrado. As\u00ed pues, gracias a este proyecto podemos obtener mayores velocidades de calibraci\u00f3n, con menor es costos de producci\u00f3n, mayor fiabilidad en los resultados de calibraci\u00f3n y un mejor trato con el producto ya que no es necesario el empleo de la mano de obra para la consecuci\u00f3n de la debida calibraci\u00f3n de la fruta, verdura y hortalizas. 6.1. Futuros proyectos Una buena idea para la consecuci\u00f3n de futuros proyectos es la de desarrollar sistemas de visi\u00f3n artificial que detecten el da\u00f1o en la fruta causado por golpes durante la cadena de procesamiento de esta, que al ojo humano no es detectable hasta que esta y a se TRABAJO FINAL DE CARRERA 100 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO encuentra al final de la cadena, es decir, cuando esta ya se encuentra en la fase de distribuci\u00f3n final (los puntos de distribuci\u00f3n, tiendas, accesibles al consumidor final). Con el empleo de esta tecnolog\u00eda se podr\u00edan evitar grandes p\u00e9rdidas econ\u00f3mic as y una mejora altamente significativa en la calidad del producto final accesible al consumidor. Otro proyecto considerado altamente \u00fatil podr\u00eda ser la de desarrollar sistemas de visi\u00f3n artificial que detecten el nivel de az\u00facar en la fruta de modo que nos permita que esta sea seleccionada y/o clasificada seg\u00fan su contenido de az\u00facar. 7. BIBLIOGRAF\u00cdA 7.1. Calibraci\u00f3n y envases de fruta - Hortyfruta; Junta de Andaluc\u00eda (2008). Tipificaci\u00f3n, Requisitos m\u00ednimos de calidad de frutas y hortalizas Disponible en: http://hortyfruta.es/Images/folletotipificacion.pdf - InfoAgro Systems, S.L. (2010). Calibre universal para fruta http://www.paletplastic.es/articulos.php?tipo=palots&subtipo=0 - Ministerio de Agricultura, Alimentaci\u00f3n y Medio Ambiente (2012). Maquinaria Agricola http://www.magrama.gob.es/app/mecanizacion/fichamaquinaria.aspx?n1=8&n2=2& n3=0&n4=0 - Palet Plastic (2011). Cat\u00e1logo de palots. http://www.paletplastic.es/articulos.php?tipo=palots&subtipo=0 7.2. Visi\u00f3n artificial - JasVisio (2010). Visi\u00f3n artificial aplicada a la industria. http://www.jasvisio.com/aplicaciones -vision -artificial -industria.html - Faico, Contro de innovaci\u00f3n y tecnolog\u00eda (2011). \u00c1rea de tecnolog\u00edas de visi\u00f3n artificial. http://www.faico.org/seccion/visionartificial/ TRABAJO FINAL DE CARRERA 101 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO - Universidad de C\u00f3rdoba; Prof. Dr. Fern\u00e1ndez N. L. (2011). Introducci\u00f3n a l a visi\u00f3n artificial. Visi\u00f3n Artificial Avanzada Disponible en: http://www.uco.es/users/ma1fegan/2011-2012/vision/Temas/Vision-artificial.pdf 7.3. Sistemas de iluminaci \u00f3n - As\u00ed Funciona, SL (2004). Que es un LED http://www.asifunciona.com/fisica/ke_led/ke_led_5.htm - Ofiled (2013). Ventajas de la iluminaci\u00f3n LED http://www.ofiled.com/led/ventajas -de-la -iluminacion-led - Led Planet, S.L. (2007). Las 5 Ventajas LED http://www.ofiled.com/led/ventajas -de-la -iluminacion-led - TodaCultura (2009). Luz Infrarroja http://www.todacultura.com/glosarioacuarela/luzinfrarroja.htm (2009). \u00bfQu\u00e9 es el infrarrojo? http://legacy.spitzer.caltech.edu/espanol//edu/ir/infrared.html - Bachelor of Science in Public Health, BSPH ; Prof. Colon de Jorge C. M. (2009). Aplicaciones de la radiaci\u00f3n infrarroja. Disponible en: http://www.slideshare.net/naturopatia/aplicaciones -de-la -luz-infra-roja 7.4. Hardware - http://www.teledynedalsa.com/imaging/products/cameras/area-scan/genie/ - Teledyne Dalsa (2013). Cat\u00e1logo PC Geva http://www.teledynedalsa.com/imaging/products/va/ - Machine Building (2010). GEVA compact vision PC supports multiple cameras http://www.machinebuilding.net/p/p3539.htm TRABAJO FINAL DE CARRERA 102 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO - Electan (2006). Solenoide / Electroim\u00e1n http://www.electan.com/datasheets/cebek/C -6092.pdf - National Instruments Corporation (2008). C\u00f3mo hacer medidas con c\u00e9lulas de carga o transductores de presi\u00f3n http://www.ni.com/white-paper/7138/es - HBM Espa\u00f1a (2010). C\u00e9lulas de carga de HBM: la soluci\u00f3n correcta para cualquier aplicaci\u00f3n -ENG.pdf TRABAJO FINAL DE CARRERA 103 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO - B&R Sherlock System Software http://www.teledynedalsa.com/imaging/products/software/sherlock/ - Stemmer Imaging, Ltd. (2013). DALSA Sherlock - Machine vision software for industry http://www.stemmer -imaging.co.uk/en/products/line/dalsa.sherlock - B&R (2012). Automation Studio http://www.br -automation.com/en/products/software/ 7.6. Sistemas de comunicaci\u00f3n - Gale on (2011 ). Protocolo TCP/IP http://protocolotcpip.galeon.com/ - Microsoft (2013). Componentes de red y protocolos TCP/IP de nueva generaci\u00f3n http://technet.microsoft.com/es -es/library/cc754287(v=ws.10).aspx TRABAJO FINAL DE CARRERA 104 ERICO CRUZ LEMUS SISTEMA ELECTR\u00d3NICO DE CALIBRACI\u00d3N DE FRUTA POR DI\u00c1METRO 8. ANEXOS 8.1. ANEXO 1: Esquemas el\u00e9ctricos 8.2. ANEXO 2: Planos mec\u00e1nicos 8.2.1. Soportes c\u00e1maras 8.2.2. Soportes barras de LED 8.2.3. Estructura campana c\u00e1maras 8.2.4. Conjunto campana c\u00e1maras 8.2.5. Conjunto caja pantalla PLC A 8.2.6. Conjunto caja pantalla PLC B TRABAJO FINAL DE CARRERA 105 ANEXOS ANEXO 1: Esquemas el\u00e9ctricos ANEXO 2: Planos mec\u00e1nicos Soportes c\u00e1maras Soportes barras de LED Estructura campana c\u00e1maras Conjunto campana c\u00e1maras Conjunto caja pantalla PLC A Conjunto caja pantalla PLC C\u00f3digo Cantidad 1 Caja pantalla B&R PP420 1 2 Power Panel 4 5 Montage TEG M25x1.5 6 ISO 8 Arandela DIN M6 T010000003 2 9 Tornillo DIN 912 M6x10 T040000017 2 10 Montage TEG indicacion de toleranciahasta 6mas de 6 hasta 30mas de 30 hasta 120mas de 120 hasta 315mas de 315 hasta 1000mas de 1000 hasta 2000mas de 2000 hasta 4000mas de 4000 hasta SUSTITUIDO NUEVO N\u00b0 -- - FECHA-NOMBRE -- Sin indicacion las aristas seran 0,5mm a 45\u00b0. Sin indicacion las esquinas seran a 0,5mm R. Las medidas ( ) no tienen importancia. Las medidas seran expres. verificadas. Sin indicacion expresa roscas de calidad 6 (media) Tuercas 6H y Tornillos 6g. CONJUNTO FECHA NOMBRE MAQUINA$1(;2\u0003\u0015 8.2.5. &RQMXQWR\u0003&DMD\u0003SDQWDOOD\u00033/&\u0003$ 1(.\u0003&UX] de&3*$0\u0001$36;\u0001-&.64445303 0.5 M4R8 DETALLE A ESCALA 2 : 5 6,5 DETALLE B ESCALA 2 : 5 4,5 DETALLE C ESCALA 2 : 5 20 20 10103 DETALLE D ESCALA 2 : 5Taladro diam.3mm (16 columnas x 10 filas)FW: Taladro flow drillPintura: 50% Gris blau pantone 5415 50% Blanc RAL 9010 Material Acabado Fabricaci\u00f3n Peso Cantidad 1023 Chapa de acero al carbono (SS)Pintado Plancha 2.5mm 9.5 kg indicacion de toleranciahasta 6mas de 6 hasta 30mas de 30 hasta 120mas de 120 hasta 315mas de 315 hasta 1000mas de 1000 hasta 2000mas de 2000 hasta 4000mas de 4000 hasta SUSTITUIDO NUEVO N\u00b0 -- - FECHA-NOMBRE -- Sin indicacion las aristas seran 0,5mm a 45\u00b0. Sin indicacion las esquinas seran a 0,5mm R. Las medidas ( ) no tienen importancia. Las medidas seran expres. verificadas. Sin indicacion expresa roscas de calidad 6 (media) Tuercas 6H y Tornillos 6g. CONJUNTO FECHA NOMBRE MAQUINA$1(;2\u0003\u0015\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003\u0003 \u001b\u0011\u0015\u0011\u0019\u0011\u0003&RQMXQWR\u0003&DMD\u00033DQWDOOD\u00033/&\u0003% 7)&\u000389,& "}