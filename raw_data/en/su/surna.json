{"title": "PDF", "author": "PDF", "url": "https://communities.vmware.com/wbsdv95928/attachments/wbsdv95928/15114/1301/1/VM_whitepaper_Perform_Management.pdf", "hostname": "PDF", "description": "PDF", "sitename": "PDF", "date": "PDF", "cleaned_text": "Virtual Environment Eric Siebert Author and vExpertPerformance Management in a Virtual Environmentwhitepaper1Synopsis Performance is defined as \"the manner in which or the efficiency with which something reacts or fulfills its intended purpose.\" With servers, this relates to how well software, like operating systems and applications, run on computer hardware. Performance is a measurable statistic that provides us with numbers that must be interpreted, so we can tell how good or bad a server is performing in different hardware areas. Achieving good performance is important to any server to ensure a good experience for users and applications; in a virtual environment, performance is especially important where many virtual machines are all competing for a limited amount of physical host resources. Performance monitoring with virtualization is much more complicated than with traditional servers. The virtualization layer that is inserted between the physical hardware and the guest operating systems of the virtual machines changes the way you monitor performance. With virtualization, there is more to monitor, and interpreting the results can be difficult. Therefore, having a good monitoring solution is key so that you can be automatically alerted to problems and have important statistics highlighted for you. Where Do Y ou Start When Monitoring Performance? So, you've implemented virtualization and don't know where to start when it comes to monitoring the performance of your virtual environment. In a traditional, non-virtual environment, you monitor performance through the operating system, which is installed directly on the server hardware. T ypically, a centralized monitoring system relies on an agent installed on the operating system or built-in components like Windows WMI to read performance statistics from the server. With virtualization, this type of performance monitoring is no longer effective. The reason for that is the guest operating system is no longer seeing the physical hardware of the host. Instead, it is seeing virtual hardware that is emulated by the hypervisor, so performance statistics that are measured inside the guest OS are not an accurate reflection of the physical hardware of the host. As a result, you need a monitoring application that is aware of the virtualization layer and can also measure the statistics that are unique to virtual environments. Built-in virtualization performance monitoring tools like VMware's vCenter Server can provide raw performance statistics for the virtual environment, but it doesn't help you interpret them. The information returned by vCenter Server can be overwhelming, and knowing what to look for and what the numbers mean can prove difficult. Additionally, vCenter Server is designed to monitor and report at the virtualization layer and doesn't extend very far into the guest OS layer, so it does not provide a complete monitoring solution. Virtualization Manager was designed from the ground up to monitor virtual environments. It works at the virtualization layer and the guest OS layer to provide a complete picture when it comes to performance. Virtualization Manager provides a single, seamless monitoring solution that can help you understand what the numbers mean, so you can focus on the performance statistics that are most important in your virtual environment. 2 whitepaperWhat to Look for With Performance and the Key Resource Counters Y ou Want to Focus on There are hundreds of performance statistics that are generated by ESX/ESXi and vCenter Server that cover many different areas. Not all of these statistics are useful in most cases, and if you tried to monitor them all, you would be quickly overwhelmed. Some statistics are only useful in certain situations, such as troubleshooting a resource bottleneck. But there are others that can provide key indicators to the overall health of your vSphere environment and should be constantly monitored. Some statistics are specific to hosts while others only apply to virtual machines. The table below lists some of the more important statistics that you should focus on when monitoring vSphere. Statistic What it means Why it's important CPU - READY A VM statistic - the amount of time in milliseconds that is spent waiting for a CPU to become available.High CPU Ready times can indicate a CPU bottleneck or too many vSMP VMs on a host. vSMP VMs are more difficult to schedule then single vCPU VMs. This can really slow VMs down as they have to wait for CPU time on the host. This is a delta value that is summed up from the last statistics sampling interval. CPU - USED A VM/Host statistic - the amount of CPU time that is used in milliseconds.High CPU Used times can indicate that a VM is saturating its CPU and may benefit from an additional vCPU\u2014especially if this value is high, and CPU Ready is low. This is a delta value that is summed up from the last statistics sampling interval. CPU - USAGE A VM/Host statistic - a basic measurement of CPU usage and is the total amount of CPU usage by all the VMs on a host and is measured as a percentage (including the Service Console but excluding the VMkernel).For VMs, this is the usage as measured by the host, not the guest OS, so it is more accurate. It is also an average of all the vCPUs assigned to the VM. For hosts, this is the actively-used CPU of the host as a percentage of the total available CPU. These statistics are good indicators of how busy the host CPUs are as well as individual VM CPU usage. MEM - SWAPPED A VM/Host statistic - the amount of memory that is being swapped to/ from a VMs virtual disk swap file by the VMkernel, measured in Kilobytes.A large number here represents a problem with lack of physical host memory and a clear indication that performance is suffering as a result. This is typically the result of memory over-commitment or the use of memory limits placed on a VM. VM paging to disk is not desirable, and optimally, this should be zero. MEM - ACTIVE A VM/Host statistic - the amount of \"true\" host memory used by the VM in the past small window of time, measured in Kilobytes.For VMs, this is the amount of guest physical memory actively being used. For hosts, this is the sum of all active VM memory plus the overhead memory of the host services such as the Service Console. Any unused memory may be swapped out or ballooned with no impact to the guest's performance. A low number here compared to the amount of memory assigned to a VM can indicate that the VM has too much memory assigned to it.3 whitepaperMEM - VMMEMCTL A VM/Host statistic - the amount of memory measured in Kilobytes allocated by the memory control driver (vmmemctl) that is part of VMware T ools. Also known as ballooning, this driver inflates (uses more RAM) or deflates (uses less RAM) to help control the amount of RAM that a guest OS is using.For VMs, this is the amount of guest physical memory that is reclaimed from the VM by the balloon driver. For hosts, this is the sum of all the VM vmmemctl values plus host memory overhead. A memory balloon amount greater than zero indicates that the host is becoming constrained on physical memory and has inflated the balloon driver in VMs to help reclaim memory. The balloon driver acts like an application running on the OS that requires an increasing amount of memory. By doing this, it forces memory pressure on the guest OS, so it begins using its own memory management techniques. DISK - GAVG A Host statistic - the average amount of time in milliseconds (latency) that it takes to process a SCSI command issued by the guest OS. This is the sum of latency in the VMkernel (KAVG) and latency in the storage device (DAVG).High disk latency can really slow down VMs. In general, GAVG should be below 20ms. If it exceeds 30ms, VMs will start to slow down. Above 50ms causes VM performance to really degrade. Y ou can use KAVG and DAVG to pinpoint the problem. If Kernel latency is above 5ms, you may need to increase the queue depth. High device latency indicates a problem with your storage device. DISK - QUED A Host statistic - the average amount of time in milliseconds that SCSI commands spend in the VMkernel queue before they are sent to the device queue.A number greater than 5ms here indicates that SCSI commands are spending too much time in the VMkernel queue. The queue depth and other related settings may need to be increased to resolve this. DISK - USAGE A VM/Host statistic - the aggregated disk I/O rate as measured in KBps.This is a good general disk statistic that shows how much disk activity is happening in the environment. For VMs, this is the total for the individual VM. For hosts, this is the combined total of all the VMs running on the host. DISK - COMMANDS A VM/Host statistic - the number of SCSI commands that have been issued.This is a good disk statistic that shows disk activity in another manner. Disk commands show the number of I/O operations per second (IOPS) that are occurring. For VMs, this is the total commands to the disk target that the VM is located on. For hosts, this is the total commands to all the disk targets. NET - DROPPEDTX A Host statistic - the number of transmit packets dropped. In a healthy environment, this should be zero. If this is greater than zero, it can indicate a very busy or densely populated vSwitch that may need additional physical NICs assigned to it. NET - DROPPEDRX A Host statistic - the number of receive packets dropped.In a healthy environment, this should be zero. If this is greater than zero, it can indicate a very busy or densely populated vSwitch that may need additional physical NICs assigned to it. It can also indicate that a vNIC is running out of receive buffers and may need to be increased.4 whitepaperKeeping an eye on the most important statistics is critical to monitoring the health of a vSphere environment. Fortunately, Virtualization Manager's dashboards and reporting can make this much easier by presenting the key statistics to you without requiring you to have to dig through vCenter Server to get them. Having this data easily available and in an easy-to-view format allows you to quickly spot performance problems and trends in your vSphere environment. Know Where to Look: Don't Search the Attic When the Problem is in the Basement T roubleshooting performance problems with traditional physical servers is usually pretty straightforward. Y ou can use tools deployed in the operating system to see how the hardware is performing in different areas. With virtualization, it is more complicated as the guest operating system cannot directly access the underlying physical hardware to obtain accurate performance statistics. The virtualization architecture has many more moving parts then traditional servers, and there are other factors in virtualization that can also affect performance that must be taken into account when troubleshooting performance problems. Virtual machine and host settings can impact performance as can improperly designed or configured hardware. In addition, with many virtual machines all sharing hardware resources, one or more VMs can cause performance problems for other VMs. Storage and networking can further complicate performance troubleshooting as you have to deal with both virtual and physical networks and shared storage devices that are connected to many hosts. Because of all this, pinpointing the cause of a performance problem in a virtual environment can be a complicated and frustrating task. Knowing where to look can be difficult as the symptoms can often be caused by many different things. You may waste time looking at your physical storage device to troubleshoot what seems like a storage related problem when, in fact, the problem actually lies in the hypervisor or another area, such as the networking. The very nature of a virtual environment, which is all about the sharing of resources by many hosts and VMs, can make troubleshooting performance problems extremely difficult. For this reason, you need a product like Virtualization Manager that provides visibility into the virtualization layer, which is where you need to look to troubleshoot performance issues. There is a lot of performance data generated on a host that must be collected and analyzed, and Virtualization Manager can automatically handle this and quickly get you the data you need to spot problems. Many performance problems are the result of changes that are made to the virtual environment, and the first question usually asked when troubleshooting problems is, \"What changed?\" Something as innocent as changing a single setting on a VM can have a big impact and may not be documented even if you have change control processes in place. Fortunately, Virtualization Manager can track all changes over time using its Host and VMDNA technology, so changes and events can easily be correlated to the beginning of performance problems. Virtualization Manager can quickly point you in the right direction and highlight the area that you need to identify to resolve problems, so you aren't wasting time looking in the wrong location.NET - USAGE A VM/Host statistic - the combined transmit and receive rates measured in KBps. For VMs, this is the sum of all network traffic across all the vNICs assigned to a VM. For hosts, this is the sum of all network traffic across all the pNICs in a host. This is a good general indicator of how much network traffic is occurring so you can see how saturated your hosts NICs are and if you are nearing their maximum throughput capacities. It can also indicate which VMs have the highest network traffic rates, which can help you balance high traffic VMs across multiple hosts.whitepaper5The Domino Effect: How Performance Problems Can T opple Y our VMS One by One Because virtualization is a shared environment, small changes can have a big ripple effect throughout the entire virtual infrastructure. Hosts have a limited set of resources, and there are many VMs competing for them. If a performance problem were to occur, all your VMs can potentially be affected by it. It may start with one VM that puts intense pressure on the host resources. This can, in effect, cause a denial-of-service attack as the host suddenly becomes resource constrained, and all the VMs are fighting for resources that are suddenly scarce. As a result, all the VMs on a host can slow down to the point where they become unresponsive. This can also extend beyond a single host as multiple hosts typically share storage devices. If the VMs from one host start generating high disk I/O on a shared storage device, it will impact the VMs running on other hosts if they also use the same shared storage device. As a result, the entire virtual environment needs to be closely monitored at all times, so you can quickly react to performance problems. You also need to be aware of your normal resource usage patterns, so you can spot irregularities when they occur and pinpoint their cause. Virtualization Manager can help you with this by generating alerts when problems occur to prevent your environment from grinding to a halt due to a lack of physical resources. Additionally, Virtualization Manager's performance analyzer can show you where resource contention is occurring and point out the top resource consumers in your environment. Virtualization Manager can also show you resource usage trends so you know what is normal and what is not. Virtualization Manager's dashboards can give you quick performance information at a glance, and reports can give you more detailed information to help ensure your virtual environment is performing as expected. Interpreting the Data Y ou are Seeing: Do Y ou Really Know What All Those Numbers Mean? There are many non-traditional performance statistics generated in a virtual environment that can be difficult to interpret. These statistics are unique to the virtualization layer and are a critical part of monitoring the health of a virtual environment. This includes statistics such as percent ready, memory ballooning, kernel latency, memory compressed and queue depth. Not understanding what all those numbers mean and how they relate to other statistics means you're missing out on vital information on the health of your virtual environment. Y our environment may be trying to tell you there's a problem, but since you don't understand what it is telling you, you're essentially not listening to it. Virtualization Manager can be your interpreter and translate the wealth of complicated performance data that it collects into easy-to-understand results. Virtualization Manager has out-of-the-box, widget-based dashboards for reporting, performance management, storage analysis and key performance indicators. Virtualization Manager can also help you understand the relationships between the performance of the many virtual infrastructure components and the applications that they support. With Virtualization Manager, you don't need to be a performance expert\u2014instead, let Virtualization Manager be the performance expert, and allow it to tell you what you need to know.\u00a9 2011 SolarWinds, Inc. All rights reserved. SolarWinds\u00ae, the SolarWinds logo, ipMonitor\u00ae, LANsurveyor\u00ae, and Orion\u00ae are among the trademarks or registered trademarks of the company in the United States and/ or other countries. All other trademarks are property of their respective owners. 6 whitepaperWith virtualization, you can't afford to be reactive when it comes to performance. Y ou must be proactive to prevent big problems from occurring. Monitoring the performance of your virtual environment should be done constantly; otherwise, how would you know if a problem started today or if it's been there all along? If you want to be successful with virtualization, you have to maintain good performance. If you don't, you'll risk a negative backlash against your decision to implement it. Y ou can't afford to ignore performance in a virtual environment. Unlike traditional environments, where performance problems are usually limited to a single server, the effects of bad performance in virtualization can be far-reaching. Therefore, having the right piece of software in place to help you stay on top of performance is critical. If you want to do things correctly, you should always use the right tool for the job. When it comes to performance monitoring in virtualization, that tool is Virtualization Manager. About the Author Eric Siebert is an IT industry veteran, author and blogger with more than 25 years of experience, most recently specializing in server administration and virtualization. Siebert has published books, including his most recent, Maximum vSphere from Pearson Publishing and has authored training videos in the T rain Signal Pro series. He also maintains his own VMware information web site, vSphere- land.com, and is a regular blogger and feature article contributor on T echT arget's SearchServerVirtualization and SearchVMware web sites. Siebert has presented at VMworld in 2008 and 2010 and has been recognized as a vExpert by VMware in 2009 and 2010. About SolarWinds SolarWinds, a leading provider of IT management software to more than 97,000 customers worldwide, has acquired Virtualization Manager. Virtualization Manager's products add optimization, capacity planning, configuration and chargeback reporting for virtualized server environments to the SolarWinds portfolio. With virtualization and cloud computing, the infrastructure is growing fast and moving faster than ever before - and it's not slowing down. Complexity is on the rise, and primitive, narrowly-focused management utilities just won't cut it anymore. SolarWinds will offer Virtualization Manager products for a fraction of the cost of current virtualization management suites, making it one of the most affordable and comprehensive offerings in the market. Virtualization Manager's unique cloud-scale analytics leverage a search-driven, multi-dimensional approach that enables IT teams to: Unify capacity, performance, chargeback and configuration management Analyze application-centric capacity and optimize VM placement Predict capacity bottlenecks and shortfalls across CPU, memory and storage Get answers contact SolarWinds at 866.530.8100 or e-mail sales@solarwinds.com . T o locate international reseller near you, visit http:/ /www.solarwinds.com/ partners/ reseller_locator.aspx Did you "}