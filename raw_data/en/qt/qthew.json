{"title": "PDF", "author": "PDF", "url": "https://www.math.ucla.edu/~tchou/pdffiles/IEEE_TNSE.pdf", "hostname": "PDF", "description": "PDF", "sitename": "PDF", "date": "PDF", "cleaned_text": "Controlling Epidemics Through Optimal Allocation of Test Kits and Vaccine Doses Across Networks Mingtao Xia , Lucas B \u20acottcher , and Tom Chou Abstract\u2014 Efcient testing and vaccination protocols are critical aspects of epidemic management. To study the optimal allocation of limited testing and vaccination resources in a heterogeneous contact network of interacting susceptible, infected, and recovered individuals, we present a degree-based testing and vaccination model for which we derive optimal policies using control-theoretic methods. Within our framework, we nd that optimal intervention policies rst target high-degree nodes before shifting to lower- degree nodes in a time-dependent manner. Using such optimal policies, it is possible to delay outbreaks and reduce incidence rates to a greater extent than uniform and reinforcement- learning-based interventions, particularly on certain scale-free networks. Index Terms\u2014 Epidemics, infection networks, optimal control, reinforcement learning, testing, vaccination. I. INTRODUCTION LIMITING the spread of novel pathogens such as SARS- CoV-2 requires efcient testing [1], [2] and quarantine strategies [3], especially when vaccines are not available or effective [4]. Even if effective vaccines are available at scale, their population-wide distribution is a complex and time-consum- ing endeavor, influenced by, for example, age-structure [5]-[7], vaccine hesitancy [8], and different objectives [9]. Until a sufcient level of immunity within a population is reached, distancing and quarantine policies can also be used to help slow the spread and evolutionary dynamics [10] of infectious diseases . Epidemic modeling and control-theoretic approaches are useful for identifying both efcient testing and vaccination policies. For an epidemic model of SARS- CoV-2 transmission, Pontryagin's maximum principle (PMP) has been used to derive optimal distancing and testing strate- gies that minimize the number of COVID-19 cases andintervention costs [11], [12]. Optimal control theory has also been applied to a multi-objec tive control problem that uses isolation and vaccination to limit epidemic size and dura- tion [13]. These recent investigations describe the underlying infectious disease dynamics through compartmental models without underlying network structure, meaning that all inter- actions among different individuals are assumed to be homogeneous. Multicompartment models that may be associated with con- tact networks have been investigated. For example, optimal vaccination strategies have been derived for a rapidly spread- ing disease in a highly mobile multicompartment susceptible- infected-recovered model using PMP to heterogeneous node-based susceptible-infected-recovered-susceptible (SIRS) models were also studied in the context of multiplex net- works [15] and rumor spreading [16]. Complementing these control-th eory-based investigations, reinforcement learning (RL) has recently used iden- tify infectious high-degree nodes (\"superspreaders\") in tem- poral networks [17]. It has been found that RL was able to outperform intervention policies derived from purely struc- tural node characterizations that are, for instance, based on centrality measures [17]. However, these RL methods could only be applied to rather small networks with about 400 nodes. For social networks describing much larger popula- tions, early work by May and An derson employed effective degree models to study the population-level dynamics of human immunodeciency virus (HIV) infections [18]. These degree-based models and later variants [19]-[21] did not account for degree correlations . Effective degree models for susceptible-infected-suscepti ble (SIS) dynamics with degree correlations were derived in [22] and applied to SIR dynamics in [23]. A further generalization of these methods to model SIR dynamics with networked a nd well-mixed transmission pathways was presented in [24]. For a detailed summary of degree-based epidemic models, see [25]. In this work, we focus on formulating both optimal control and RL-based target policies on a degree-based epidemic model [26] that is constrained only by the maximum degree and not by the system size ( i.e., number of nodes). We con- struct effective control strategies to slow down disease spread across heterogeneous network models which include both degree distributions and higher-order correlations of the degree distribution. Our approach is not limited by size as agent-based models are [17], is simpler because we do notManuscript received July 19, 2021; revised December 6, 2021; accepted January 14, 2022. Date of publication February 18, 2022; date of current ver- sion May 23, 2022. This work was supported in part by NSF under Grant DMS-1814364 and in part by Army Research Ofce under Grant W911NF- 18-1-0345. Recommended for acceptance by Prof. Xianbin Cao. (Correspond- ing author: Tom Chou.) Mingtao Xia is with the Department of Mathematics, University of Califor- nia, Los Angeles, Los Angeles, CA 90095 USA (e-mail: xiamingtao97@g. ucla.edu). Lucas B \u20acottcher is with the Department of Computational Medicine, Uni- versity of California, Los Angeles, Los Angeles, CA 90095 USA, and also with the Frankfurt School of Finance and Management, 60322 Frankfurt, Ger- many (e-mail: L.Boettcher@fs.de). Tom Chou is with the Department of Computational Medicine and Mathe- matics, University of California, Los Angeles, Los Angeles, CA 90095 USA (e-mail: tomchou@ucla.edu). Digital Object Identier 10.1109/TNSE.2022.31446241422 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022 This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 License. For more information, see https://creativecommons.org/licenses/by-nc-nd/4.0/resolve interpersonal contact times or other individual details, and is thus easier to solve. On the other hand, unlike simple multicompartment epidemic control models [11], [13], we take into account a heterogeneous contact network and control measures that depend on both time and node degree. In the next section, we propose and justify a degree-based epidemic testing and quarantining model. An optimal control framework for this model is presented in Section III and, given limited testing resources, an optimal testing strategy is com- puted. We extend the same underlying disease model to include vaccination in Section IV and derive optimal vaccina- tion strategies that minimize infection given a limited vaccina- tion rate. We summarize our results and discuss how they depend on network and dynamical features of the model in Section V. For comparison, we also present in Appendix C a reinforcement-learning-based algorithm that is able to approx- imate optimal testing strategies for the model introduced in Section II. Finally, we implemented a st ochastic Monte-Carlo simu- lation of disease transmission, testing, and vaccination on networks. By using the optimal strategies computed using the PMP on ODE-based deterministic models, we nd sig- nicant differences in the stochastic model. In Appendix D, we show that these differences arise from higher corre- lations in network connectivity that arise in the discrete stochastic model used. II. D EGREE -BASED EPIDEMIC AND TESTING MODEL For the formulation of optimal testing policies that allo- cate testing resources to diff erent individuals in a contact network, we adopt an effective degree model of SIR dynamics with testing in a static network of Nnodes. Nodes represent individuals, a nd edges between nodes rep- resent corresponding contacts. Therefore, the degree of a node represents the num ber of its contacts. If Kis the maximum degree across all nodes, we can divide the popu- lation into Kdistinct subpopulations, each of size Nk (k\u00bc1;2;...;K) such that all nodes in the kthgroup have degree k. Therefore, N\u00bcPK k\u00bc1Nk. In our epidemic model, we distinguish between untested and tested infected individuals. Let Sk\u00f0t\u00de,Iu k\u00f0t\u00de,I/C3 k\u00f0t\u00de, and Rk\u00f0t\u00dedenote the numbers of susceptible, untested infected, tested infected, and recovered nodes with degree kat time t, respectively. Since these subpopulations together represent the entire population (the total number of nodes N), both N andNkare constants in our model. Their values satisfy the normalization condition Sk\u00feIu k\u00feI/C3 effective- degree approach [18], the degree distribution. P\u00f0'jk\u00deis the conditional probability that a chosen node with degree kis connected to a node with degree '. By dening E';kas the number of edges connecting a node with degree kwith another node with degree 'in a given network, the conditional proba- bility can be directly evaluated as P\u00f0'jk\u00de\u00bcE';k=\u00f0kNk\u00de. Our degree-based formulation of SIR dynamics with testing, (2)- (5), is an approximation of the full node-based dynamics assuming that nodes of the same degree are equally likely to be infected at any given time [26]. Susceptible individuals become infected through contact with untested and tested infected individuals at rates buand b/C3, respectively. Untested and tested infected individuals recover at rates guandg/C3, respectively. Differences in the recovery rates guandg/C3reflect differences in disease severity of and treatment options for untested and tested infected indi- viduals. Once recovered, individuals develop long-lasting immunity that protects them from reinfection. Temporary immunity can be easily modeled by using an SIS type model with or without delays. Reduced transmissibility of tested infected (and potentially quarantined) individuals corresponds to setting b/C3/C28bu. The testing rate of nodes with degree kis dened as fk\u00f0t\u00de, such that fk\u00f0t\u00deDtis the total number of tests given to nodes with degree kin time window Dt. Tests given to recovereds, susceptibles, and already-tested infecteds do not lead to quarantining and will not affect the disease dynamics. How- ever, a fraction Iu k=\u00f0Sk\u00feIu k\u00feI/C3 k\u00feRk\u00de/C17Iu k=Nkof these fk\u00f0t\u00deDttests will be administered to untested infecteds. Once infected nodes have been identied by testing, they can be quarantined and removed from the disease transmission dynamics. If infected individuals who already have been tested strictly avoid future testing, more tests will be available for the other subpopulations, increasing the rate at which the remaining untested infecteds will be tested. In this case, the fraction of tests administered to untested infecteds is modied: Iu k=\u00f0Sk\u00feIu k\u00feRk\u00de/C17Iu k=\u00f0Nk/C0I/C3 k\u00de. After normalizing by the total population Nto write tested fractions in terms of (1), the testing term becomes /C0fk\u00f0t\u00deiu k=Nk(see (3)) or /C0fk\u00f0t\u00deiu k=\u00bdNk\u00f01/C0I/C3 k=Nk\u00de/C138, respectively. Biased testing can also be represented by using a testing fraction of the form Iu keb=\u00f0Iu keb\u00feSk\u00feI/C3 k\u00feRk\u00de, where b> 0increases the fraction of given to infecteds. To correct for false-positive tests, (2)-(5) can be modied by includingXIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1423an additional term that transfers the I/C3 kpopulation back to Sk. False negatives can be accounted for by a reduction in fk\u00f0t\u00de=Nk. For a detailed overview of statistical models that account for testing errors and bias, see [27], [28]. What remains is to assign network structures, extract P\u00f0'jk\u00de from them, and determine reasonable parameter values before calculating the optimal testing protocol fk\u00f0t\u00de. We apply our disease-control framework to (i) a Barab /C19asi-Albert (BA) net- work [30] and (ii) a stochastic block model (SBM) [31] with four communities matrix P\u00bc10/C041222 2422 2252 22230 BB@1 CCA: (6) These two network types exhibit properties, such as hub nodes with high degrees and community structure, that are observ- able in real-world contact networks [32], [33]. In the construc- tion of the BA network, each new node is connected to 2 existing nodes using linear preferential attachment. Fig. 1(a) shows the degree distribution of a 99,817-node BA network that we use in this study. A heatmap of the conditional degree distribution matrix of the BA network with the degree distri- bution P\u00f0k\u00deshown in Fig. 1(a) is given in Fig. 1(b). Thedegree distribution and the conditional degree distribution matrix of the 100,000-node SBM network are shown in Fig. 1 (c) and (d), respectively. Taking into account empirical nd- ings on the degree distributions in real-world contact net- works [32], we use a degree cutoff of k/C20K\u00bc100. We will use the specic congurations of the BA and SBM networks shown in Fig. 1 for our subsequent analysis of (2)-(5). Next, to constrain the parameter values, we rst invoke esti- mates of the basic reproduction number ( i.e., the average num- ber of secondary cases that results from one case in a completely susceptible population), which for a network model is dened as [34], [35] R0\u00bcr\u00f0JV/C01\u00de (7) in which Jacobian of the linear- ized dynamical system (see (2) and (3)) about the disease-free state with sk\u00f0t\u00bc0\u00de\u00bcNk=Nandfk\u00bc0corresponding to the initial, untested, and uncontrolled spread of the infection: Jij\u00bciP\u00f0jji\u00deNi Njbu;i ; j/C20K: (8) This \"next-generation\" method associates R0with the largest eigenvalue inherent to the dynamical system. Additional expressions forR0for an uncorrelated degree network are given in Appendix A. Empirically, the basic reproduction number for COVID-19 varies across different regions. For the early outbreak in Wuhan [36],R0was estimated to be 3.49, while for the early outbreak in ItalyR0/C242:43/C03:10[37]. Here we set R0\u00bc 4:5which was suggested in [38] as the basic reproduction number of early COVID-19 spread in the absence of any inter- vention. For a given value of the recovery rate guof untested individuals, which can be inferred from empirical data [38], [39], we determine the transmissibility buby numerically solvingR0\u00f0bu\u00de\u00bc4:5forbu. Our source codes are publicly available at https://gitlab.com/ComputationalScience/epi- demic-control. III. A LLOCATING LIMITED TESTING RESOURCES Without any testing constraints, it would be most effective for disease control to use a testing rate fk\u00f0t\u00desufciently large to keep the fraction of untested individuals, iu k\u00f0t\u00de, close to zero. In general, the testing rates are constrained by fmin k/C20fk\u00f0t\u00de Nk/C20fmax k; (9) and the total testing rate is also bounded by availability and logistics of testing XK k\u00bc1fk\u00f0t\u00de\u00bcF\u00f0t\u00de: (10) The goal is to determine, under these constraints, the function fk\u00f0t\u00deorfk\u00f0t\u00de=Nkthat most effectively reduces the total Fig. 1. Degree distribution of a Barab /C19asi-Albert network and a stochastic block model. (a) The degree distribution of a Barab /C19asi-Albert network with 99,817 nodes. To generate the network, we start with a dyad and iteratively add new nodes until we reach 100,000 nodes. Each new node has 2 edges that connect it to existing nodes using linear preferential attachment. Isolated nodes or nodes with degrees larger than 100 [32] are then removed from the network. The grey solid line is a guide-to-the-eye with slope -3 [30]. For illus- tration, the inset shows a realization of a Barab /C19asi-Albert network with 100 nodes. Node size scales with their betweenness centrality. (b) The conditional probability P\u00f0'jk\u00deassociated with the Barab /C19asi-Albert network generated in (a). (c) The degree distribution of a stochastic block model with four blocks and 100,000 nodes. The inset shows a realization of a stochastic block model with 800 nodes, but using the same block probability matrix. (d) The condi- tional probability P\u00f0'jk\u00deassociated with the SBM. In both (b) and (d), all ele- ments that are strictly zero are uncolored.1424 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022number of infections. In practice, high-degree nodes ( e.g., highly social individuals) might be subject to more testing (and quarantining if positive) than low-degree nodes because of their higher expected rate of infecting others. This rationale translates to fk\u00f0t\u00de=Nk>f k0\u00f0t\u00de=Nk0ifk>k0. In our numeri- cal experiments, we use sufciently broad bounds of fk\u00f0t\u00deand setfmin k\u00bcfminandfmax k\u00bcfmax. To minimize the number of total infections over time, while simultaneously stressing the importance of reducing early infections, we dene a loss or, which describes how we balance between minim izing current infections and future infections. The smaller the parameter d,t h el e s s attention we pay to future infections, and the more we focus on reducing early infections. For example, medical resources can better handle conrmed patients and new treatments can be given time to develop if the number of infections are spread over longer time periods. These effects can be effectively incorporated in the loss function by using d<1. Minimizing the loss (11) is equivalent to minimizing the number of infec tions, weighted by the dis- count factor dt, in the time horizon \u00bd0;T/C138.T os e a r c hf o r the optimal testing function fk\u00f0t\u00dethat minimizes (11), we invoke Pontryagin's maximum adjoint variables associated with sk, iu k, and i/C3 k, respectively. PMP states that a necessary condition for the loss-minimizing control fk\u00f0t\u00deis that it minimizes H (or maximizes/C0H) at every time point t. This method of opti- mal control has been applied to many other contexts, including control of economic growth [40]. In our problem, applying PMP under the total budget constraintPK k\u00bc1fk\u00f0t\u00de\u00bcF\u00f0t\u00de,w e explicitly nd the minimizing testing function \u00f0f/C3 k\u00de\u00bc argminfH, which we will assume to be optimal minimizes L\u00f0T\u00de. mize Hwith k/C0/C21u k\u00deiu k\u00f0t\u00de (16) given the budget constraints (9) and (10). Hence, after giving each subpopulation the minimal testing resources fminNk,w e maximize the testing rates fk\u00f0t\u00dewith the smallest k/C0/C21u k\u00deiu k\u00f0t\u00de=NkoffmaxNkas long as sufcient testing bud- get is available. In other words, we should give testing resour- ces to those groups presumed to be at the highest risk, as quantied by the quantity \u00f0/C21/C3 k/C0/C21u k\u00deiu k\u00f0t\u00de=Nk. We PMP-based algorithm outlined in Appendix B to iteratively calculate the loss function (11) and optimal testing strategy. In accordance with empirical data on COVID-19 patients [39], [41], [42], we set g\u00bcgu\u00bcg/C3\u00bc\u00f01=14\u00de=day andb/C3\u00bcbu=10. The transmissibility of untested individuals, bu, is calculated according to (7) as bu\u00bc0:0411=dayfor the BA network and bu\u00bc0:0130=dayfor the SBM network. We set the discount factor d\u00bc0:95so that initial infections con- tribute more to the loss function (11). The total daily number of SARS-CoV-2 tests in the US after an initial ramping-up phase in 2020 is about 0.6%/day [28]. Hence, we set X kfk\u00f0t\u00de\u00bc0.006 N; (17) k\u00f00\u00de\u00bc0; iu k\u00f00\u00de\u00bc10/C06P\u00f0k\u00de;r k\u00f00\u00de\u00bc0; (18) corresponding to about 0.1 of an infected individual uniformly distributed on N/C25105susceptible nodes. The optimal testing strategy is supposed to identify those nodes that are most likely to be infected and transmit the disease to others. UponXIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1425using T\u00bc200;Dt\u00bc0:1andd\u00bc0:95, we nd the optimal testing strategy fk\u00f0t\u00de=Nkfor our BA network and plot it in Fig. 2(a). Here (2)-(5) and (13)-(15) are solved using an improved Euler method. For the BA network, the value of the loss function dened in (11) is L\u00f0T\u00bc200\u00de\u00bc0:0109 under the optimal testing strategy, while it is L\u00f0T\u00bc200\u00de\u00bc0:0325 under uniform testing fk\u00bcF0Nk N: (19) Fig. 2(b), (c), and (d) show the associated populations under optimal testing, while (e) shows the dynamics of the fraction of nodes infected, 1/C0PK k\u00bc1sk\u00f0t\u00de. The disease spread under optimal testing is signicantly slowed relative to the no testing (black) and uniform testing (dashed blue/circle) cases. Fig. 2 (f) plots the optimal testing rate for the SBM network. Panels (g-i) show the corresponding subpopulations, and panel (j) plots the fraction of nodes infected under PMP-optimal, uni- form, and no-testing conditions. For the SBM 200\u00de\u00bc0:0564 under the optimal strategy and L\u00f0T\u00bc200\u00de\u00bc 0:0571 under the uniform testing strategy, suggesting that the PMP approach yields better solutions than uniform testing. However, the improvement is modest and the SBM network is rather insensitive to testing and quarantining. The slight improvement from testing is shown by the reduction in the fraction infected relative to the no testing case (inset). In both networks, nodes with larger degrees are more likely to be tested at the beginning of the outbreak [Fig. 2(a) and (f)], indicating that people with more contacts are more likely toinfect others or get infected, and should be given priority to get tested. Yet, in both networks, as time evolves, the optimal testing strategy tends to shift focus from higher degree nodes to nodes with smaller degrees because testing those nodes that were infected and have already recovered is not meaningful in terms of disease control. Comparing Fig. 2(e) and (j), we see that the differences between optimal and uniform testing are larger for the BA net- work compared to the SBM. A possible explanation for this behavior is that in the BA network, the degree distribution P\u00f0k\u00dedecays algebraically. Therefore, as long as testing focuses primarily on high-degree nodes, the spreading of the disease can be controlled very effectively since the majority of nodes have small degrees and are more unlikely to be infected. On the other hand, for our SBM network, the degrees of most nodes are close to each other and larger than 10, indi- cating that nodes with a small degree are more likely to be infected compared to the BA network. Even if we use the same uniform testing rates (see (19)) in both networks, the proportion of infections in the BA network is less than that in the SBM network. IV. O PTIMAL VACCINATION POLICY Optimal vaccination has also been studied within the classic SIR model [43]. However, devising vaccination strategies based on social network structure may provide a more rened and efcient way of administering vaccines and extinguishing an epidemic. Our simple testing model presented in the previous section can be straightforwardly Fig. 2. Optimal testing and quarantining strategy for T\u00bc200and discount factor d\u00bc0:95. We plot the optimal strategies and the corresponding susceptible, untested infected, and tested infected fractions at each degree kacross time t\u00bcnDt. (a) A heatmap of the PMP-optimal testing strategy (see Algorithm 1) for the BA network. The corresponding populations of degree- ksusceptibles, untested infecteds, and tested infecteds are plotted in (b-d), respectively. (e) Time-evo- lution of the total fraction infected 1/C0PK k\u00bc1sk\u00f0t\u00deunder the PMP-optimal testing strategy (dashed red). The fractions infected under hypothetical uniform test- ing (dashed blue/circle) and no testing (black) scenarios are shown for comparison. For the BA network, optimal testing both delays and suppresses ep idemic spreading more effectively than uniform testing. The bottom row (f-j) shows analogous results for the SBM network. Panels (f-i) show the correspondi ng optimal testing rates, susceptible, untested infected, and untested infected populations with degree kas a function of time. Panel (j) shows the fraction infected as a func- tion of time. Although optimal testing and quarantining reduce the fraction infected relative to uniform or no testing, its effects are only modestly better. Given the same testing budget constraint, the effects of optimal testing strategies are greater in the BA network because its distribution of node degrees i s more hetero- geneous and testing and quarantining high-degree nodes can more effectively control disease spread. However, since the node degree distribution in the SBM network is sharply peaked, an optimal testing strategy is less effective overall.1426 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022adapted to describe vaccination on a network. The goal is to determine the optimal allocation of vaccine doses to a population with heterogeneous contacts to minimize the impact of the infection across the entire population. For COVID-19, there are a variety of vaccines that require one or two shots [44]. In our simulations, we assume that the administered vaccine provides full protection after one shot and that a vaccinated individual will instantly leave the sus- ceptible group and enter the recovered group. This means that vaccinated individuals will no longer be infectious and can be treated as \"recovered\" after receiving one vaccination dose. Furthermore, we assume that only susceptible persons will be vaccinated. Other mechanisms such as prime-boost protocols and time delays between vaccination and onset of immune response can also be accounted for in similar models as detailed in [45]. We reformulate (2)-(5) to study optimal vaccination pro- tocols that are constrained by vaccine supplies in a hetero- geneous population. For simplicity, we do not take into account the effect of testing and quarantining when devising optimal vaccinating strategie s, although testing and vaccina- tion can be performed concurrently. The the rate of vaccination of susceptibles with degree kat time t. Once vaccinated, susceptibles become \"recovered\" because they are immunized and no longer sus- ceptible to the infection. The total rate of administering vac- cines at time tis dened as XK k\u00bc1vk\u00f0t\u00de\u00bcV\u00f0t\u00de: (23) In other words, in time increment Dtat time t,w ec a n administer only V\u00f0t\u00deDtdoses. Equation (20) assumes that vaccination is resource-limited and that the rate of protect- ing susceptibles is proportional only to the rate vk\u00f0t\u00deof administering vaccines. In addition, we assume that the vac- cination rates for different subpopulations are conned to the interval vmin/C20vk\u00f0t\u00de Nsk\u00f0t\u00de/C20vmax; (24) where vmin;vmax2\u00bd0;0:4/C138=day are minimum and maximum vaccination rates. Note that vaccines are allocated only to sus- ceptibles, while tests are typically given to individuals of all categories: susceptible, infected, and recovered, according to their relative proportions. To formulate the vaccinedistribution problem in a heterogeneous contact network, we use the following loss function L\u00f0T\u00de\u00bcZT 0dtdtXK k\u00bc1ksk\u00f0t\u00deXK '\u00bc1P\u00f0'jk\u00de P\u00f0'\u00deb\u00f0t\u00dei'\u00f0t\u00de; (25) with the aim of minimizing the total number of infections over time (with a constant discount factor d2\u00f00;1/C138) by appropri- ately distributing vaccines to groups with different degree kat different rates. To minimize the loss function (25), we construct on Pontryagin's Maximum Principle. 1: Initialize t\u00bc0,sk\u00f00\u00de;iu k\u00f00\u00de;i/C3 the strategy the strategy F\u00f0kDt\u00de, then k;i/C3 k under the strategy F\u00f0kDt\u00defrom (2)-(4) 24: end 25: Calculate the Loss function L2in (11) 26:end whileXIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1427where /C21s kand/C21i generates the control that minimizes (26) for every t, which we assume also minimizes the target loss function (25). From the constraints (23) and (24), mini- mizing the Hamiltonian is achieved by giving vaccination doses to those subpopulations with the smallest /C21s k. We use the same Algorithm 1 to solve the minimization problem (25) numerically and obtain the optimal strategy. In the US, about two million doses of SARS-CoV-2 vac- cines were delivered in May 2021 [46], which were two-dose vaccines. Since appr oximately 0.3% of the entire US population is fully vaccinated daily, we set V\u00f0t\u00de\u00bc 0:003N=day,vmin\u00bc0=day,a n d vmax\u00bc0:4=dayin the con- straint (24). The infection rates bare set to be 0:0411=day for the BA network and 0:0130=dayfor the SBM network, and the recovery rate g\u00bc\u00f01=14\u00de=day. For comparison, we also simulate a vaccination st rategy with a uniform vaccina- tion ratevk\u00f0t\u00de\u00bcsk\u00f0t\u00deV\u00f0t\u00dePK k\u00bc1sk\u00f0t\u00de: (29) In all simulations, we use the following initial condition: ik\u00f00\u00de\u00bc10/C06P\u00f0k\u00de;rk\u00f00\u00de\u00bc0;sk\u00f00\u00de\u00bcP\u00f0k\u00de/C0ik\u00f00\u00de:(30) We plot the PMP-optimal vaccination strategy vk=Nkin Fig. 3 (a) and the corresponding susceptible and infected k-degree sub- populations sk\u00f0t\u00deandik\u00f0t\u00dein (b) and (c). We set T\u00bc150;Dt\u00bc 0:1and we use an improved Euler method to numerically solve (20)-(22), (27)-(28). Algorithm 1 is applied (without the infected and tested compartment) to determine the optimal vac- cination strategy by the PMP approach. For the BA network, L\u00f0T\u00bc150\u00de\u00bc1:165/C210/C05under the PMP-optimal strategy andL\u00f0T\u00bc150\u00de\u00bc0:01953 under a uniform vaccination rate. Fig. 3(d) shows that the optimal vaccination strategy on a BA network signicantly reduces the fraction infected compared to the uniform vaccination strategy. Panels (e-h) show the corre- sponding quantities for the SBM network for which L\u00f0T\u00bc 150\u00de\u00bc0:0210 under the optimal vaccination strategy and L\u00f0T\u00bc150\u00de\u00bc0:0360 under a constant, uniform vaccination strategy. In both networks, the optimal vaccination strategies obtained via Algorithm 1 tend to prioritize those nodes with higher degrees rst and eventually expand to those nodes with smaller degrees [see Fig. 3(a) and (e)]. As with testing and quarantining, the reduction in the fraction infected by vaccina- tion is greater in the BA network. Since the BA network has a degree distribution with algebraic decay, the effect of the Fig. 3. Vaccination model optimized for T\u00bc150under different constraints. We plot the optimal strategies and the corresponding susceptible, untested infected, and tested infected fractions at each degree kacross time t\u00bcnDt. (a) Heatmap of the optimal vaccination strategy vk\u00f0t\u00de=\u00f0sk\u00f0t\u00deNk\u00defor the BA network given by Algorithm 1. Panels (b,c) show the corresponding susceptible and infected subpopulations sk\u00f0t\u00deandik\u00f0t\u00de, while (d) plots the fraction infected as a func- tion of time, derived from solving (20)-(22) under optimal vaccination using a discount factor d\u00bc0:95. The dashed red curve indicates the fraction infected under optimal vaccination. For comparison, the infected population under no vaccination (solid black) and constant, uniform (dashed blue/circles ) vaccination are also plotted and show how optimizing vaccination signicantly suppresses infectivity. Panels (e-h) show the corresponding quantities for the S BM network. Optimal vaccination is less effective at decreasing infection in the SBM network than in the BA network, again because of the SBM's peaked (more homoge - neous) node degree distribution. Note from the logarithmic scale that vaccination is qualitatively more effective in reducing infections than test ing and quarantining.1428 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022optimal vaccination strategy will be more pronounced than for the SBM, whose nodes have similar degrees. V. D ISCUSSION Effective testing and vaccination strategies are an essential part of epidemic management. In this paper, we derived opti- mal testing and vaccination policies by applying Pontryagin's maximum principle to a degree-based epidemic model in a heterogeneous contact network. We complemented our analyt- ical results with reinforcement learning (RL) approaches that identify effective policies (see Appendix C). On occasions when the best optimal strategy can be analytically solved, the controls derived from Pontryagin's maximum principle out- perform RL-based interventions. However, reinforcement learning is useful for epidemic management problems when an efcient procedure for computing optimal solutions solu- tions is not available. Our results show that the two approaches can complement each other; preliminary ndings from opti- mal-control analysis can be used to pre-train and restrict the space of possible actions, which may lead to more efcient RL algorithms. In addition to RL-based control strategies, it may also be worthwhile to apply neural ODE control frame- works [47], [48] to resource allocation problems since they have exhibited better performance than RL and numerical adjoint system solvers. Our analytical results show that optimal testing and vaccina- tion policies under resource constraints initially tend to priori- tize nodes with higher degrees to control the spread of the disease. In situations where the number of contacts of individu- als is known or can be estimated with reasonable precision, Algs. 1 and 2 may be useful for identifying effective epidemic management strategies. Using our control-theoretic approach, we also explored the relative effectiveness of testing and vacci- nation under different conditions. If more information on con- tact patterns of individual nodes is available, it is possible to further rene the proposed policies using interventions that rely not only on node degrees but also on other structural fea- tures such as percolation and betweenness centrality [26], [49]. A. Effects of Delayed Intervention First, we consider the effectiveness of interventions as a function of the time between the rst infection and the imple- mentation of testing or vaccination. The initial conditions are set to be the same as (18) and (30). Fig. 4 shows the total frac- tion infected and the loss functions at T\u00bc150, for both the BA and SBM networks, as a function of intervention starting time t0. We set F\u00bcF\u00f0t\u00det>t 0orV\u00bcV\u00f0t\u00det>t 0and explore the effects of different constant levels of test kits or vaccine avail- ability, F\u00f0t\u00de\u00bc0:002N;0:004N;0:006N;0.008 N=day and V\u00f0t\u00de\u00bc0:001N;0:002N;0:003N;0.004 N=day, respectively. The transmissibility rates bu;b/C3;band the recovery rates gu;g/C3;gare set to the same values as those used in Section III for the testing model and those used in Section IV for the vacci- nation model. In the BA network, the total infected fraction shown in Fig. 4 (a) is fairly insensitive to starting times for all testing rates F,especially at small starting times t0950. However, the loss functions corresponding to all testing rates increase monotoni- cally with the testing starting time t0, as shown in Fig. 4(b). On the other hand, vaccination of a BA network leads to infected fractions that change signicantly with delay time, but with an overall vaccination-rate-dependent starting time before which disease spread can be nearly completely suppressed, as shown in (c). For the vaccination model applied to both networks, an ear- lier intervention time will always lead to fewer infected nodes. Overall, we found that earlier and stronger intervention meas- ures lead to more effective control of disease spread and a smaller loss function dened by (11), (25). For all cases, the test- ing loss functions monotonically increase with t0. Similarly, for the SBM model, the nal infections shown in Fig. 4(d) are insen- sitive to starting times t0950for each of the four choices of total testing budgets F. Earlier intervention times t0lead to smaller testing loss functions which indicate more effective early-time disease control and fewer early infections (which are followed by larger later infections) than those associated with later start times t0. Vaccination of the SBM network reveals more smoothly monotonically increasing infected fraction and loss functions and does not display the sigmoidal dependence on intervention time t0as exhibited by the infected fraction and loss function for the BA network. For the vaccination model applied to both networks, an earlier intervention time will always lead to fewer infected nodes. Overall, higher levels of FandVlead to high- knodes being addressed sooner and total infections can be reduced. In summary, for both networks, when the discount factor d<1, earlier intervention starting times t0more effectively reduce early infections although it might be at the cost of larger later infections. B. Dependence on Initial Conditions Besides the start time of testing or vaccination, initial condi- tions may also affect the optimal strategy. For example, the initial propagation of the disease may depend on the degree ki of the rst infected individual [50]. Instead of an initial infec- tious source that is uniformly distributed across all nodes, as described in (18) and (30), we vary the degree of the rst infected node and explore how the strategies change as a func- tion of concentrated initial condition ik\u00f00\u00de\u00bcN0k;ki=N.W e takeN0\u00bc10/C06Nfor both networks, ki\u00bc3;20;90for the BA network, and ki\u00bc5;20;30for the SBM network. These ferent initial conditions are IC1, IC2, and IC3 for each network, respectively. Optimal testing strategies are found to be subtly dependent on the initial conditions, i.e., the degree of the initial infected patient. In Fig. 5 we show only the optimal strategy associated with IC2, but plot the time-dependent fraction infected under optimal strategies for all ICs. Under both optimal testing and vaccination, a smaller degree of the rst infected source typi- cally leads to a smaller subsequent infected population. Spe- cically for testing, this decrease is greatest at intermediate times because at early stages there are fewer infecteds. At later times, the testing strategy becomes insensitive to the initialXIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1429condition because persons with all degrees are infected and those with a higher degree tend to be infected sooner. The optimal vaccination strategies obtained through Algo- rithm 1 are also relatively insensitive to initial conditions in both networks, particularly at longer times. Although not shown, the optimal strategies associated with different ICs are mostly the same because nodes with larger degrees tend to always be vacci- nated rst to minimize the loss function (25). Susceptibles with higher degrees are more vulnerable and should be vaccinated rst to mitigate subsequent infection events. For vaccination, the different ICs lead to long-term differences in infected frac- tions because low-degree ICs allows more time for vaccination to more effectively remove susceptibles. C. Monte-Carlo Simulation of Stochastic Network Model Our results are derived from a mass-action ODE model and it is unclear how they apply to stochastic network dynamics. To compare these different representations of the disease, we dene the discrete stochastic versions of our network models and impose a stochastic version of the optimal strategies found using the PMP on our ODEs. In Appendix D we implemented the opti- mal testing and vaccination strategies on the BA and SBM net- work realizations used in the PMP study. Infection, recovery, testing, and vaccination processes are described as Markov events in continuous time. Results from rejection-free, event- based Monte-Carlo simulation indicate that the degree-based mean-eld ODE model tends to overestimate new infections because it assumes that all subpopulations interact in a well- mixed manner, thus neglecting certain structural features of theconsidered networks. The loss function derived from the sto- chastic model and using the PMP-derived optimal strategy is shown to be lower than that of the ODE model, except for vacci- nation on the SBM network for which they are comparable. Nonetheless, optimal strategies derived from the ODE model still outperforms a uniform or unstructured testing or vaccination strategy applied to the discrete stochastic model. VI. S UMMARY AND CONCLUSIONS Our overall results indicate that different network structures ( e.g.,B A vs.SBM) have different susceptibilities to optimal inter- vention strategies. Thus, policies such as selective social distanc- ing can potentially be used to shift network structure towards one that is more sensitive to direct testing and vaccination strategies. We have analyzed testing and vaccination separately, but in practice, both are simultaneou sly implemented. The relative efforts of these two interventions, as a function of time, will depend on their constraints and c osts as well as the desired loss function time T. A further generalizatio n of either our mass-action or stochastic versions of our network models may be to derive dif- ferent loss functions other than ( 11) and (25) to take into account factors such as economic effects or prioritization of certain groups (e.g., healthcare workers or individu als with comorbidities). For- mulating more specic loss functions would allow one to balance mitigation and suppression strat egies, as studied in a well-mixed SIR model [12]. Another important and straightforward extension of our model is to consider the effe cts of waning protection of vac- cination, which has become a relevant feature of disease control in the context of booster shots. Recovered individuals that includeFig. 4. Total fraction infected under testing or vaccination model as a function of different intervention starting times t0. We minimize the corresponding loss function at T\u00bc150and use d\u00bc0:95. (a) The fraction infected in the BA network as a function of start times for different testing amplitudes F. The total infected fraction is fairly insensitive to intervention starting times, especially for small intervention delays. The effect of delayed vaccinati on on the fraction infected is shown in (c), with the corresponding loss function shown in (d). For the SBM network, the fraction infected as a function of testing start ti me shown in (e) reflects the small effect of testing on the infected population. However, the loss functions shown in (f) are monotonic in the starting time. This implies that an early intervention time on the SBM network is able to \"flatten\" the curve by postponing infection so even if total infections stay roughly the same whe nt0 varies in/C24\u00bd0;50/C138, the earlier the intervention time, the fewer the earlier infections, with little change in the nal total infected fraction. The starting time depen - dence of the fraction infected on an optimally vaccinated SBM network in (g) shows a monotonic and smooth decrease in effectiveness as vaccination is d elayed. In (h), the loss function for vaccination on the SBM network also monotonically increases with the start time.1430 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022previously vaccinated or infected individuals can become suscep- tible again at a rate equal to the rate of loss of immunity. Thus, another timescale (months) is introduced which is comparable to timescales Tthat are used to dene the loss function. We expect even wider variety and richness i n the analysis of optimization problems under waning immunity. Finally, the discrepancies between the effective degree ODE model and the Monte-Carlo simulations, under the same ODE- derived optimal strategies appear to arise from the differences in the underlying disease propagation. The discrete stochastic models tend to show lower infected fractions than the corre- sponding mass-action ODE models since its discreteness and nite infection lifetimes prevents high-degree nodes in some network regions to be infected while the mass-action model allows all nodes to be partially infected. Further analysis of fluctuations in real-world stochastic models could provide insight into a better estimation of optimal strategies without simulating the large space of intervention strategies. This and many other important extensions will be topics of future exploration. APPENDIX A BASIC REPRODUCTION NUMBER In this appendix, we analytically derive the basic reproduc- tion numberR0for uncorrelated networks and compare theresulting values with those obtained using (7) and (8). As a starting point, we note that the conditional degree distribution P\u00f0'jk\u00decan be expressed in terms of a symmetric (for undi- rected networks) joint degree distribution P\u00f0'; k\u00de, the proba- bility that a randomly chosen edge connects two nodes with degrees 'andk. Marginalizing P\u00f0'; k\u00deover'yields wherehki\u00bcP kkP\u00f0k\u00deis the mean degree. The conditional degree distribution is related to the joint distribution via P\u00f0'jk\u00de\u00bcP\u00f0'; k\u00de Pe\u00f0k\u00de\u00bchkiP\u00f0'; k\u00de kP\u00f0k\u00de\u00bcE';k kP\u00f0k\u00deN; (31) which can network limit where P\u00f0'; k\u00de/C25Pe\u00f0k\u00dePe\u00f0'\u00de: P\u00f0'jk\u00de/C25'P\u00f0'\u00de hki: (32) Equations (31) or (32) can be used as a simpler replace- ment for P\u00f0'jk\u00dein (2) and (3) if E';k=\u00f0kNk\u00deis not directly accessible. For example, for an uncorrelated Fig. 5. Dependence of intervention effectiveness on the degree of the initial infected individual. (a) The PMP-optimal testing strategy computed us ing IC2 (ki\u00bc20) on the and IC3 ( ki\u00bc90) are qualitatively similar (not shown) with small differences at the beginning leading to the different delays in the infection dynamics shown in (b). Specically, for IC1 and IC3, the initial transient of the optimal testing strategy max imizes the test- ing rate for the subpopulation with the same degree as k1andk3, respectively, indicating that the optimal testing strategy is sensitive to the degree properties of the initial seed infection. Once the disease spreads out, the testing strategies \"forget\" the initial condition and converge to each other. Despite o ptimal testing, ini- tial infecteds with larger degrees, such as IC3, lead to the earlier spread of the epidemic. Results are found by using a discount factor d\u00bc0:95, the optimal strat- egy given in Algorithm 1, and solving (2)-(5). (c-d) The optimal vaccination strategy for IC2 and the associated fraction infected for the BA network. As with testing, the vaccination strategies associated with IC1 ( ki\u00bc5) and IC3 ( ki\u00bc30) lead to differences in infection magnitudes. However, the optimal vaccination strategies are insensitive to different initial conditions, even at early times. Since the mechanism of vaccination is always to protect high-degre e susceptibles, the vaccination strategies are not as dependent on the current infected population as the testing strategies are. Panel (e) shows the optimal testing str ategy for the SBM network, assuming IC2 ( ki\u00bc20). (f) The fraction infected exhibits slower dynamics for smaller-degree initial conditions. (g) Optimal vaccination strategy for IC2 in the SBM network, and (h), the associated infected fraction showing both delay and amplitude changes with changes in the initial condition.XIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1431where we have set testing rates fk\u00f00\u00de\u00bc0at the start of the infection. According to [24], we hkiJ\u00f0t\u00de/C0guJu\u00f0t\u00de: (35) We perform state\u00f0I/C3;J/C3\u00de\u00bc\u00f0 0;0\u00deand nd the eigenvalues to (35): transition from negative to positive eigenvalues occurs for /C0gu\u00febuhk2i=hki\u00bc0. Hence, the basic reproduction number is R0\u00bcbu guhk2i hki\u00bcbu guhki\u00feVar\u00bdk2/C138 hki/C18/C19 : (37) If we use the conditional degree distribution P\u00f0'jk\u00de\u00bc \u00f0'/C01\u00deP\u00f0'\u00de=hkiproposed by Kiss et al. [24] to account for a reduction in neighboring susceptible vertices, the correspond- ing basic reproduction number is modied to RKiss 0\u00bcbu guhki/C01\u00feVar\u00bdk2/C138 hki/C18/C19 : (38) The mean degrees of the BA and SBM networks are 3.77 and 23.14, and the variances for the BA and SBM networks are 20.40 and 36.62, respectively. Using the values gu\u00bc14/C01=day andbu\u00bc0:0411=dayfor the BA network, we nd that the basic reproduction numbers R0\u00bc5:361andRKiss 0\u00bc4:777are larger than 4.5, the value we used to determine buaccording to the next-generation matrix method (see (7) and (8)). The observed approximation errors in (37) and (38) are a consequence of the assumption that the underlying network is uncorrelated. For the SBM network, we nd R0\u00bc4:499andRKiss 0\u00bc4:317,c l o s et o the 4.5 value used to nd bu\u00bc0:0130 using (7) and (8). To summarize, our comparison shows that in the SBM model where the degrees of neighbors are uncorrelated, (37) and (38) give close approximations of the actual reproduction number calculated from the next-generation matrix method (7). For the BA network, degree correlations make (37) and (38) overesti- mate the actual reproduction number. Therefore, we recommend using the next-generation matrix method to numerically deter- mine the basic reproduction number unless degree correlations are weak and (37) and (38) can provide accurate estimates of R0. APPENDIX B OPTIMAL TESTING AND VACCINATION ALGORITHMS Below, we explicitly give the pseudo-code for the testing and quarantine model based on Pontryagin's maximum principle.APPENDIX C REINFORCEMENT -LEARNING STRATEGY To identify effective testing and vaccination strategies, we also investigated reinforcement-learning (RL) approaches. RL explores the space of all possible actions and directly opti- mizes the loss functions for testing and vaccination dened in (11) and (25). Here, we use an RL approach with experience replay to learn both the optimal testing strategy in (2)-(5) and the optimal vaccination strategy in (20)-(22). Typically, applying a policy-gradient method to a continu- ous action space will usually yield poor results due to the inability of such methods to explore the whole space. How- ever, using our previous results based on PMP, we know that the optimal strategy is always obtained by maximizing the testing and vaccination rates for subpopulations presumed to be at a higher risk. Therefore, we do not need to explore the whole space of all possible actions. Instead, from (16), (26), we can restrict our strategy space to the extreme points1of the set f\u00f0fk\u00dejK k\u00bc1jXK k\u00bc1fk\u00bcF\u00f0t\u00de;fmin/C20fk Nk/C20fmaxg (39) for determining the testing-resource allocation and the extreme points of the setAlgorithm 2: Pseudo-Code of Q-Learning in Testing F;d;C,sk\u00f00\u00de,iu k\u00f00\u00de;i/C3 k\u00f00\u00de;bu;b/C3;gu;g/C3;M ;/C15 2: Initialize the hyperparameter set Q/C0 Qfor evaluat- 6: fort\u00bc0:Tmax/C01do an ai 8: otherwise select At\u00bcargmaxAQ\u00f0St;A;Q\u00de 9: Execute action a gradient descent step on the minibatchP j\u00bdyj/C0Q\u00f0Sj;Aj;Q\u00de/C1382with respect to the network hyperparameter set Q 17: end if 18: end for 19: Every Csteps reset Q/C0 Q 20:end for 1Extreme points are points in a set that cannot be written as a nontrivial convex linear combination of any other points in the same set.1432 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022f\u00f0vk\u00dejK k\u00bc1jXK k\u00bc1vk\u00bcV\u00f0t\u00de;vmin/C20vk Nsk\u00f0t\u00de/C20vmaxg (40) for determining vaccination- resource allocation at each step. The set of extreme points represents all strategies that maximize the testing/va ccination rates for some groups and minimize them for other groups. Such strate- gies also cannot be written as nontrivial convex combina- tions of other strategies. By c onning ourselves to extreme points, the possible action space is reduced to a nite set on which we perform RL. Since the curse of dimensionality increases the number of all possible strategies exponentially with K, we further restrict our RL approach to networks with degree cutoff K\u00bc 20. This additional constraint allows us to perform RL with a computation time of about 30 days for the testing model on the BA network, 3 days for the testing model on the SBM network, 6 hours for the vaccination model on the BA net- work, and 2 hours for the vaccination model on an SBM net- work. All computations are performed using Python 3.8.10 on a laptop with a 4-core Intel(R) Core(TM) i7-8550 U CPU @ 1.80 GHz. To identify effective testing and vaccination strategies, we use the reward functions (11) and (25). We dene the reward at time ti\u00bciDtas R\u00f0Si;Ai\u00de\u00bcXK k\u00bc1sk\u00f0ti\u00fe1\u00de/C0sk\u00f0ti\u00de\u00bd/C138 ; (41) the \"negative\" of the number of total infections during the the vaccination model (20)-(22). We recursively dene the state-value function under Vp\u00f0Si;i\u00de\u00bcVp\u00f0Si\u00fe1\u00ded\u00feR\u00f0Si;p\u00f0Si\u00de\u00de;t i<T max; 0;t i\u00bcTmax;/C26 (44) where p\u00f0Si\u00deis the action determined under policy pgivenSi andd2\u00f00;1/C138is a discount factor. We also dene the function to be action-value and state-value functions, respectively, under the best policy and apply the deep Q-learning algorithm, which has been used to nd the RL strate- gies that can approximate optimal strategies of certain Atari 2600 games [52]. Here, we use a neural network with a hyper- parameter set Q, representing neural-network weights and biases to estimate the action-value function under the best policy Q/C3\u00f0S;A;Q\u00de, which is improved over epochs by Algorithm 2. An illustration of the neural network, its layers, and activa- tion functions, is shown in Fig. 6. We use another neural net- work with a hyperparameter set Q/C0updated every C\u00bc4 steps to match Q. The neural network contains NH\u00bc4hidden layers with H\u00bc30neurons in each layer. The input data is the state at the ithstepSi, and the output is V/C3\u00f0Si;Q\u00de, the pre- diction for the optimal state-value function generated by the neural network. In each layer, the batch normalization tech- nique is used before a rectied linear unit (ReLU) function is applied as an activation function. We compare the optimal strategies based on the PMP approach from Algorithm 1 with the RL strategies that are based on Algorithm 2. We set T\u00bc 100 andDt\u00bc1so that the strategy is updated every day. Here, we use fmin\u00bc0:002=day;fmax\u00bc0:4=day. We use (7) with gu\u00bc\u00f01=14\u00de=dayto calculate bu\u00bc0:0703=dayfor theFig. 6. Illustration of the neural network used to identify effective testing and vaccination strategies. The inputs of the input layer are \u00f0s1\u00f0ti\u00de;...;sK\u00f0ti\u00de;iu 1\u00f0ti\u00de;...;iu K\u00f0ti\u00de;i/C3 1\u00f0ti\u00de;...;i/C3 K\u00f0ti\u00de\u00de2R3K. For each hidden layer normalize the corresponding outputs xi;jfor all sam- ples in a minibatch such that the resulting values ^xi;jhave zero mean and unit variance. These values are used as inputs to a rectied linear unit (ReLU) activation function in the next hidden layer. Neurons labeled 1 are bias terms. The output V/C3\u00f0Si;Q\u00deis an estimate of the state-value function under the optimal policy (see (44)), where Qdenotes the set of hyperparameters.XIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1433K\u00bc20BA network and bu\u00bc0:0632=day for the K\u00bc20 SBM network. Both PMP and RL strategies are also compared to the uniform testing strategy (19). For RL, we train the underlying neural network for M\u00bc100epochs using Algo- rithm 2. Fig. 7 shows the differences between the infected fractions in simulations with and without testing. The PMP- based optimal control reduces early infections the most for both BA and SBM networks. Early infections contribute more to the loss function (11) since we set the discount factor to d\u00bc 0:95. We also observe that RL-based testing strategies outper- form uniform testing in reducing early-stage infections. Com- paring Fig. 7(a) and (b), the effect of the optimal vaccination strategy in the BA network is more pronounced than that in the SBM network. In the BA network, node degrees are more heterogeneous and most nodes have small degrees, indicating that epidemic spreading can be controlled effectively as long as the few high-degree nodes are monitored and tested. Finally, comparing the result of the optimal-control approach in Fig. 7 with Fig. 2, we observe that with a smaller Kin the SBM network, the effect of the optimal vaccination strategy is less apparent because node degrees are more homogeneous. Next, we compared the PMP approach with the RL approach for the optimal vaccination strategy model (20)- (22). Here, we set vmin\u00bc0:0001;vmax\u00bc1. For both net- works, the optimal vaccination strategy obtained using PMP can most effectively reduce the initial infections because early infections have a higher weight in the loss function (25). Rein- forcement-learning-based vaccination policies can also reduce initial infections, but the reduction is less than that of the PMP approach. Comparing Fig. 8(a) and (b), we again observe that the effect of the optimal vaccination strategy for the BA net- work is more pronounced than that of the SBM network because the BA network has a more heterogeneous degree and is dominated by small-degree nodes. To summarize, the controls derived from PMP are more effec- tive than those based on RL. One limitation of RL-based inter- ventions is that the possible action space that needs to be explored is usually large. However, based on our PMP results, we can constrain the action space before the learning process.Such PMP-informed constraints allow us to explore just the extreme points of the whole action space and thus make the training more efcient. Yet, the total number of possible actions grows exponentially with the maximal degree Kand the strat- egy obtained by the RL approach will probably be only locally optimal, violating the PMP condition and thus under performing PMP. Nonetheless, RL could be useful if a procedure for com- puting an explicit solution cannot be formulated. APPENDIX D SIMULATIONS OF CORRESPONDING STOCHASTIC MODELS We impose the optimal testing and vaccination strategies derived from applying PMP to the ODE system (2)-(5) and (20)-(22) on a simple discrete stochastic model and compare the resulting total infections. The corresponding optimal testing or vaccination is implemented by probabilistically testing or vacci- nating each selected subpopulation. For example, in the testing model, we can employ a rejection-free event-based Monte-Carlo (MC) algorithm [53] that implements a testing strategy. For initial conditions, we randomly choose two nodes with degree k\u00bc10to be infected. Correspondingly, for the determin- istic ODE models, we set sk\u00f00\u00de\u00bcp\u00f0k\u00de/C02 Nk;10;iu k\u00f00\u00de\u00bc the testing model and sk\u00f00\u00de\u00bcp\u00f0k\u00de/C0 2 Nk;10;ik\u00f00\u00de\u00bc2 Nk;10for the vaccination model. We set the recovery rates g\u00bcgu\u00bcg/C3\u00bc\u00f014\u00de/C01=day and use the same reproduction number R0\u00f0bu\u00de\u00bc4:5to calculate the uncon- strained infection rates for the two networks from (7). The loss functions dened for the testing and vaccination models in (11) and (25) are plotted below. From Fig. 9, the deterministic ODE models tend to overesti- mate the loss functions since all subpopulations are well mixed by the conditional degree distribution function P\u00f0'jk\u00deand there- fore a single infected node could have an impact on the whole system. This difference arises because in a fully discrete realiza- tion of a BA or SBM network, each node can be in only one of three or four states and the disease may never arrive at certain Fig. 7. Reduction in fractions of infected individuals calculated as the differ- ence between the fractions infected obtained with testing and without testing for the BA network shown in (a) and the SBM network shown in (b). The opti- mal control approach based on PMP reduces early infections the most. RL out- performs uniform testing in reducing the number of early-stage infections. Additionally, the effect of the optimal strategy is more striking in the BA net- work because it has a more heterogeneous node degree distribution. Fig. 8. Fractions of infected individuals with vaccination and without vacci- nation for the BA network is shown in (a) and the SBM network is shown in (b). The optimal control approach using PMP can most effectively reduce infections for both networks and successfully suppress the spreading of the disease in the BA network. On the other hand, although not as good as the PMP-optimal strategies, the strategies obtained by the RL algorithm Algo- rithm 2 can obviously reduce infections compared to the uniform vaccination rate strategy. As with testing, we observe that the effect of optimal vaccination is more pronounced in the BA network than in the SBM network.1434 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. 9, NO. 3, MAY/JUNE 2022critical nodes, signicantly delaying its spread allowing the overall infection to dissipate before ever reaching portions of the network. In contrast, the mass-action ODE model allows all nodes to be partially infected, allowing continuous transmission of the disease. Therefore, more network measures may be needed to accurately quantify the dynamics of disease spread across discrete agent-based network models. Higher-order inter- actions beyond the pairwise conditional degree distribution [54]- [56] could be helpful in explaining the discrepancy between deterministic ODE and stochastic models and in estimating opti- mal policies in the fully stochastic context. Nonetheless, Fig. 9 shows that the PMP-based interventions that we derived in the main text are also more effective than uniform testing and vaccination strategies in the stochastic agent-based model. This loss function reduction arises for both the BA and SBM networks. Thus, the optimal testing and vaccination strategies obtained from the deterministic model outperforms uniform testing and vaccination strategies even when applied on discrete stochastic network models, repre- senting a reasonable starting point for approximating optimal strategies within agent-based discrete systems. ACKNOWLEDGMENT The authors thank S. K. Lyons for help in editing the manuscript and the reviewers for their valuable comments.REFERENCES [1] B. Abdalhamid, C. R. Bilder, E. L. McCutchen, S. H. Hinrichs, S. A. Koepsell, and P. C. Iwen, \"Assessment of specimen pooling to conserve SARS-CoV-2 testing resources,\" Amer. J. Clin. Pathol. , Yelin et al. , COVID-19 RT-qPCR test in multi sample pools,\" Clin. Infect. Dis. , vol. 71, no. 16, pp. 2020. [3] B. J. Quilty et al. , \"Quarantine and testing strategies in contact tracing for SARS-CoV-2: A modelling study,\" Lancet Public Health , vol. [4] T. Schneider et al. , \"Epidemic risk- dependent individual contact interventions,\" 2021, arXiv:2109.10970 . [5] S. Moore, E. M. Hill, L. Dyson, M. J. Tildesley, and M. J. Keeling, \"Modelling optimal \"Optimal in age-structured populations,\" SIAM J. Appl. , vol. 59, no. 1, pp. 222-241, 1998. [7] Z. Zhao et al. , \"The optimal vaccination strategy to control COVID-19: A modeling study based on the transmission scenario in Wuhan City, China,\" Infect. Dis. Poverty , vol. 10, 2020, Art. no. 140. [8] R. P. Curiel and H. G. Ram /C19rez, \"Vaccination strategies against COVID-19 and the diffusion of anti-vaccination views,\" Sci. Rep. , vol. 11, 2021, Art. M. A. vaccination vaccine-induced immunity responses,\" Biosci. and E. Shim, \"Optimal strategies for social distancing and testing to control COVID-19,\" J. Theor. Biol. , vol. 512, 2021, Art. no. 110568. [12] S. Nowak, P. N. de Lima, and R. Vardavas, \"Should we mitigate or suppress the next pandemic? Time-horizons and costs shape optimal social distancing strategies,\" medRxiv ,2 0 2 1 ,d o i : 10.1101/2021.11.14.21266322 . [13] L. Bolzoni, E. M. Groppi, \"Optimal con- trol of epidemic size and duration with limited resources,\" Math. Biosci. , vol. 315, 2019, Art. no. 108232. [14] P. Ogren and C. F. Martin, \"Optimal vaccination strategies for the con- trol of epidemics in highly mobile populations,\" 1782-1787. [15] Z. Wang, C. Xia, Z. Chen, and G. Chen, \"Epidemic propagation with positive and negative preventive information in multiplex networks,\" IEEE Trans. Cybern. 2021. [16] F. Liu and M. Buss, for heterogeneous node-based information IEEE Trans. 7, no. 3, pp. 1115-1126, Sep. 2020. [17] B. Wang, Y. Sun, T. Q. Duong, L. D. Nguyen, and L. Hanzo, \"Risk- aware identication of highly suspected COVID-19 cases in social IoT: A joint graph theory and reinforcement learning approach,\" IEEE Access , vol. 8, pp. 115655-115661, 2020. [18] R. M. May and R. M. Anderson, \"The transmission dynamics of human immunodeciency virus (HIV),\" Philos. Trans. Roy. Soc. London, B. Biol. , vol. 321, no. 1207, pp. Pastor-Satorras, and A. Vespignani, \"Velocity and hierarchical spread epidemic outbreaks in scale-free networks,\" Phys. Rev. Lett. , vol. 92, no. 17, no. 178701. [20] R. Pastor-Satorras and A. Vespignani, \"Epidemic dynamics and endemic states in complex networks,\" Phys. Rev. E , vol. 63, no. 6, 2001, Art. no. 066117. [21] R. Pastor-Satorras and Phys. Rev. Lett. , vol. 86, no. 14, Art. no. 3200. [22] M. Bogun /C19a, R. Pastor-Satorras, and A. Vespignani, \"Absence epidemic scale-free networks with degree correlations,\" Phys. Rev. Lett. , vol. 90, no. 2, 2003, Art. no. 028701. [23] M. Barth /C19elemy, A. Barrat, R. Pastor-Satorras, and A. Vespignani, \"Dynamical patterns of epidemic outbreaks in complex heterogeneous networks,\" J. Theor. Biol. , vol. 235, no. 2, pp. 275-288, 2005. [24] I. Z. Kiss, D. M. Green, and R. R. Kao, \"The effect of contact heteroge- neity and multiple routes of transmission on nal epidemic size,\" Math. Biosci. , vol. 203, no. 1, pp. 124-136, 2006. [25] J. Lindquist, J. Ma, P. Van den Driessche, and F. H. Willeboordse, \"Effective degree network disease models,\" J. Math. Biol. , vol. 62, no. 2, pp. 143-164, 2011.Fig. 9. Loss functions associated with the deterministic ODE models (2)-(5) and (20)-(22), and the corresponding stochastic models. We apply PMP-based (solid lines) and uniform (dashed lines) testing and vaccination protocols. Pan- els (a) and (b) show the loss functions (11) and (25) associated with testing and vaccination interventions in a BA network. Results from the ODE models are shown in blue while the loss functions derived from the simulated stochastic model are shown in red. Panels (c) and (d) show loss functions for the testing and vaccination models in the SBM network. Note the different scales for the ODE (blue, left) and the MC (red, right) results. The loss functions of the dis- crete stochastic models are obtained by averaging over 100 trajectories with the standard error of the mean (standard deviation of means divided by Np ) indicated by the error bars. For both networks, the deterministic ODE models yield larger losses than those obtained from averaging MC trajectories. For both deterministic ODEs and stochastic systems, the loss functions during optimal testing and vaccination are much smaller than when testing and vacci- nation are uniformly applied.XIA et al. : CONTROLLING EPIDEMICS THROUGH OPTIMAL ALLOCATION OF TEST KITS AND VACCINE DOSES ACROSS NETWORKS 1435[26] M. Newman, Networks . London, U.K.: Oxford Univ. Press, 2018. [27] L. B \u20acottcher, M. R. D'Orsogna, and T. Chou, \"Using excess deaths and testing statistics to determine COVID-19 mortalities,\" Eur. J. Epidemiol. , vol. 36, M. R. D'Orsogna, and T. Chou, \"A statistical model of COVID-19 testing in populations: Effects of sampling bias and testing errors,\" Philos. Trans. Roy. Soc. A , 20210121. [29] A.-L. Barab and \"Emergence of networks,\" Science , vol. 286, no. 5439, of complex networks,\" vol. 74, no. 1, pp. 47-97, 2002. [31] P. W. Holland, K. blockmo- dels: 109-137, 1983. [32] A. Noulas, C. Mascolo, and V. Blondel, \"A place-focused model for Social Comput. Zhao et al. \"Consistency of community detection in networks under degree-corrected stochastic block models,\" Ann. Statist. , vol. 40, no. 4, pp. 2266-2292, 2012. [34] P. Van den Driessche and \"Reproduction numbers and sub-threshold endemic compartmental models 1-2, [35] J. J. A. Metz, \"On the denition and the computation of the basic reproduction ratio R0in models for infectious diseases in heterogeneous populations,\" J. Math. Biol. , vol. 28, no. 4, pp. 365-382, 1990. [36] Y. Wang et al. , \"Estimating the basic reproduction number of COVID-19 in Wuhan, China,\" Chin. J. Epidemiol. , vol. 41, no. 4, 2020. D'Arienzo and the SARS-CoV-2 basic reproduction number, R0, based on the early phase of COVID-19 out- break in Italy,\" Biosafety Health , vol. 2, no. 2, pp. G. G. Katul, A. G. Manoli, and A. J. Parolari, \"Global convergence of COVID-19 basic reproduction number and estimation from early-time SIR dynamics,\" PLoS One , vol. 15, no. 9, 2020, Art. no. e0239800. [39] M. P. Barman, T. Rahman, K. Bora, and C. Borgohain, \"COVID-19 pandemic and its recovery time of patients in India: A pilot study,\" Diabetes Metabolic Syndrome: Clin. 1205- 1211, 2020. M. Aseev et al. , \"Reduction in effective reproduction number of COVID-19 is higher in countries employing active case detection with prompt isolation,\" J. Travel Med. , vol. 27, no. 5, pp. 1-3, 2020. [42] A. Hyal and D. Mori ~na, \"Analysis of the impact of lockdown on the reproduction number of the SARS-CoV-2 in Spain,\" Gaceta pp. 453-458, 2020. [43] G. Zaman, Y. H. Kang, G. Cho, and I. H. Jung, \"Optimal strategy of vaccination & treatment in an SIR epidemic model,\" Math. Comput. time,\" Anaesthesia, Crit. Care Pain Med. , vol. 40, no. 2, 2021, Art. no. 100848. [45] L. B \u20acottcher and J. Nagler, \"Decisive conditions strategic vaccination against SARS-CoV-2,\" Chaos: An Interdiscipl. J. Nonlinear Sci. , vol. 10, 2021, no. 101105. [46] E. Mathieu et al. , global database Antulov-Fantulin, \"Neural ordinary differential equation cont rol of dynamics on graphs,\" Phys. Rev. Res., to be published.[48] L. B \u20acottcher, Antulov-Fantulin, and T. Asikis, \"AI or networks to control dynamical systems,\" Nature Commun. vol. 13, 2022, Art. no. networks,\" PLoS One , vol. 8, no. 1, 2013, Art. e53095. [50] G. /C19Odor, D. Czifra, and M. Karsai, phenomenon by epidemic seeding on geometric networks,\" Proc. Nat. Acad. Sci. USA , vol. 118, no. 41, 2021, Art. no. e2112607118. [51] S. Weber and M. Porto, of arbitrarily two-point-correlated random networks,\" Phys. Rev. E , vol. 76, no. 4, 2007, Art. no. 046111. [52] V. Mnih et al. , \"Human-level control of coupled chemical reactions,\" J. Phys. Chem. , vol. 81, no. 25, 1977. G. Petri, models of social contagion,\" Nature Commun. , vol. 10, no. 1, 2019, Art. no. 2485. F. Battiston et 1-92, 2020. [56] W. Li, X. Xue, L. Pan, T. Lin, and W. Wang, \"Competing spreading dynamics in simplicial complex,\" Appl. Xia received his bachelor's degree in infor- mation and computing science from Peking Univer- sity, Beijing, China, in 2019. He is currently working toward his Ph.D. degree in the Department of Mathe- matics, University of California, Los Angeles, CA, USA. His research interests include mathematical modeling and computational methods. Lucas B \u20acottcher received his Ph.D. degree in theoret- ical mathematics from Eidgen \u20acos- sische Technische Hochschule (ETH) Zurich, Zurich, Switzerland, in 2018. He is an Assistant Professor of computational social science in the Frankfurt School of Finance & Management, Frankfurt, Germany. He joined the Department of Computational Medicine, University of California, Los Angeles, CA, USA, as a Swiss National Fund fellow in 2020. His research interests include applied mathematics, statistical mechanics, and machine learning. Tom Chou received his Ph.D. degree in physics from Harvard University, Cambridge, MA, USA. He was a Postdoctoral Researcher at Cornell University, Ithaca, NY, USA, University of Cambridge, Cam- bridge, U.K., and Stanford University, Stanford, CA, USA. He is currently a Professor in the Departments of Computational Medicine and Mathematics, Uni- versity of California, Los Angeles, CA, USA. His research interests include statistical physics, applied mathematics, and mathematical biology.1436 IEEE TRANSACTIONS ON NETWORK SCIENCE AND ENGINEERING, VOL. "}