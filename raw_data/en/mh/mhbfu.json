{"title": "PDF", "author": "PDF", "url": "https://www.researchsquare.com/article/rs-2929935/v1.pdf", "hostname": "PDF", "description": "PDF", "sitename": "PDF", "date": "PDF", "cleaned_text": "Similarity matching of TCM prescription rational medication based on Siamese network Wangping Xiong Jiangxi University of Chinese Medicine Kaiqi Wang Jiangxi University of Chinese Medicine Shixiong Liu Jiangxi University of Chinese Medicine Zhaoyang Liu Jiangxi University of Chinese Medicine Yimin Zhu Jiangxi University of Chinese Medicine Peng Liu Jiangxi University of Chinese Medicine Ming Yang ( liumore@jxutcm.edu.cn ) Jiangxi University of Chinese Medicine Xian Zhou Jiangxi University of Chinese Medicine Research Article Keywords: Rational medicine use, Recommendation of medicatio n method, Prescription matching, AHP , Siamese-BiLSTM Posted Date: May 19th, 2023 DOI: https://doi.org/10.21203/rs.3.rs-2929935/v1 License: This work is licensed under a Creative Commons Att ribution 4.0 International License. Read Full License Additional Declarations: No competing interests reported. Similarity matching of TCM prescription rational medication based on Xian Zhou1 1 School of Computer, Jiangxi University of Chinese Medicine, Nanchang 3 30004, Jiangxi, China 2 School of Pharmacy, Jiangxi University of Chinese Medicine, Nanchang 330004, Jiangxi, China * Correspondence: Email: liumore@jxutcm.edu.cn. Abstract Background: Chinese medicine taking is an important link to ensure rational medicine use, and p rescription matching can excavate more information on medicine use. traditional Chinese medicine (TCM) p rescription data feature relationship is complex and multi-dimensional, and the prescription similarity matching model suff ers from single attribute quantification, lack of elemental relationships, and the similarity of efficacy and primary function cannot be quantified, which brings challenges to the quantification of prescription similarity. Methods: The focus of this study is to construct a framework for matching tr aditional Chinese medicine prescriptions with classic formulae, which integrates multiple features (MFTCMC) and explores the classic formu lae contained in prescriptions to provide references for the medication-taking behavior of clinical traditional Chinese medicine prescriptions. Firstly, the prescription compatibility weight is calculated through Analytic Hierarchy Process (AHP), and the variou s dosage weights of herbs are integrated to construct a comprehensive weighting met hod, which selects a set of key herbs to form a core prescription. Secondly, the performance features of the cor e prescription are quantified by using the attribute labeling strategy of Chinese medicine properties. Finally, the relationship features of th e core prescription are extracted b y using a Bidirectional Long Short-Term Memory Network (BiLSTM), and the vec tor representation similarity matrix is constructed by combining the Siamese network framework. The matching score between the core prescription and the classic formula is calculated through a fully connected layer, and the traditional medicatio n method of the matched classic formula is selected to provide references for the medication behavior of clinical prescriptions. Results: Based on the prescription matching dataset constructed in this paper, the precisio n and F 1 value reached 94.45% and 94.34% respectively, which is a significant improvement compared to several oth er models. Conclusions: Compared with other models, the proposed MFTCMCF can effectively improve the per formance of matching between prescriptions and classic formulae, and the results are more in line with the clinical practice of traditional Chinese medicine. This further improves the medication behavior of clinical prescriptio ns and provides new insights for research on recommended methods of taking traditional Chinese medicine prescriptio ns. Keywords: Rational medicine use, Recommendation of medication method, Prescription matching, AHP, Siamese- BiLSTM Background According to the 2022 drug safety report by the World Health Organization (WHO), medication harm accounts for 50% of all preventable medical harm worldwide, and the increased healthcare costs due to medication harm reach as high as $42 billion annually[1] . The rational use of traditional medicine is also facing significant challenges. According to the latest WHO Global Medical Curriculum, TCM is an effective and popular complementary and alternative medicine for the prevention and treatment of various diseases[2]. However, the incidence of serious adverse reactions to Chinese herbal medicine has increased significantly compared to overall drug growth, and reports of adverse reactions from oral administration of TCM have shown a year- on-year increase, making the safety of TCM Page 2 of 13 use an urgent issue to be addressed[3 ]. The method of administration is the final step in oral medication and directly affects the clinical efficacy of TCM, making it a weak link in clinical pharmacy services for TCM[4]. Different prescription taking methods of TCM are well- documented in ancient medical texts, but traditional methods of administering TCM are not well-reflected in modern clinical practice and pharmaceutical services. Moreover, most clinical prescriptions are modifications of classic formulas, and administration methods rely on traditional administration methods of the classic formulas. Therefore, establishing a similarity match between clinical prescriptions and classic formulas to obtain an evidence-based administration method has practical clinical significance[5,6 ]. Matching clinical prescriptions to classic formulas presents the following challenges: First, incomplete quantification of attributes, as TCM formulas possess multidimensional characteristics[7 ]. The lack of quantified attributes may render the model incapable of predicting outcomes. Second, there is a lack of evaluation of element relationships, making it difficult for the model to effectively capture the regular information inherent in TCM medication principles. A multi-dimensional matching method between actual prescription and classic prescription based on a Siamese network (MFTCMCF) is proposed to address the aforementioned challenges. MFTCMCF consists of three stages. In the first stage, the key herbs extraction operation is performed based on the compatibility and dosage weight of herbs according to the guidance of TCM theory. In the second stage, a digital algorit hm for quantifying the performance of TCM formulas is proposed, which integrates functional attributes such as TCM Herbal Properties (TCM-HPs) and generates multi-feature quantized representations of formulas based on their basic properties. The final stage is to transform the clinical auxiliary task of TCM administration into a matching problem between clinical prescription and classic prescription and incorporate the semantic relationship of TCM properties into the similarity calculation process, providing a reference for the administration of clinical prescription through matching with classic prescription. Therefore, this framework is based on the characteristics and formulation principles of TCM, improving the accuracy of key medicine flavor extraction while enhancing the accuracy of similarity calculation. This article's main contributions are as follows: (1) Establishing a comprehensive quantitative framework for the matching of clinical prescriptions and classic formulas, named MFTCMCF, based on TCM theory and the multi- dimensional characteristics of formulas. The framework is used to identify classic formulas and provide references for the clinical prescription medicine, filling the gap in the taking methods of TCM prescriptions; (2) Proposing a key herbal extraction algorithm that enhances the precision of extracting key herbal by using the analytic hierarchy process (AHP) for the weighted combination of herbal compatibility and dosage; (3) Proposing a multi-feature fusion formula matching algorithm, which quantifies the performance attributes of the formula and incorporates the semantic relationships of TCM properties into the similarity calculation process, thereby improving the accuracy of similarity calculation; (4) The clinical prescription and classic formula matching framework proposed in this article outperforms classical algorithms and existing formula similarity quantification methods in terms of accuracy, precision, recall, and F 1 value. Related work Prescription similarity quantification Quantification of formula similarity is a key technique in the field of data mining in TCM. Previous studies have utilized various quantification methods, such as string, set, vector distance, probability distribution, and application models. Cao et al.[8 ] introduced a set similarity model to calculate similarity, using the Jaccard similarity coefficient between formulas as the similarity measure. However, TCM formulas often have similar or identical functions among different herb components, and the Jaccard similarity coefficient cannot handle the inherent relationships among formula components. Li et al.[9] used cosine similarity to compare formula similarity, taking the formula composition and herbal dosage as vector coordinates and normalizing the dosage standards. This method performs better than simply comparing formula compositions. Gu et al.[ 10] considered factors such as drug name, description, dosage, and assigned weights, using the k-Nearest Neighbor (kNN) algorithm to recommend similar formulas. Guo et al.[ 11] adjusted the classic TF-IDF algorithm, defining as the frequency ratio of the number of occurrences of a Chinese herb j in all formulas to the total frequency () =1 of all Chinese herbs in C. This method only uses formula composition as a feature. Zhu et al.[ 12] applied a Page 3 of 13 latent Dirichlet allocation (LDA) model, converting formulas into vectors by calculating the probability distribution of \"formula- syndrome\" and \"syndrome-herb\" relationships. Formula similarity was measured by the Kullback-Leibler divergence ( KL) divergence between two formula vectors. However, the correspondence between formulas and syndromes in this method is not based on traditional Chinese medical theory. These methods each have their advantages but also have certain limitations, lacking a comprehensive quantification model that covers the main attributes of formulas. In addition, the relationships between various elements of formulas, such as herbal compatibility, lack effective evaluation and quantification. Text matching Text matching plays a very important role in the field of natural language processing. Many applications can be abstracted as text- matching problems, such as semantic similarity and information retrieval. Pang et al.[ 13] proposed the Match Pyramid model, which converts the word vector matrices of two texts into a two- dimensional graph form through dot product, and then uses CNN to perform convolutional operations on the two-dimensional graph. Fang et al.[ 14] treated text matching as an image text extraction problem, using a single fully convolutional neural network for text detection and cropping, and matching the text with a specific dictionary. Chen et al.[ 15] proposed a multi- channel convolutional neural network model for text matching, providing additional attention mechanisms for sentence and text semantics. Guo et al.[ 16] built a text representation model based on the siamese structure of neural networks, introducing three optimization strategies of vocabulary semantic features, step convolution, and k-max mean sampling, extracting rich semantic features respectively at the word granularity, phrase granularity, and sentence granularity. Pontes et al.[ 17] used CNN and LSTM networks to extract text features for text similarity analysis tasks. Wu et al.[ 18] integrated the BERT model and boosting tree model and applied them in a question-answering system. Chen et al.[ 19] used a bidirectional long short-term memory (Bi-LSTM) to capture the distance relationship between words with different weights and used decomposable attention to speed up semantic matching computation . These text-matching methods mostly calculate the semantic relevance of two complete sentences, serving common tasks such as sentence similarity calculation and question answering. It is difficult to directly apply them to the task of quantifying the similarity of TCM formulae. Methods Fig. 1 shows the overall design of MFTCMC. Firstly, the pre- processed TCM prescription text data is weighted using compatibility and dosage weights to extract key herbs, obtaining the core prescription composed of a set of key herbs as input to the matching model for similarity matching with classic prescriptions. Secondly, a vector space model combined with TCM corpus is utilized to construct semantically meaningful word vectors. Then, the characteristic vector of core prescription attributes was obtained by quantification of TCM properties and to obtain the semantic information of the hierarchy of core prescription properties. Finally, a Siamese Bi-LSTM prescription matching model is designed to integrate the semantic information of TCM properties, and to calculate the similarity between the actual prescription and classic prescription to determine whether there is a match. The traditional medicine taking method of the matched classic prescription is used as a reference for the taking method of the prescription. Preprocessing of T CM prescription text data There are practical problems such as complexity, mutual redundancy, and non-standardization in TCM prescription text data, such as the inconsistent expression of terms and the non- uniform measurement units for medication quantities in prescriptions[ 20,21]. Considering the unique expression forms and characteristics of TCM text, it is necessary to preprocess the original data to further improve the accuracy of feature extraction. The main preprocessing operations are as follows: (1) Text segmentation: First, stop words, special characters, and punctuation marks in the text are removed using the method of loading a stop word list to reduce noise and interference with the semantic meaning of the text. Then, the Jieba Chinese word segmentation library is used to segment the text. To address the difficulty of recognizing proprietary terms in the field of TCM, a dictionary of Chinese medicine vocabulary is loaded as the segmentation dictionary to improve the recognition rate of proprietary nouns[ 22]. (2) Terminology normalization: According to the guidance of clinical experts in TCM, referring to the Coding Rules and Coding of Chinese Medicine (National Standard [GB/T 31774- 2015]) and the Chinese Pharmacopoeia (2020 Edition), the preprocessed drugs are strictly normalized and annotated, and a synonym table is constructed to define the standard terms for each Page 4 of 13 Fig. 1 MFTCMC overall design class of synonyms, realizing the organization and standardization of TCM text data. Extraction of key herbs The Analytic Hierarchy Process (AHP) method obtains the weight coefficients of each index based on subjective evaluation and quantifies the priority information between each pair of evaluation indexes, which reflects the contribution degree and priority order of each index. However, this method is subject to differences in personal judgment standards, and the weights constructed lack stability[ 23]. Therefore, a comprehensive weighting method is proposed. According to the hierarchical relationship of monarch, minister, assistant, and guide compatibility in TCM, the AHP method is used for weighting, while weighting is also assigned based on the dosage of medicine , and the two weights are combined using a linear method. In the key herbs extraction stage of the MFTCMCF framework, the formula for calculating the weight of Chinese medicine is used to improve the accuracy of key herbs extraction by increasing the rationality of the Chinese medicine weighting. The specific steps of this method are as follows. (1) Calculation of monarch, minister, assistant, and guide weighting According to the compatibility principle of \"monarch, minister, assistant, and guide\" in TCM, different groups of medicines are fused into a coordinated and orderly organic whole in a prescription, achieving the effect of the whole prescription being greater than the sum of its parts. This relationship leads to significant differences in the importance of medicines[ 24]. To measure the compatibility weight of each medicinal herb in different prescriptions, a hierarchical analysis method is proposed for the weight of herbs. Based on the evaluation of TCM experts, the basic scale rules of the AHP method are used to assign importance values to the compatibility rules of prescriptions, as Page 5 of 13 shown in Fig. 2 . Fig. 2 Basic scale rules of the AHP method in TCM data According to the scaling rules of Fig. 2 , establish pairwise comparison matrices and calculate the weight coefficient of \"monarch, minister, assistant, and guide\" . The weight vector at this time is ()=(1, 2, , ) of the prescription compatibility, and finally perform consistency checks on the matrix. (2) Dosage weighting calculation To measure the pharmacological effects of different doses of traditional Chinese medicine s[25], a dosage weighting method is proposed. The dosage characteristics of Chinese medicine make the commonly used dosage range, for example, the commonly used dosage of pseudo-ginseng is 3~9g . However, the actual dosage of Chinese medicine may exceed this range. To eliminate the influence of the disparity in various indicators, standardization is required. The formula for standardizing the dose of TCM is: = + (1) The standardized dose of TCM , the actual dose of TCM , the minimum value in the commonly used dose of TCM , and the maximum value in the commonly used dose of TCM . The commonly used dose of TCM is referred to in the 2020 edition of the Chinese Pharmacopoeia, the Dictionary of TCM, and Chinese Pharmacology. At the same time, the prescription dosage weight vector ()=(1, 2, , ) is calculated by normalizing the data set of drug dosage after standardization. (3) Comprehensive weight calculation The total weight of medicinal ingredients is obtained by combining the compatibility weight and dosage weight through linear weighting, and then the herbs are sorted in descending order. The top 70% of key herbs are selected to represent the composition of the prescription. The formula for calculating the comprehensive weight of n medicinal ingredients in a prescription is as follows: ()= ()+(1 )() (2) Where: is the weight proportion coefficient used to adjust the balance between the objective weighting method and subjective weighting method. Generally, = 0.5 , and if the importance of a certain type of weight needs to be emphasized, the value of should be relatively larger. () as the comprehensive weight of the formula for n-ingredient prescription is used to extract key herbs and is used in the subsequent steps of the prescription similarity detection framework. Quantification of TCM properties Single-drug properties are difficult to reflect the overall characteristics of TCM prescriptions, while multi-dimensional quantification indicators based on drug properties can provide objective and comprehensive information for studying the overall efficacy of prescriptions. As shown Table 1 , the distribution of TCM properties is based on the 2020 edition of the Pharmacopoeia of the People's Republic of China, supplemented by the planning textbook Traditional Chinese Medicine of national TCM colleges and universities, and is divided into three categories: property (P), flavor (F), and meridian tropism (MT), which are further divided into 4, 0, and 2 subclasses, respectively, containing 9, 7, 12, and 4 TCM-Ps. Each drug in a TCM prescription has its own unique nature, taste, and meridian tropism, represented by a one-hot vector. For example, the TCM herb Moutan bark has a slightly cold nature, bitter and pungen t taste, and tropism towards the heart, liver, and kidney meridians. The TCM property vector of Moutan bark is represented as = (1, 2, 3, 4, 5, 6, 7)=(0,1, 0, 1, 0, 1, 0, 0, 0 ). Different TCM herbs are stacked and fused in prescriptions, resulting in multidimensional property characteristics of nature, taste, and meridian tropism for each prescription[ 26,27]. Therefore, the TCM prescription with n herbs is represented by a vector of TCM properties: = (11 12 13 14 15 16 17 21 22 23 24 25 26 27 31 32 33 34 35 36 37) ( 3) The i-th row represents the drug property vector of the i-t h herb in the prescription, i.e. = 1, 2, 3, ... , n. The final result is the matrix of prescription property vectors , taste vectors , and meridian vectors . Page 6 of 13 Table 1 TCM properties of Chinese herbal medicines Herb property Herb flavor Herb meridian tropism SubclassP TCM-P TCM-F SubclassMF TCM- mt11bladder p9great hot mt12triple burner The core prescription and classical prescription matching So far, the framework has extracted the key herbs of clinical prescriptions based on the theory of TCM and the comprehensive weight of compatibility and dosage. To further help doctors identify classic TCM formulas contained in clinical prescriptions, this section describes in detail the Siamese network-based Bi- LSTM neural network architecture for core prescription and classical formula matching, as shown in Fig. 3 . The model framework mainly includes the word vector representation layer, Siamese network layer, Bi-LSTM layer, and similarity calculation layer. The output of each layer is used as the input of the next network layer, where the concatenated vector of the word vector, herb property vector, herb flavor vector, and meridian tropism vector in the word embedding layer is used as the input of the Bi-LSTM network layer for feature extraction and training, and the matching results are output through the similarity calculation layer. Word vector representation layer A word2vec skip-gram model is used to train the Chinese medicine word vector model on a large corpus of Chinese medicine text. The model obtains continuous and low- dimensional word vectors, which effectively solve the problems of semantic isolation and dimension explosion caused by traditional word vector models[ 28]. For a given corpus, the word vectors are stored in a word vector query matrix = ||\u00d7 , where || is the vocabulary size of the given unlabeled Chinese medicine text corpus, and is the dimension of the word vector. For a sentence = {1, 2, , } of length n, the sentence matrix is represented as = {1, 2, , }, where is the word vector obtained from the word vector query matrix M for the word in the sentence. Assuming that the corpus consists of m words 1, 2, , , the skip-gram model aims to maximize equation (4). log (+1 |),0 =1 (4) Where: is a parameter that represents the training window size. In this study, the context window size for word2vec training was set to 5, and the number of iterations was set to 8, resulting in the generation of word vectors with dimensions of 100, 200, 300, and 400. After extracting the key herbs, th e set of key herbs was used to form the core prescription. The core prescription text was then used as input for the model training, which involved concatenating the word vector matrix , the medicinal property vector matrix , the medicinal taste vector matrix , and the meridian vector matrix. to form the prescription vector matrix = [ ]. The symbol denotes the vector concatenation operation. Siamese network layer A Siamese network is a neural network with weight sharing, which can determine whether a sample outside the training set is similar. It has significant advantages in terms of the number of classifications and generalizations[ 29]. The basic structure is shown in Fig. 4 . The Siamese Network is mainly composed of two parts: sample representation and similarity calculation. It Page 7 of 13 Fig. 3 Formula matching model framework uses two sub-networks with the same structure and shared parameters to represent samples 1 and 2. The similarity (1, 2 ) of the sample representation vectors (1) and (2) is calculated to determine whether the two samples belong to the same category. The loss function of a Siamese network depends on the inputs and parameters. is the label indicating whether 1 and 2 are a match, where (0,1 ). Let +(1, 2 ) denote the loss when = 1 and _(1, 2 ) denote the loss when = 0 . Then, the loss function for a single text is: =(1 )_(1, 2 )+ +(1, 2 ) (5) The total loss function for N texts is: ()= () =1 (1, 2, ) (6) The loss function () is the cross-entropy loss function. The ADAM algorithm is the optimization algorithm used for the model, and the dropout technique is a regularization method. Fig. 4 Siamese network framework Bi-LSTM layer Long short-term memory (LSTM) networks can effectively preserve the historical information of long sequences while avoiding problems such as gradient vanishing and explosion that Page 8 of 13 standard RNNs often face[ 30]. An LSTM model as shown in Fig. 5. For a prescription text sequence = {1, 2, , } consisting of words, represents the mixed vector corresponding to the word in the input sequence at time step in the LSTM unit. Fig. 5 LSTM cell structure The calculation of the three gates and the memory cell in the LSTM unit is as follows: { X = [1 ] = ( + ) = ( + ) ( = 1 + ( + ) = () (7) In the above formula, Rm\u00d7d represent weight matrices Rm represent biases is a non-linear activation function = 100 is the number of LSTM units in the network represents element-wise multiplication; contains input vectors of the LSTM unit; is the hidden layer vector. For a given prescription text = {1, 2, , }, each word is mapped to its corresponding word vector , each word's medicinal property is mapped to a medicinal property vector , the word's flavor vector is mapped to a flavor vector , and the word's meridian vector is mapped to a meridian vector (where =300, = 9 , = 7, =12 represent the dimensions of word vector, medicinal property vector, flavor vector, and meridian vector respectively). Finally, these vectors are concatenated to generate the prescription vector matrix: [1, 2, , ] [ ] [ 1 1 1 1 2 2 2 2 ] (8) To measure the positional information of the text in different orders equally and further explore the contextual information associated with the formula, a Bi-LSTM model is used to extract text features. After passing through the forward and backward LSTM networks, the network contains two hidden states and in both directions. The vector = [ , ] generated by concatenating them is the output, which is a fused result. Then, the max pooling layer takes the maximum value of the vector to obtain the most significant feature vector as the input of the fully connected layer. Similarity calculation layer The key herb set and feature vectors (), () of the prescription are fed into a fully connected layer to calculate the distance between prescriptions using a similarity function defined by the network layer, which outputs the Manhattan distance as shown in equation (9). To prevent the feature vectors from being too large, the Manhattan distance is input into a multi-layer fully connected network for non-linear transformation and dimensionality reduction to ensure model convergence. Finally, the sigmoid function is used to output a probability distribution of similarity ranging from [0, 1] . ((), ())= ( () ()) (9) The similarity function adopts 1 regularization to correct the problem of semantic loss caused by gradient disappearance in Euclidean distance. After obtaining the predicted results, the cross-entropy loss function is used to measure the difference between the predicted value and the true value, and then backpropagation is used to update the parameters of the Siamese network model, and leave- one-out is used for cross-validation. Results Datasets The data for the experimental formula were selected from authoritative Chinese medicine formula books and data platforms. The included Chinese medicine formulas meet the following standards: (1) they were clinically used by academic experts and instructors recognized by the National Administration of Traditional Chinese Medicine, including the first three batches of national TCM masters and the first batch of nationally renowned TCM practitioners; (2) they were published in authoritative TCM journals. The exclusion criteria are (1) incomplete records of medical cases or prescriptions; (2) duplicated literature, in which Page 9 of 13 Table 2 Some sample data from the dataset Prescription Classical prescription Similarity label (10g ure (fried), 5g Magnolia Bark, 6g 9g 9g 3g 4 1 only one is selected; (3) duplicated medical cases or prescriptions, in which only one is selected. Following the inclusion and exclusion criteria, a total of 10380 prescriptions of Chinese medicine formulas were obtained. Among them, the formula data with indications matching the classic formulas were organized as matching data, while non- matching data were generated by combining formula data with different indications from the classic formulas. This resulted in the establishment of a dataset of prescription-matching data for TCM masters and renowned TCM practitioners (MTCMFE). The dataset consists of actual prescriptions from medical cases, corresponding classic formulas, and a label. A label of 1 indicates a match between the actual prescription and the classic formula, while a label of 0 indicates a non-match. The MTCMFE dataset was divided into training and testing sets with a ratio of 7:3, and the validation and testing sets contained an equal number of data with labels of 0 and 1. Table 2 shows some sample data from the dataset used in this study. Experimental environment and parameter settings The specific experimental environment settings for this study are shown in Table 3 . The specific experimental parameter settings for this study are shown in Table 4 . Evaluation indicators The experiment used accuracy, precision, recall, and 1 score as evaluation metrics to comprehensively measure the performance of the model. Their definitions are as follows: Page 10 of 13 { =+ ++ + = + = + 1=2\u00d7\u00d7 + (10) Where represents the number of samples that are predicted as positive in the positive class, represents the number of samples predicted as positive in the negative class, represents the number of samples predicted as negative in the positive class, and represents the number of samples predicted as negative in the negative class. Table 3 Experimental environment configuration Experimental environment Configuration Development tools Pycharm programming languages Python3.6 Development framework Pytorch 1.4.0 Operating system 64-bit Windows 10 processing unit Intel(R) Core(TM) i5-9300H 2.40 GHz GTX 1650 Table 4 Main parameter settings of the model Parameter name Parameter values Word vector dimension 300 Epochs 40 Learning_rate 0.001 LSTM_hidden_size 300 optimizer Adam dropout 0.5 Batch_size 64 Comparison experiment with the baseline method To compare our proposed method with traditional machine learning methods, experiments were conducted on the MTCMFE dataset. To ensure a fair comparison of the matching performance of each method, only pre-trained word vectors with a dimension of 300 were used as input for the comparative methods. The results are shown in Table 5 . From Table 5 , it can be seen that the proposed MFTCMC model performs the best in the task of matching TCM prescriptions in terms of accuracy, recall, and 1 score, and outperforms other baseline methods. The specific analysis is as follows: Table 5 Results of comparative experiments on classical similarity matching Models Dataset of with other deep learning models, the performance of deep learning models is much better than that of Word2vec. This is because Word2vec is a shallow neural network model that takes the average value of all word vectors in the text as the feature vector, making it difficult to extract deep semantic features. (2) Comparing the three deep neural network models o f LSTM, CNN, and Bi-LSTM, it can be seen that the CNN model has better matching performance, as it can extract the local features of prescriptions to improve the matching effect. (3) Comparing CNN and Siamese-CNN models, it can be seen that multi-layer models perform better, indicating that complex models have an advantage in dealing with large amounts of data and can better extract feature information from the text. (4) Compared with other multi-layer deep learning models, MFTCMC shows significant performance improvement. This is because traditional deep learning models are difficult to directly apply to the field of TCM which contains certain latent relationships and multi-dimensional features. In this study, the MFTCMC model, based on the Siamese- Bi-LSTM model, extracts key herbs, retains information on the compatibility and dosage of TCM formulas, and reflects the professionalism of TCM data, making the semantic representation of the text more comprehensive. At the same time, the bidirectional LSTM structure of the Siamese network enhances the ability to extract contextual features. The F 1 score is higher by 25.38%, 17.16%, 28.18%, 22.52%, and 14.83%, respectively, compared with other deep Page 11 of 13 learning methods, and the precision and recall rates are both at their highest values, proving that the model can capture the potential semantic relationships in the text and is more suitable for complex formula data. The impact of multiple features on formula matching To verify the effectiveness of the drug property, flavor, and meridian features on the matching of Chinese herbal formulae, different feature combinations were used as model inputs in this experiment. The , , and were added to the concatenated mixed vector = generated by the word vector and used as the model input for training. The results of the MFTCMCF multi-feature comparison experiment are shown in Fig. 6 . Analysis of the results in Fig. 6 shows that the MFTCMC model proposed in this paper, which uses a fusion of word vectors , drug property vectors, flavor vectors, and meridian vectors, has the best performance. Specifically: (1) Training the model using only word vectors as input resulted in a matching score of 89.19%, indicating that using only word vectors for feature extraction is not sufficient to fully capture the feature information of formula texts. (2) Adding drug property vectors, flavor vectors, and meridian vectors on top of word vectors improved accuracy, with matching values increasing by 0.13%, 0.24%, and 2.24%, respectively. These vectors contributed differently to the semantic representation of formula texts, with meridian vectors making a larger contribution. (3) Concatenating word vectors, drug property vectors, and flavor vectors to generate a vector as input for the model increased the matching score by 1.19%. It performed better than using or feature vectors, but its expressive power is still limited compared to using a single comprehensive vector , especially in terms of . (4) The MFTCMC model proposed in this paper uses drug property, flavor, and meridian vectors in addition to word vectors for training, demonstrating the specialization of TCM formula data and enriching the semantic representation of formula texts. It strengthens the connection between internal herbs in formula texts and improves the matching 1 value by 5.15%, further enhancing the experimental effect of TCM formula text matching. Discussion Although the model achieved high performance, improvements are still needed to achieve the overall optimization of the model. (1) The quality and quantity of the dataset have a significant impact on the accuracy of the model. Therefore, more high-quality data on the matching of TCM prescriptions and formulae will be collected, and TCM experts will be invited to Fig. 6 Multi-feature comparison experiment Page 12 of 13 review the data to optimize and learn models with higher performance. (2) In the actual prescription process of TCM physicians, the description of herbs may vary. Many physicians use the aliases of Chinese medicine. This semantic diversity of Chinese medicine may interfere with the results of prescription recognition, so further research is needed on the discernment of Chinese medicine semantics. (3) Due to the differences in the pathological symptoms and personal constitution of patients, physicians may appropriately add or remove drugs, increase or decrease dosage, or combine several prescriptions based on actual situations and personal experience on top of classic formulae. Additionally, physicians may be influenced by their preferences and replace drugs in classic formulae with other drugs of the same efficacy. Therefore, actual clinical prescriptions may differ greatly from classic formulae, which is difficult to handle. (4) In future work, based on the experimental model, a n intelligent TCM prescription taking methods recommendation system will be constructed. This system integrates medication specification, post-treatment care, drug use taboos, and health guidance to provide comprehensive TCM prescription services. Conclusion Based on the characteristics of TCM prescriptions, this study proposes a multi-feature fusion framework for matching TCM prescriptions with classic formulas. In the key herbal extract phase, a comprehensive weighting method that integrates compatibility and dosage weights based on the analytic hierarchy process is proposed, which fully considers the contribution of compatibility and dosage to the efficacy of the formula, making the extracted key herbs more representative of the overall prescription. In the core formula and classic formula matching phase, the properties of TCM are introduced to avoid the difficulty in quantifying the main treatment and efficacy attributes of TCM. Additionally, a Siamese network with a bidirectional LSTM structure is employed to enhance the feature extraction capability of context-dependent text and capture the semantic relationship between the prescriptions. Experimental results show that the hybrid model proposed in this paper significantly outperforms traditional machine learning methods and formula similarity quantization methods in terms of accuracy, recall, and F 1 score in prescription and classic formula matching tasks, verifying the effectiveness of the proposed model. Acknowledgements Not applicable. Authors' contributions WX and KW conceived and led the study, while WX and MY designed the model and programmed the algorithms. WX, KW, SL, ZL, YZ, PL, and XZ conducted data collection and model analysis, and all auth ors contributed to manuscript revisions. All authors have read and approved the fi nal manuscript. Funding This work was supported by the Chinese National Natural Science Foundation (No.82274680, 82160955) . These funds are for the design of research, collection, analysis, and interpretation of data, as well as the writing of manuscripts. Availability of data and materials The data that support the findings of this study are availab le on request from the first author. The data are not publicly available due t o privacy restrictions. Ethics approval and consent to participate Not applicable. Consent for publication Not applicable. Competing interests The authors declare that they have no competing interests. References 1. WHO World Patient Safety Day 2022. https://www.who.int/zh/camp aigns/world-patient-safety-day/2022(2022). Accessed 17 Sept 2022. 2. Cyranoski D. Why Chinese medicine is heading for clinics arou nd the world. Nature. 2018;561(7724):448-448. 3. Feng Z, Zhong J, Lv L, et al. Analysis of Adverse Reaction s of Traditional Chinese Medicine in China From 2016 to 2020. Shan dong Chemical Industry. 2022;51(10):165-167. 4. Li F, Nan L, Wang X. Discussion on Traditional Chines e Medicine Taking Methods and Rational Use of Drugs . Chinese Pharmaceutical Affairs. 2022;36(04):470-472. 5. Chu W, Kang Z, Liao X. Analysis of modified classical presc riptions applied in ophthalmology and investigation of clinical thinking . China Journal of Traditional Chinese Medicine and Pharmacy . 2015;30(11):4039-4041. 6. Chen Q, zhu G, Fangl X. Statement of Zhu Guang-li on TCM Sy ndrome Page 13 of 13 Classification in Disease of Heart Failure and Therapy with Ma king Flexible Use of Classical Prescription . Chinese Archives of Traditional Chinese Medicine. 2015;33(10):2418-2421. 7. Wang KX, Gao Y , Gong WX, et al. A Novel Strategy for Decoding and Validating the Combination Principles of Huanglian Multi-Scale Perspective . Front Pharmacol. 2020;11: 567088. 8. Cao M, He Q, Wang B. Traditional Chinese Medicine Prescription Similarity Model. Computer Engineering. 2009;35(16):275-27 7. 9. Li B, Cui M, Yang Y , et al. Similarity of Traditional Chin ese Medicine Formula. Chinese Archives of Traditional Chinese Medicine. 2012;30(05):1096-1097. 10. Gu Z. Traditional Chinese medicine prescriptions similarity calcu lation basing on Text classification techniques. Microcomputer Information. 2010;6(12):199-201. 11. Guo W, Luo X, Jiang H, et al. Visualization Study on A pproximate Degree Analysis of Prescription Properties Based on TF-IDF Algor ithm. Chinese Journal of Information on Traditional Chinese Medici ne. 2019;26(07):104-108. 12. Zhu Z, Du J, Liu Y , et al. Similarity calculation of trad itional Chinese medicine prescriptions based on LDA topic model. Application Research of Computers. 2017;34(06):1668-1670+1676. 13. Pang LLAN YGUO Jet al. Text matching as image recognition . Proceedings of the Thirtieth AAAI Con-ference on Artificial Intelligence . 2016 ;30(1). 14. Fang S, Xie H, Chen Z, et al. Uyghur Text Matching in Gr aphic Images for Biomedical Semantic Analysis. Neuroinformatics. 2018;16:4 45-455 . 15. Chen H, Han FX, Niu D, et al. Mix: multi-channel information crossing for text matching. proceedings of the 24th ACM SIGKDD Internation al Conference on Knowledge Discovery & Data Mining. 2018;110-119. 16. Guo J, Yue B, Xu G, et al. An enhanced convolutional neural n etwork model for answer selection. Proceedings of the 26th intern ational conference on world wide web companion. 2017;789-790. 17. Pontes EL, Huet S, Linhares AC, et al. Predictingthe semanti textual similarity with siamese CNN and LSTM. arXiv:1810.10641,2018 . 18. Wu Z, Liang J, Zhang Z, et al. Exploration of text matching methods in Chinese disease Q&A systems: A method using ensemble based on BERT and boosted tree models. Journal of biomedical informati cs. 2021;115:103683 . 19. Chen Y , Hu D, Li M, et al. Automatic SNOMED CT coding of Ch inese clinical terms via matching. Intern ational journal of medical informatics. 2022;159:104676. 20. Jia Q, Zhang D, Yang S, et al. Traditional Chinese medicin e symptom normalization approach leveraging hierarchical semantic informat ion and text matching with attention mechanism. Journal of bio medical informatics. 2021;116:103718. 21. Huang WT, Hung HH, Kao YW, et al. Application of neura l network and cluster analyses to differentiate TCM patterns in pati ents with breast cancer. Frontiers in Pharmacology. 2020;11:670. 22. Xu G, Jin H. Using artificial intelligence technology to solve the electronic health service by processing the online case informa tion. Journal of Healthcare Engineering. 2021;2021. 23. Cancela J, Fico G. Arredondo Waldmeyer M T. Using the Analytic Hierarchy Process (AHP) to understand the most important factors to design and evaluate a telehealth system for Parkinson's diseas e. BMC medical informatics and decision making. 2015;15:1-11. 24. Yuan R, Lin Y . Traditional Chinese medicine: an approach to scientific proof and clinical validation. Pharmacology & therapeutics. 2000;86(2):191-198. 25. Zhu X. Discovery of Traditional Chinese Medicine Prescription Pat terns Containing Herbal Dosage Based on Multilevel Top-K Weight ed Association Rules. Computational Intelligence and Neur oscience. 2022;2022. 26. Ung CY , Li H, Cao ZW, et al. Are herb-pairs of traditional C hinese medicine distinguishable from others? Pattern analysis and art ificial intelligence classification study oftraditionally define d herba l properties. Journal of Ethnopharmacology. 2007;111(2):37 1-377. 27. Zhou S, Tong X. Design and Exploration of Multidimension al Similarity Algorithm forPrescriptions of Traditional Chinese M edicine Case Records. Modernization of Traditional Chinese Medicine an d Materia Medica-World Science and Technology. 2021;23(08):2864 - 2870. 28. Jang B, Kim I, Kim J W. Word2vec convolutional neural net works for classification of news articles and tweets. PloS one. 2019;14(8):e0220976. 29. Ma Z, Zhao L, Li J, et al. SiBERT: A Siamese-based BERT networ k for Chinese medical entities alignment. Methods. 2022;205:133-13 9. 30. Yu Y , Si X, Hu C, et al. A review of recurrent neural networks : LSTM cells "}