{"title": "PDF", "author": "PDF", "url": "https://scholarworks.csun.edu/bitstream/10211.3/210811/1/Khong-Yin%20Fung-thesis-2019.pdf", "hostname": "PDF", "description": "PDF", "sitename": "PDF", "date": "PDF", "cleaned_text": "CALIFORNIA STATE UNIVERSITY, NORTHRIDGE A Novel Approach for Efficient Implementation of Nucleus Detection and Segmentation Using Correlated Dual Color Space A graduate project submitted in partial fulfillment of the requirements For the degree of Master of Science in Computer Engineering By Yin Fung Khong May 2019 ii SIGNATURE PAGE This graduate project of Yin Fung Khong is approved by: __________________________________________ ________________________ Date: California State University, Northridge iii TABLE OF CONTENTS Table of Contents Signature Page ............................................................................................................................ii Figures ....................................................................................................................................... iv Tables ........................................................................................................................................ vi Abstract .................................................................................................................................... vii Introduction......................................................................................................................... 2 1.1 Objective ...................................................................................................................... 5 1.2 Project Outline .............................................................................................................. 5 Related Work ...................................................................................................................... 6 Proposed Algorithm .......................................................................................................... 15 3.1 Nucleus Segmentation ................................................................................................ 17 3.2 Nucleus Separation ..................................................................................................... 25 Experimental Results and Comparison .............................................................................. 34 Conclusion ........................................................................................................................ 46 References ................................................................................................................................ 47 Appendix A .............................................................................................................................. 52 FIGURES Figure 1: Proposed Algorithm for WBC Segmentation .............................................................. 16 Figure 2: Sample Image I Represented in RGB ......................................................................... 18 Figure 3: G (Green) Component of the Sample Image I............................................................. 18 Figure 4: M Component of the Sample Image I ......................................................................... 19 Figure 5: Histogram of the G Component.................................................................................. 19 Figure 6: Histogram of the M Component ................................................................................. 20 Figure 7: (Sample Image I) Adjusted Green Component based on the limits obtained from the Magenta Component ................................................................................................................. 22 Figure 8: (Sample Image I) Binary mask of the segmented nuclei ............................................. 22 Figure 9: Sample Image II Represented in RGB ........................................................................ 23 Figure 10: (Sample Image II) Adjusted Green Component based on the limits obtained from the Magenta Component ................................................................................................................. 23 Figure 11: (Sample Image II) Binary mask of the segmented nuclei .......................................... 24 Figure 12: (Sample Image I) Output of watershed transformation without Minima Transformation and Intensity Map ............................................................................................ 27 Figure 13: (Sample Image II) Output of watershed transformation without Minima Transformation and Intensity Map ............................................................................................ 27 Figure 14: (Sample Image I) Green Boundaries Superimposed on the Nuclei ............................ 28 Figure 15: (Sample Image II) Green Boundaries Superimposed on the Nuclei ........................... 28 Figure 16: (Sample Image I) Distance Transform of the Binary Mask with Intensity Map ......... 31 Figure 17:(Sample Image II) Distance Transform of the Binary Mask with Intensity Map......... 31 Figure 18: (Sample Image I) Output Binary Mask of Watershed Transformation with Intensity Map .......................................................................................................................................... 32 Figure 19: (Sample Image II) Output Binary Mask of Watershed Transformation with Intensity Map .......................................................................................................................................... 32 Figure 21: (Sample Image II) Green Boundaries Superimposed on the Nuclei ........................... 33 Figure 24: Sample Image III Represented in RGB ..................................................................... 36 Figure 25: (Sample Image III) Segmented Nuclei using Proposed Algorithm ............................ 36 Figure 26: (Sample Image III) Segmented Nuclei using Algorithm by Mohamed et al. .............. 37 Figure 27: (Sample Image III) Segmented Nuclei using Algorithm by Qui\u00f1ones et al. .............. 37 Figure 28: Sample Image IV Represented in RGB .................................................................... 38 Figure 29: (Sample Image IV) Segmented Nuclei using Proposed Algorithm ............................ 38 Figure 30: (Sample Image IV) Segmented Nuclei using Algorithm by Mohamed et al. ............. 39 Figure 31: (Sample Image IV) Segmented Nuclei using Algorithm by Qui\u00f1ones et al. .............. 39 Figure 32: (Sample Image IV) Initial Image Represented in RGB ............................................. 41 Figure 33: (Sample Image IV) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green ............................................................................................................. 41 Figure 34: (Sample Image V) Initial Image Represented in RGB .............................................. 42 v Figure 35: (Sample Image V) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green ............................................................................................................. 42 Figure 36: (Sample Image VI) Initial Image Represented in RGB ............................................. 43 Figure 37: (Sample Image VI) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green ............................................................................................................. 43 Figure 38: (Sample Image VII) Initial Image Represented in RGB ............................................ 44 Figure 39: (Sample Image VII) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green ............................................................................................................. 44 vi TABLES Table 1: Sample Binary Image Matrix ....................................................................................... 26 Table 2: Distance Transform Matrix ......................................................................................... 26 Table 3: Result and Comparison of Nucleus Count by Manual Inspection and using Proposed Algorithm ................................................................................................................................. 45 ABSTRACT A Novel Approach for Efficient Implementation of Nucleus Detection and Segmentation Using Correlated Dual Color Space By Yin Fung Khong Master of Science in Computer Engineering Extraction of nucleus from the blood smear images provides valuable information to the doctors for diagnosing various kinds of hematological diseases such as anemia, polycythemia, leukemia and lymphoma. The motivation of the project is to provide a standardized solution in clinical blood work and replacing manual labor in classifying and calculating the various leukocytes in a blood test and reduces laboratory cost by eliminating the need for expensive laboratory instruments that are currently used in the medical industry. In the light of recent development and expansion of computer vision in the industry, substantial research efforts have been invested in advancing and integrating image processing techniques in medical healthcare sector. Even though existing studies and proposed work yields promising results for segmentation of agglomerated and distributed white blood cells, they frequently involve heavy mathematical calculations and are computationally expensive, which are not viable in most cases. In this project, the author presents a new and efficient algorithm for segmentation of nuclei while retaining their shape and features in peripheral blood smears images, by correlating dual color space of the peripheral blood smear images. This proposed algorithm is able to address the over-segmentation issue caused by watershed transformation, by incorporating minimal transformation and intensity map into distance transform. Using 30 sample images of different color tones and magnification of the blood smear, the test results reaffirm the high segmentation accuracy and performance of the proposed algorithm. 2 INTRODUCTION Routine, clinical blood test can provide helpful indications to help doctors assess an individual's overall health. It is such a common, yet vital step in medical screening and diagnosis that is frequently requested by doctors [1]. Detecting and counting red blood cells (RBCs) or erythrocytes, and white blood cells (WBCs) or leukocytes in a complete blood count (CBC) of a blood smear is an important step in medical diagnosis. The abnormal findings may provide doctors with early alerts in a wide range of hematological diseases such as anemia, polycythemia, leukemia and lymphoma [2, 3, 4, 5] that can lead to a more proper treatments and improve the individual's recovery rate [6]. Traditionally, medical experts count and classify white blood cells manually using hemocytometer and microscope [7]. This process; painstaking and subjective; is very time-consuming and susceptible to both human and operational errors. According to [8], it takes approximately 15 minutes for an adept hematologist to classify and count 100 cells for each blood smear. Using automated hematology analyzer and flow cytometry eliminates human intervention in the cell counting process and alleviates the aforementioned issues [1, 9, 10]. Despite the high reliability and more precise results, they are not commonly accessible in all medical facilities. This is mainly due to their extortionate cost, which will drastically increase the screening and diagnosis costs [11]. With the advent of computer vision and image processing techniques, automation in medical diagnosis has revolutionized the modern health care systems [12]. Automated laboratory instruments are widely accepted in the medical field, due to their capability to provide immediate multiphasic test profiles for initial evaluation and diagnosis of patients, with high accuracy and efficiency [13, 14]. In recent years, researchers have turned to automating visual sample inspection using various image processing techniques to increase the diagnosis throughput and reliability 3 while keeping the overall operational cost and processing time low. Generally, the automation process can be broken down into five major stages: image acquisition, image processing, cell segmentation, feature extraction, and classification [15]. Among all these stages, segmentation is the most important process as it affects the subsequent stages such as feature extraction and cell classification. Segmentation is the process of extracting the region or object of interest from the initial image [11, 16]. It is imperative to have a precise and robust segmentation algorithm, as it will affect the subsequent stages in features extraction and cell classification for accurate diagnosis of blood diseases [15, 17, 18, 19]. There has been significant effort in development and introduction of advanced methods based on image processing techniques through many researches. The main issue is that most of these methods are very case specific and not versatile enough to be applied to a wide range of images, aside from being computationally expensive in the pre-processing and segmentation stages. In this paper, we present a more robust and multifaceted, yet efficient algorithm, in blood cell segmentation. Our work considers a broad spectrum of blood smear images with different image tones. Unlike most of the other proposed algorithms that utilize only one color model in any given stage, our proposed work involves Magenta (M) component from the Cyan, Magenta, Yellow and Key (CMYK) color model, and Green (G) component of Red, Green, and Blue (RGB) color model of the initial image. Our approach applies thresholding to white blood cells during the segmentation process. This technique eliminates the need for preprocessing of the input image such as image enhancement and image filtering, hence introduces a more computationally efficient algorithm. This approach simplifies the process and speeds up the operation without sacrificing 4 the credibility of the algorithm. The present research is therefore intended to make contributions to the following: i. To introduce a highly versatile and efficient segmentation algorithm for blood cell images independent of image resolution, color tone and magnification ii. To introduce an algorithm with no image enhancement or pre-processing steps in order to reduce the processing time while maintaining high accuracy iii. To retain all crucial information such as cell features and integrity in the processed image The rest of the paper is organized as follows: Section II presents the related work to WBC segmentation. Section III describes our proposed algorithm in detail. Section IV discusses the performance of the algorithm and experimental results. Furthermore, it compares our method with other competing algorithms. We conclude the paper in Section V with important remarks and potential future development to the algorithm. 5 1.1 Objective The objective of this project is to develop a versatile automated system that accepts a microscopic image of peripheral blood smear taken using a transmission light microscope in clinical laboratory as an input, and perform a leukocytes count using various image processing techniques. The proposed algorithm should be flexible enough to process blood smear images of any type, including various image resolutions, different image color tones, and different magnifications of leukocytes in the image. Along with the versatility of the system, efficiency of the algorithm, in term of reduced computation time and hardware requirement, remains as one of the biggest concerns that this project is dedicated to. 1.2 Project Outline Chapter 2 discusses the motivation for the research and reviews the literature of the related work in nucleus detection and segmentation. Chapter 3 explains the approach of the algorithm and the functionality of the proposed work. Chapter 4 shows the output result using three algorithms, including the proposed algorithm and two others introduced by other authors for comparison. Later in chapter shows the results of 30 test input images using the proposed algorithm, with different sample images of different resolutions and color tones. Chapter 5 discusses some remarks of the algorithm and some potential future improvements and developments. Chapter 6 shows all the references cited in the paper. 6 RELATED WORK An overall health assessment is commonly done by ordering and completing a complete blood count (CBC). Such blood work can provide numerous information such as components and features of the blood, including red blood cells count, white blood cells count, hemoglobin level and hematocrit level. While the test result is not definitive, the test information provides the doctor a general understanding of the patient's overall health and detect abnormalities for early treatment such as infections, inflammation and hematologic diseases. When the test results are not within the reference range such that abnormal increases or decreases in the cells count and tests level, it might raise a flag for one's health condition and imply some underlying medical condition that requires medical attention and calls for further evaluation. In the case of abnormal white blood cell count, a differential blood test might be needed to further examine the cause of abnormal result and to verify the histopathological examination. A differential blood test is similar to a complete blood count except that it measures and provides the complete counts of the five types of white blood cells in the body. They can be classified into three major pillars - monocytes, lymphocytes and granulocytes which includes neutrophils, eosinophils and basophils. While these cells make up the immune system, they play different roles to fight off pathogens and protect the body against various diseases. Lymphocytes are recognized as the primary response mechanism in the body's immune system as they recognize the various antigens found and determine the specificity of the immune response to the foreign microorganisms found in the body. Granulocytes, in general, are named after its presence of granules of enzymes found in the cytoplasm that helps to fight off infection by digesting the invading pathogens, which gives them the alias as phagocytes. Lastly, while monocytes 7 function similarly like granulocytes that respond to the site of infection and inundate the infected cells, their main difference is to repair and clean up the dead cells. While there are several ways to diagnose blood diseases such as leukemia and lymphoma, routine clinical blood test is often the first to performed and the first to successfully detect hematologic diseases. One of the current methodologies in performing complete blood cell counts involve manual blood count by laboratory technicians or experts. This process requires tools such as a hemocytometer and a microscope. Hemocytometer is a rectangular-gridded glass slide that contains chambers of a defined area. By observing the chamber, laboratory experts can count the number of cells per square volume and calculate the density of cells in the blood sample. The experience and expertise of the technician is critical in the counting process, which is the major apparent caveat in this manual process. Not only it is inconsistent and subjective to each personnel, but also highly susceptible to human and operational errors, from sampling to labelling of the test sample, and calculation to classification of the blood cells. Inaccurate test result may cause incorrect medical diagnosis and treatments that in turn causes severe consequences and lead to fatality. Worse yet, the manual counting process is very time-consuming and arduous, as it requires tremendous attention and concentration staring into the microscope for counting. The second methodology involves a specialized automated system in cells counting process. By using hematology analyzer or flow-cytometry, it minimizes human involvement in the process which greatly reduces the possibility of lab errors from happening. These highly specialized devices can ensure high level of accuracy and precision in cell counting and classification, on top of being consistent throughout the entire counting process. These state-of-the-art hematology analyzers can even take over and replace human in staining slides in 8 producing uniformly-stained blood smears, which leads to efficient and accurate blood cells counting with relatively short time taken to perform the entire process. While these automated systems unequivocally proven worthwhile by outperforming and allaying most of the concerns and errors that are found in the manual process, it is not commonly affordable or accessible in all medical facilities. In the light of recent development and expansion of computer vision in the industry, substantial research has been conducted with regards to advancing and integrating image processing techniques in medical healthcare sector. Cells segmentation is considered as the most crucial step in hematological image analysis, as accurately detecting the cells would impact the counting and classification of cells in the later stage which will ultimately affect the output of the lab result and influence doctors in medical evaluation. Incorrect medical diagnosis and treatment will cause catastrophe consequences to the patient including mortality. Therefore, many research works have been conducted in regard to image segmentation. In general, image segmentation techniques can be categorized into five major categories including region-based, learning-based, deformable clustering are some of the most common implementations of these five categories. Region based image segmentation, or otherwise known as pixel-based segmentation or region growing, is considered as the simplest approach among the five approaches. Starting from the initial seeds, the surrounding neighbor pixels will be examined based on some user-defined criteria, such as the pixel intensity and pixels correlation. That being said, careful selection of the initial seed points is critical in the efficiency of the algorithm, and optimum 9 threshold value for segmentation will impact the overall segmentation output. Being computationally expensive and sensitive to image noise are some of the other drawbacks of the approach. Deformable model- based segmentation, including active contour and geometric model, is great in adapting to the approximating the shape of the boundary, and autonomously search for the minimum state. Since it is a convergence-based algorithm, it is also computationally expensive and severely sensitive to local minima. Morphological based segmentation is a popular and powerful approach, specifically the watershed algorithm. This algorithm is invented by mimicking the field of topology and geology. As the name implies, the watershed algorithm can find the watershed in the image, which the watershed is the ridge is the pixels that are relatively brighter, and between the two ridges, a catchment basin will be formed between the closed curves formed and two individual objects are then segmented. This algorithm forks into several other approaches by flooding, topographic distance, drop of water principle and inter-pixel watershed. The major caveat of this algorithm is its sensitivity towards local minima, which causes over-segmentation of the objects. Learning- based segmentation can be then divided into supervised including Support Vector Machine (SVM) and unsupervised methods such as k-means clustering and Fuzzy c-means. The existing works involving this approach have deemed successful in segmenting an object from the background, more efforts are needed to prove its ability in a wide range of images with numerous objects of interest. Furthermore, the performance decays when the iteration number defined is unsuitable for the type of image, which trial and errors are needed in finding the acceptable variable definition, making the whole effort futile. Lastly, the hybrid-based approach is a combination of two or more techniques mentioned above. The complementary effort helps addressing the drawbacks in each algorithm and making it more robust. 10 In the work \"White Blood Cells Identification and Classification from Leukemic Blood Image\" proposed by Putzu et al. [23], it utilizes the Y (Yellow) component of the CMYK (Cyan, Magenta, Yellow and Key) color model to identify the leukocytes due to the absence of yellow component in the leukocytes but ubiquitous in the rest of the image, which gives the great contrast between the object of interest and the background. Authors then used automatic thresholding, by using the value calculated from triangle method or Zack algorithm, to further stretch the contrast of the image for an easier segmentation process. Following this procedure, the watershed transformation is applied to separate the overlapping cells before image cleaning, which is done by discarding objects that have a combined value of area and convex area less than a predefined value. Lastly, binary classification of the cells is performed using Support Vector Machine (SVM). According to \"Segmentation of White Blood Cell from Acute Lymphoblastic Leukemia Images Using Dual-Threshold Method\" by Li et al. [19], they were able to successfully devise a segmentation method using dual-threshold for both grayscale images utilizing the G component of the RGB color model and the H (Hue) component of the HSV (Hue, Saturation and Value), which the two grayscale images will then be intersected to find the whole WBC. The two thresholds are found using golden section search for optimal thresholds, and using Dice Similarity Coefficient (DSC) to find the optimal value from all the possible choices. Since the higher the DSC indicates better segmentation accuracy, the objective function is aimed to make DSC as large as possible. The drawback of this method is the addition of the noise to the output image. Post-processing of the image is needed as the gray image outputted from the previous step contains some image noise. This stage involves morphological erosion, median filtering to remove unwanted white pixels in the image, and maximum connected region (MCR) extraction 11 operations are carried out to fill holes, gaps and further removing small white dots and incomplete WBCs. The final image produced is the binary mask of the complete WBC. Basima et al. [24] proposed, in the work \"Enhanced Leucocyte Classification for Leukemia Detection\", to transform the initial RGB image into CMYK, then applied histogram equalization for K-means segmentation to identify the WBC from the image. Since the output contains artifacts and noises, image cleaning is needed to smoothen the border and remove unwanted pixels to prevent false detection later. Due to agglomerated WBCs, watershed algorithm is applied to the binarized distance transform image to separate the cells as individuals for classification in the later stage. One apparent caveat in this cell segmentation process using watershed segmentation techniques is the over-segmentation issue on the nucleus. In \"Automatic Nuclei and Cytoplasm Segmentation of Leukocytes with Color and Texture- Based Image Enhancement\" by Tareef et al. [25], a new technique is introduced to reduce the loss of information while converting color images into grayscale. In this paper, the authors utilized two color spaces, RGB and CIELAB [29] that involve R component from RGB, (L) and green-red (a*) color-opponent channel from the CIELAB color space to remove the non-WBC components while highlighting the nucleus in the grayscale image. CIELAB or abbreviated as the Lab or L*a*b* is a color space defined by the International Commission on Illumination (CIE). Unlike RGB color space which the three individual components (R, G and B) are highly correlated, this Lab color space is designed to be perceptually uniform and colorimetric such that it acts as an excellent decoupler of luminance or lightness (L) and color (a* and b*) that makes it device independent and consistent across all displays [30, 31]. Changes in numeric value in the color space corresponds to the changes in 12 the visual perception. Finally, Poisson distribution based minimum error thresholding algorithm is used to finalize the segmentation process and to obtain the nucleus. Another approach that utilizes the CIELAB color space is introduced by Ahasan et al. [26] in \"White Blood Cells Nucleus Segmentation from Microscopic Images of Strained Peripheral Blood Film during Leukemia and Normal Condition\". A color thresholding is applied to create a mask, and then using Otsu's global thresholding algorithm to convert the image into binary image using threshold value obtained from histogram analysis. Average filtering is applied to remove noise before the marker-controlled watershed segmentation is implemented, to disconnect the blob of connected leukocytes. Unwanted pixels or noise in the image are removed using area removal techniques due to its relatively small area compared to the leukocytes. At this stage, some of the leukocytes are broken due to the over-segmentation caused by the watershed function. Hence, morphological operation is used to reconstruct the broken leukocytes, and megakaryocytes are eliminated using area removal technique, once again, and the final image is free of noises and left with leukocytes only. According to the approach presented by Mohamed et al. in \"An Efficient Technique for White Blood Cells Nuclei Automatic Segmentation\" [15], their technique depends heavily on the initial contrast of the image for nuclei detection. The image goes through a series of image enhancement process using mathematical operations and a loop of minimum filtering on the grayscale image. Otsu's thresholding technique is then applied for global thresholding to segment the object from the background, and morphological opening is applied to remove the unwanted small pixel objects. Lastly, it computes the area of each cell, and remove the segment with area less than half of the RBC average size. 13 In the work proposed by Qui\u00f1ones et al. [27] in \"Leukocyte Segmentation and Counting based on Microscopic Blood Images using HSV Saturation Component with Blob Analysis\", they eliminated the need for morphological operations such as area opening, dilation and erosion thoroughly in their algorithm. The original RGB image is converted into HSV color space so that the S component that predominantly shows the contrast the leukocytes in the grayscale image. Then, a fixed predefined threshold value of 0.4 is used for global thresholding for binarization of image and extract only the nucleus of the leukocytes from the image. Blob analysis is then performed, and clustered cells are identified using area and eccentricity that is greater than 0.65. Finally, watershed segmentation is performed on every sub-image of the clustered blob cropped from the binarized image to separate the clustered nuclei. Even though the authors claimed the algorithm to be highly accurate and efficient, but it is highly specific and only works on a certain microscopic blood image, not to mention the exponential growth of processing time as the number of nucleus in the image increases due to the iterative blob analysis. Our approach is fundamentally different from the existing works as it correlates two color spaces to segment the nucleus from the image without involving any predefined value for thresholding nor using any computationally-expensive algorithm. Therefore, it is highly versatile and efficient in processing any input images despite the differences in image resolution, color tone and magnification. Prior to the segmentation stage, no image enhancement or pre-processing steps needed on the initial image. Hence, all the crucial information from the initial image is retained, therefore achieving higher accuracy in segmenting the nucleus from the white blood cells, not to mentioned simplified algorithm that yield high throughput. To overcome the over-segmentation issues caused by watershed 14 transformation while segregating clusters of nuclei, pixel intensity map and minimal transformation are used to enhance the distance map to produce an accurate segmentation of the agglomerated nuclei. 15 PROPOSED ALGORITHM This section discusses our novel approach for efficient implementation of leukocytes detection and segmentation using correlated dual color space. Our method identifies and segments the nucleus of the WBCs in blood smear images. To prove the versatility of our proposed algorithm, sample blood smear images of different resolution and magnification are tested. The resolutions of the images range from 336x504 to 2592x1944, saved in JPG format with 24-bit color depth. Our algorithm exploits the interrelationship between the M component and G component of the image to segment the nuclei from the background without any preprocessing steps involved. Eliminating the entire preprocessing stage in the algorithm, in addition to reducing processing time, helps retaining every detail in the color image that can be crucial in the following steps. Then, by incorporating intensity map and minima transform into the distance transform map, we are able to accurately separate the agglomerated nuclei for a precise count. Figure 1 shows the steps involved in our proposed algorithm. The algorithm consists of two major phases: Nucleus Segmentation, and Nucleus Separation. Nucleus Segmentation extracts the objects of interest from their background. The resulting image might still show the nuclei overlapping. Nucleus Separation eliminates the overlapping of the nuclei (if any) in order to produce a clean output image. The procedure starts by reading the input image in RGB color space. Then, the image is converted to CMYK format. During the intensity adjustment step, the top and bottom 1% of the pixel values in the Magenta component from CMYK color space will be used as the limits for contrast stretching in the Green component of RGB color space. The output grayscale image from this step is then binarized. Image cleaning step includes median filtering and region filling to fill the white dots in the segmented nucleus. The next major step 16 is to apply Watershed Transform to isolate nucleus from other parts of the image. The Watershed process starts by performing distance transform that provides a numeric measure of the separation of points in the image. Then, the distance transformation utilizes pixel-intensity map to separate the agglomerated nuclei into individuals to produce the final output image. Figure 1: Proposed Algorithm for WBC Segmentation 17 3.1 Nucleus Segmentation The initial image in RGB color space with 24-bit color depth shown in Figure 2. The image is first converted into CMYK color space so that data representation of the object of interest is best represented, ergo, better suited for the segmentation process. The Green component and Magenta component of the initial image are shown in Figure 3 and Figure 4 respectively, and their histogram representing the image pixel intensities are shown in Figure 5 and Figure 6. Referring to Figure 6, through histogram analysis, the pixel intensity of the leukocytes and the background in the extracted Magenta component are easily distinguishable by the two maxima: the maxima closer to the left indicates the background or unwanted items, whereas the maxima to the right represents leukocytes. Many researchers have utilized the Y component for nucleus segmentation because yellow element is predominantly found in the entire image except the nucleus, therefore, giving a good contrast between the nucleus and the background for nucleus segmentation. However, it is not deemed as useful in our algorithm. The correlation between the green and the magenta components in color space conversion is useful in segmenting the nucleus of the WBCs. The magenta component can be calculated from the RGB values of the image by using the equation below: M = c - K (1) where: c = 255 - R m = 255 - G y = 255- B K = minimum (c,m,y) 18 Figure 2: Sample Image I Represented in RGB Figure 3: G (Green) Component of the Sample Image I 19 Figure 4: M Component of the Sample Image I Figure 5: Histogram of the G Component 20 Figure 6: Histogram of the M Component By computing the lower and upper limits in the grayscale image that represent the magenta color plane, we get the top 1% and bottom 1% of all pixel values. Contrast stretching, also known as normalization, is one of the simplest and efficient enhancement techniques to improve the contrast between objects in an image. This is done by stretching the range of intensity to a specified range of intensity values. The two values obtained from the previous step will serve as the limits for contrast adjustment in the green component. Though the green component from the previous step distinctively highlights the nuclei in the image with greater contrast, there are still unwanted objects that are mixed with the background, which will then be effectively removed in the next step. Judging by the histogram shown in Figure 5, even though choosing a threshold value in this case seems intuitive, using a fixed threshold may not produce consistent results. This is due to the fact that process of acquiring the blood smear images depends on the stained blood smears made by lab technicians. As blood smears are processed manually, each case done by a technician yields different result. A fixed threshold value would not guarantee the segmentation of nucleus to work all the time. Our proposed algorithm takes the correlation 21 between the Green and Magenta components into account. This makes it not only self-adaptive in segmenting the nuclei from the image, but also highly effective and versatile on images with different resolutions and magnification. On top of that, this algorithm does not involve or perform any intensive mathematical computations or morphological operations in segmenting nuclei from the image which makes it very efficient. Referring back to Figure 2 and Figure 9 shows two initial images with different resolution and image tone. The grayscale images in Figure 7 and Figure 10 are the adjusted green component using the top and bottom 1% of the pixel values from the Magenta component. Notice that in the Figure 7 and Figure 10, other than nuclei that are represented in value close to 0 or black, the rest of the objects such as erythrocytes are removed and represented in white together with the background. The two adjusted Green component images, Figure 7 and Figure 10, are then further binarized using Otsu's Thresholding method, since the maximum inter-class variance is easily determined after the pixel intensity adjustment. The purpose of this process is to convert the grayscale image with pixel intensity ranging from [0 255] into binary image with two values [0 1]. Median filtering and morphological opening are then performed on the two figures, Figure 7 and Figure 10 to remove the unwanted black pixels that can cause false positive in the cell segmentation stage later. The final output images from the segmentation process are complemented, as shown in Figure 8 and Figure 11. 22 Figure 7: (Sample Image I) Adjusted Green Component based on the limits obtained from the Magenta Component Figure 8: (Sample Image I) Binary mask of the segmented nuclei 23 Figure 9: Sample Image II Represented in RGB Figure 10: (Sample Image II) Adjusted Green Component based on the limits obtained from the Magenta Component 24 Figure 11: (Sample Image II) Binary mask of the segmented nuclei 25 3.2 Nucleus Separation In cases like lymphoma and Acute Myeloid Leukemia (AML), the leukocytes that are found in abundance in blood smear images, are mostly agglomerated. Without separating the connected nucleus prior to the counting stage, the whole cluster of nuclei will be treated as one, therefore causing false negative and lowering the accuracy of nucleus detection. To address the cell adhesion problem, distance transform and watershed transform are being utilized in our proposed algorithm. The binary masks from the previous step, shown in Figure 8 and Figure 11, are negated before distance transform is applied. Euclidean distance transform provides a numeric value of the separation of points. This helps calculate the distance between a black pixel of intensity value 0 and the nearest non-zero pixel. Table 1 shows a sample binary image matrix where 1 denotes white pixels and 0 denotes black pixels. Table 2 is the result of applying distance transform to Table 1 where each value represents the minimum distance of the black pixel from its closest white pixel. Watershed transform is applied on the distance map to compute catchment basins and ridgelines, where the catchment basins refers to the nucleus region and ridgelines represent the boundaries. However, one major drawback of classic distance and watershed transform is the over-segmentation issue. Figure 12 and Figure 13 are the output of the watershed transform, separating the agglomerated nuclei using the same binary mask image obtained from the previous stage. Figure 14 and Figure 15 show the boundaries of the nuclei in green and superimposed on the original images, for easier visual inspection. As can be seen, the nuclei are over-segmented, splitting one intended nucleus into many small parts. 26 Table 1: Sample Binary Image Matrix 1 1 0 0 0 0 1 1 0 0 0 0 1 0 0 0 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 Table 2: Distance Transform Matrix 0 0 1 2 2.24 2 0 0 1 2 1.41 1 0 1 1.41 2 1 0 1 0 1 2 1.41 1 1.41 1 1 1 1.41 2 2 1 0 0 1 2 27 Figure 12: (Sample Image I) Output of watershed transformation without Minima Transformation and Intensity Map Figure 13: (Sample Image II) Output of watershed transformation without Minima Transformation and Intensity Map 28 Figure 14: (Sample Image I) Green Boundaries Superimposed on the Nuclei Figure 15: (Sample Image II) Green Boundaries Superimposed on the Nuclei 29 A pixel of black dot or local minima in the distance map will severely corrupt the distance transform and degrade the performance of the watershed segmentation and may result in over-segmentation. To address the over-segmentation issue in watershed transformation, the authors integrated a few extra steps into the proposed algorithm. Due to the irregular shape of the nucleus, distance transform map may contain some spurious local minima that may cause unintended segmentation. Therefore, Minima Transform is introduced to suppress image noise or unwanted local minima from the region, left with only desired minima at the center of each region in the distance map. Watershed transform using this generated distance map produces fairly accurate result in term of segmenting and delineating the boundaries of the nuclei. However, it yields some inaccurate or unnatural jagged lines when separating the clustered nuclei. To circumvent this issue, the proposed algorithm included the intensity map into the binary mask before distance transform is performed. While it doesn't improve ameliorate the over-segmentation issue, this extra step will yield a more natural boundary that resembles the natural shape of the nucleus. Watershed segmentation is one of the best candidate processes in segmentation due to its many advantages, including computation speed and partitioning accuracy. By default, Euclidean distance is used to compute the distance transform of the binary image or mask. However, after several trials, we realized that Quasi-Euclidean distance method has the upper hand in generating more accurate and indicative distance map that will yield slightly higher accuracy. Using this technique, we can determine the distance of each pixel in the nucleus from the closest background pixel. This is a perfect application in nucleus detection and segmentation because it is radially symmetric and practically invariant to orientation and rotation of the 30 object. The distance maps, Figures 16 and Figure 17, are generated from the same binary images shown in Figures 8 and Figure 11. Finally, with the improved distance map, the ridgelines are used to segment the clustered nucleus and the boundaries are formed for individual nucleus, shown in Figure 18 and Figure 19. Lastly, Figure 20 and Figure 21 show the delineated boundaries of the nuclei in green and superimposed on the initial image. 31 Figure 16: (Sample Image I) Distance Transform of the Binary Mask with Intensity Map Figure 17:(Sample Image II) Distance Transform of the Binary Mask with Intensity Map 32 Figure 18: (Sample Image I) Output Binary Mask of Watershed Transformation with Intensity Map Figure 19: (Sample Image II) Output Binary Mask of Watershed Transformation with Intensity Map 33 Figure 20: (Sample Image I) Green Boundaries Superimposed on the Nuclei Figure 21: (Sample Image II) Green Boundaries Superimposed on the Nuclei 34 EXPERIMENTAL RESULTS AND COMPARISON The performance of the proposed algorithm is evaluated by comparing the output obtained by manual calculation and inspection. To prove the accuracy of our simplified algorithm, we ran through several sample images to show the segmented nucleus output image and compared the results against the outputs obtained using approaches proposed by Mohamed et al. [15] and Qui\u00f1ones et al. [28], both quantitatively and visually. Figures 22-29 show the input sample images and output images produced by our proposed algorithm as well as the competing methods. Comparing the output images using different algorithm, clearly the output shown in Figure 25 using the proposed algorithm was able to preserve the features of the nuclei with high resemblance. This can be achieved due to the high correlation found between the M and R color plane within the nucleus of the leukocytes. Two images of different resolution and color tone are tested using three different algorithms. Figure 22 shows the first sample image with the resolution of 1368 x 1712 pixels in RGB color space. Using our proposed algorithm, it was able to detect and segment exactly three nuclei in the image with the shape and feature of the nuclei preserved, without any unwanted white dots or noise in the image, as shown in Figure 23. However, when the sample image is inputted and tested by the algorithm proposed by Mohamed et al., not only there are many small visible white dots in the image, but the feature of the nucleus is absent, especially the nucleus on the bottom left corner has turned more circular than its original shape. The output image from the second algorithm is shown in Figure 24 below. The same initial image is then loaded into the algorithm proposed by Qui\u00f1ones et al. While the output image is better than the output image using algorithm proposed by Mohamed et al., there are still some visible white dots in the image. 35 Without appropriate image noise handling, these unwanted white dots will cause calculation error and ultimately affect the medical diagnostic test result, as shown in Figure 25. Second sample image of resolution 504 x 336 pixels is shown in Figure 26. Same as the process above, this image will be used as the test image for all three algorithms, and the output is then inspected visually. Judging at Figure 27 outputted from the proposed algorithm, it preserves the features of the nuclei with high resemblance. This can be achieved due to the high correlation found between the M and R color plane within the nucleus of the leukocytes. Though the algorithm proposed by Mohamed et al. can almost accurately locate and segment all the nuclei with some noise or false positives in the image caused by the platelets, one of the nuclei (highlighted in red) in the output image shown in Figure 28 is missing, and the segmented nuclei obtained have lost their features and characteristics due to its momentous dependency on morphological opening with a disk-shaped structuring element of radius nine to remove small pixel groups. While the shape of the nuclei retained using the approach proposed by Qui\u00f1ones et al. shown in Figure 29, it was not able to remove the platelets in the image and mistreated them as nuclei, therefore, unwanted white dots are included in both output images. The main culprit of this drawback in their algorithm is the eliminated morphological operations and image enhancement in the segmentation stage, which makes it highly susceptible to image noise. 36 Figure 22: Sample Image III Represented in RGB Figure 23: (Sample Image III) Segmented Nuclei using Proposed Algorithm 37 Figure 24: (Sample Image III) Segmented Nuclei using Algorithm by Mohamed et al. Figure 25: (Sample Image III) Segmented Nuclei using Algorithm by Qui\u00f1ones et al. 38 Figure 26: Sample Image IV Represented in RGB Figure 27: (Sample Image IV) Segmented Nuclei using Proposed Algorithm 39 Figure 28: (Sample Image IV) Segmented Nuclei using Algorithm by Mohamed et al. Figure 29: (Sample Image IV) Segmented Nuclei using Algorithm by Qui\u00f1ones et al. 40 After verifying the efficiency of the algorithm against other segmentation technique proposed by other researches, the following steps is to test the credibility of the proposed algorithm by inserting 30 microscopic images acquired from different databases [30, 31, 32] with different color tones, resolutions, and magnifications into the proposed algorithm. As shown in Table I, the algorithm can achieve highest accuracy of 100% and lowest of 91.67%, at an average of 98.99% accurate. Unlike the algorithm proposed in [15], the time taken to segment the leukocytes using the proposed algorithm is not affected by the total leukocyte count. On average, it took an average of 1.75 seconds to segment the leukocytes in the blood smear images with a resolution of 1368x1712, with leukocyte count ranging from 2 to 33. Figure 30 to Figure 37 shows the images before and after the nucleus detection using the proposed algorithm. 41 Figure 30: (Sample Image IV) Initial Image Represented in RGB Figure 31: (Sample Image IV) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green 42 Figure 32: (Sample Image V) Initial Image Represented in RGB Figure 33: (Sample Image V) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green 1 Figure 34: (Sample Image VI) Initial Image Represented in RGB Figure 35: (Sample Image VI) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green 44 Figure 36: (Sample Image VII) Initial Image Represented in RGB Figure 37: (Sample Image VII) Detected Nuclei using Proposed Algorithm with Boundaries Superimposed in Green 45 Table 3: Result and Comparison of Nucleus Count by Manual Inspection and using Proposed Algorithm Image Image Resolution Using Proposed Algorithm Manual Count Accuracy (%) Total Time (s) 1 709x960 4 4 100 0.91 2 604x1312 10 10 100 0.99 3 596x956 6 6 100 0.70 4 531x785 5 5 100 0.77 5 775x935 6 6 100 0.80 6 611x983 3 3 100 0.68 7 779x1029 5 5 100 0.82 8 667x1007 7 7 100 0.96 9 431x1139 7 7 100 0.82 10 1368x1712 18 18 100 1.73 11 1368x1712 21 21 100 1.82 12 1368x1712 16 16 100 1.74 13 1368x1712 12 12 100 1.75 14 1368x1712 33 36 91.67 1.83 15 1368x1712 24 24 100 1.77 16 1368x1712 13 13 100 1.75 17 1368x1712 25 25 100 1.83 18 1368x1712 14 13 92.86 1.80 19 1368x1712 21 20 95.24 1.89 20 1368x1712 21 23 100 1.71 21 1368x1712 25 26 96.15 1.77 22 1368x1712 2 2 100 1.73 23 1368x1712 3 3 100 1.76 24 1368x1712 5 5 100 1.74 25 1368x1712 7 7 100 1.72 26 1368x1712 4 4 100 1.71 27 1368x1712 3 3 100 1.71 28 1368x1712 6 6 100 1.79 29 1368x1712 4 4 100 1.59 30 1368x1712 2 2 100 1.73 46 CONCLUSION Through our research work, we were able to propose a segmentation algorithm that achieves high performance at localizing and segmenting leukocytes in microscopic blood sample images. Our algorithm achieves high accuracy and high speed. To the best of our knowledge, this algorithm is the first that exploits the correlation between two color components from two color spaces (CMYK and RGB). Our algorithm uses the upper and lower limits of the intensity in the Magenta component from the CMYK color space to adjust the image contrast in the Green component of the RGB color space to segment the nuclei without any pre-processing steps needed. Then, by using minima transformation and including intensity map into distance transform, we were able to address the over-segmentation issue using watershed segmentation. The proposed algorithm was tested using a series of 30 blood sample images with different color tones, image resolutions, magnifications, and surrounding conditions. The segmented nuclei are virtually congruent to the nuclei in the original image, in term of shape and area, regardless of the type of nucleus. The overall segmentation accuracy achieved by the proposed algorithm is 98.99%, with a consistent performance for the same image resolution regardless of the number of nucleus in the blood smear image. This algorithm can be seen as a stepping stone for efficient implementation of nucleus classification to identify and classify the type of leukocyte for accurate medical diagnosis. This algorithm is deemed successful in detecting and segmenting the nuclei from the background, and agglomerated nuclei are separated using the improved watershed transformation. This acts as a stepping stone for efficient implementation of nuclei segmentation, and further improvement such as nucleus classification can be appended into the algorithm to accurately identify and classify the type of leukocyte for efficient and accurate medical diagnosis. 47 REFERENCES [1] T. George, \"Automated hematology instrumentation,\" in UpToDate, 2016. [2] A. Tefferi, C. Hanson and D. Inwards, \"How to Interpret and Pursue an Abnormal Complete Blood Cell Count in Adults\" in Mayo Clinic Proceedings, 2005. [3] N. Silva, S. Sivayoganathan, A. Sivashangar, W. Wickramasinghe, L. Gooneratne and S. Rajapakse, \"Can findings on peripheral blood smear differentiate leptospirosis from other infections? A preliminary comparative study,\" Transactions of The Royal Society of Tropical Medicine and Hygiene, vol. 112. pp. 94-96. February 2018. [4] J. Rawat, A. Singh, H. S. Bhadauria and J. Virmani, \"Computer Aided Diagnostic System for Detection of Leukemia Using Microscopic Images\", in Proceedings of the 4th International Conference on Eco-friendly Computing and Communication Systems, vol. 70, pp. 748-756, 2015. [5] M. Saraswat and K. V. image identification: Film - Ann Postgrad vol. 12, pp. 71-79, [7] C. Fatichah, M. L. Tangel, R. Widyanto, F. Dong, and K. Hirota, \"Interest-based ordering for fuzzy morphology on white blood cell image segmentation,\" Journal of Advanced Computational Intelligence and Intelligent Informatics, vol. 16, pp. 76-86. [8] D. M. U. Sabino, L. da. F. Costa, E. G. Rizzatti, and M. A. Zago, \"A texture approach to leukocyte pp. 205-216. August 2004. E. G. Weir and M. J. Borowitz, \"Flow cytometry in the diagnosis of acute leukemia,\" Semin Hematol, vol. 38, no. 2, pp. and Campana, \"Prognostic importance of measuring early clearance of leukemic cells by flow cytometry in childhood acute lymphoblastic leukemia,\" in National Center for Biotechnology Information, vol. 100, no. 1, pp. 52-58, July 1, Automated Blood Cell Nucleus Localization and Segmentation using Image Arithmetic and Automatic Threshold,\" Journal of Applied Sciences, vol. 10, no.11, pp. 353-359, November 2010. [12] T. Deserno, S. Mersmann, T. Tolxdorff, G. Wagenknecht and T. Wittenberg, \"Viewpoints on Medical Image Processing: From Science to Application\", Curr Med Imaging Rev, vol. 9, no. 2, pp. 79-88, May 2013. [13] Committee on Diagnostic Error in Health Care, Board on Health Care Services, Institute of Medicine, The National Academies of Sciences, Engineering, and Medicine, Balogh, E., Miller, B. and Ball, J. ed., (2019). 9: The Path to Improve Diagnosis and Reduce Diagnostic Error. Improving Diagnosis in Health Care. Washington (DC): National Academies Press (US), December 2015. [14] World Health Organization (WHO), Diagnostic Errors: Technical Series on Safer Primary Care, Geneva, 2016. [15] M. Mohamed, B. Far and A. Guaily, \"An efficient technique for white blood cells nuclei automatic segmentation,\" in 2012 IEEE International Conference on Systems, Man, and Cybernetics (SMC), pp. Seoul, 2012. [16] P.A. Thakur, \"An overview of image segmentation algorithms,\" in International Journal of Image Processing and Vision Sciences, vol. 1, issue 2, 2012. 49 [17] A. Gautam and H. Bhadauria, \"Classification of white blood cells based on morphological features,\" in 2014 International Conference on Advances in Computing, Communications and Informatics (ICACCI), pp. 2363-2368, New Delhi, 2014. [18] Z. Liu, J. Liu, X. Xiao, H. Yuan, X. Li, J. Chang and C. Zheng, \"Segmentation of White Blood Cells through Nucleus Mark Watershed Operations and Mean Shift Clustering,\" Sensors, Basel, Sept 2015. [19] Y. Li, R.Zhu, L. Mi, Y. Cao, and D. Yao, \"Segmentation of White Blood Cell from Acute Lymphoblastic Leukemia Images Using Dual-Threshold Method,\" in Computational and Mathematical Methods in Medicine, vol. 2016, 2016. [20] A. Taneja, P. Ranjan and A. Ujjlayan, \"A performance study of image segmentation techniques,\" in 2015 4th International Conference on Reliability, Infocom Technologies and Optimization (ICRITO) (Trends and Future Directions), pp. 1-6, Noida, 2015. [21] Y. Song and H. Yan, \"Image Segmentation Techniques Overview,\" A. Bali and S. N. Singh, \"A Review on the Strategies and Techniques of Image Segmentation,\" in 2015 Fifth International Conference on Advanced Computing & Communication Technologies, Haryana, 2015, pp. 113-120. [23] L. Putzu, C. Ruberto, from Leukemic Blood Image\", IWBBIO international work-conference on bioinformatics and Panicker, \"Enhanced leucocyte classification for leukaemia detection,\" in 2016 Information Science (ICIS), Kochi, 2016, pp. 65-71. 50 [25] A. Tareef, Y. Song, W. Cai, Y. Wang, D. D. Feng and M. Chen, \"Automatic nuclei and cytoplasm segmentation of leukocytes with color and texture-based image enhancement,\" in 2016 IEEE 13th International Symposium on Biomedical Imaging (ISBI), Prague, 2016, pp. 935-938. [26] R. Ahasan, A. U. Ratul and A. S. M. Bakibillah, \"White blood cells nucleus segmentation from microscopic images of strained peripheral blood film during leukemia and normal condition,\" in 2016 5th International Conference on Informatics, Electronics and Vision (ICIEV), Dhaka, 2016, pp. V. Qui\u00f1ones, M. J. Macawile, A. Ballado, J. D. Cruz and M. V. Caya, \"Leukocyte segmentation and counting based on microscopic blood images using HSV saturation component with blob analysis,\" in 2018 3rd International Conference on Control and Robotics Engineering (ICCRE), Nagoya, 2018, pp. 254-258. [28] S. S. Savkare and S. P. Narote, \"Blood cell segmentation from microscopic blood images,\" in 2015 International Conference on Information Processing (ICIP), Pune, A. M. cytoplasm segmentation in microscopic images using K-means clustering and region growing,\" National Center for Biotechnology Information, 2015. [31] R. C. Gonzalez and R. E. Woods, Digital Image Processing, 3rd ed. Upper Saddle River, NJ: Prentice-Hall, Inc, 2006. [32] Scotti, chromatid exchange frequency,\" The Journal of Histochemistry and Cytochemistry, vol. 25, No. 7, pp. 741-753, 1997. 52 APPENDIX A Program Code % Segmenting Nucleus using G and M components, utilizing Watershed Segmentation. I = imread('Im001_1 - Copy2.jpg'); cmyk = z = I; z(~mask) figure, = figure, imshow((I)); 'Color', 'r', 'LineWidth', 3); hold on "}